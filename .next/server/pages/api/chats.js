"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/chats";
exports.ids = ["pages/api/chats"];
exports.modules = {

/***/ "jsonwebtoken":
/*!*******************************!*\
  !*** external "jsonwebtoken" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("jsonwebtoken");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "(api)/./pages/api/chats.ts":
/*!****************************!*\
  !*** ./pages/api/chats.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! jsonwebtoken */ \"jsonwebtoken\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_2__);\n// pages/api/chats.ts\n\n\n\n// Пути к файлам\nconst getChatsFilePath = ()=>path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"data\", \"chats.json\");\nconst getTasksFilePath = ()=>path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"data\", \"tasks.json\");\nconst getUsersFilePath = ()=>path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"data\", \"users.json\");\n// Функции для работы с файлами\nconst loadChats = ()=>{\n    const filePath = getChatsFilePath();\n    if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(filePath)) {\n        return [];\n    }\n    try {\n        const data = fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(filePath, \"utf8\");\n        return JSON.parse(data);\n    } catch (error) {\n        console.error(\"Error loading chats:\", error);\n        return [];\n    }\n};\nconst loadTasks = ()=>{\n    const filePath = getTasksFilePath();\n    if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(filePath)) {\n        return [];\n    }\n    try {\n        const data = fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(filePath, \"utf8\");\n        return JSON.parse(data);\n    } catch (error) {\n        console.error(\"Error loading tasks:\", error);\n        return [];\n    }\n};\nconst loadUsers = ()=>{\n    const filePath = getUsersFilePath();\n    if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(filePath)) {\n        return [];\n    }\n    try {\n        const data = fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(filePath, \"utf8\");\n        return JSON.parse(data);\n    } catch (error) {\n        console.error(\"Error loading users:\", error);\n        return [];\n    }\n};\n// Проверка токена\nconst verifyToken = (token)=>{\n    try {\n        const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default().verify(token, process.env.JWT_SECRET || \"workly-local-secret-key-2025\");\n        return decoded;\n    } catch (error) {\n        return null;\n    }\n};\nconst getUserFromToken = (authHeader)=>{\n    if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n        return null;\n    }\n    const token = authHeader.split(\" \")[1];\n    const decoded = verifyToken(token);\n    if (!decoded) return null;\n    try {\n        const users = loadUsers();\n        const user = users.find((u)=>u.id === decoded.userId);\n        if (!user) return null;\n        return {\n            id: user.id,\n            username: user.username,\n            email: user.email\n        };\n    } catch (error) {\n        return null;\n    }\n};\nasync function handler(req, res) {\n    const { method } = req;\n    // Проверяем аутентификацию\n    const currentUser = getUserFromToken(req.headers.authorization);\n    if (!currentUser) {\n        return res.status(401).json({\n            error: \"Unauthorized\",\n            message: \"Authentication required\"\n        });\n    }\n    if (method === \"GET\") {\n        try {\n            // Загружаем данные\n            const chats = loadChats();\n            const tasks = loadTasks();\n            const users = loadUsers();\n            // Фильтруем чаты для текущего пользователя\n            const userChats = chats.filter((chat)=>chat.clientId === currentUser.id || chat.freelancerId === currentUser.id);\n            // Создаем превью чатов\n            const chatPreviews = userChats.map((chat)=>{\n                // Определяем участника (не текущего пользователя)\n                const participantId = chat.clientId === currentUser.id ? chat.freelancerId : chat.clientId;\n                const participant = users.find((u)=>u.id === participantId);\n                const task = tasks.find((t)=>t.id === chat.taskId);\n                // Последнее сообщение\n                const lastMessage = chat.messages.length > 0 ? chat.messages[chat.messages.length - 1] : null;\n                // Подсчет непрочитанных сообщений\n                const unreadCount = chat.messages.filter((msg)=>msg.senderId !== currentUser.id && msg.status !== \"read\").length;\n                return {\n                    id: chat.id,\n                    taskId: chat.taskId,\n                    taskTitle: task?.title || \"Unknown Task\",\n                    participantId,\n                    participantName: participant?.username || \"Unknown User\",\n                    participantEmail: participant?.email || \"\",\n                    lastMessage: lastMessage ? {\n                        text: lastMessage.text,\n                        timestamp: lastMessage.timestamp,\n                        senderId: lastMessage.senderId\n                    } : null,\n                    unreadCount,\n                    lastActivity: chat.lastMessageAt\n                };\n            });\n            // Сортируем по последней активности\n            chatPreviews.sort((a, b)=>new Date(b.lastActivity).getTime() - new Date(a.lastActivity).getTime());\n            res.status(200).json({\n                success: true,\n                chats: chatPreviews\n            });\n        } catch (error) {\n            console.error(\"Get chats error:\", error);\n            res.status(500).json({\n                error: \"Internal server error\",\n                message: \"Failed to get chats\"\n            });\n        }\n    } else {\n        res.status(405).json({\n            error: \"Method not allowed\",\n            message: `Method ${method} is not supported`\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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S0FBS1MsTUFBTTtvQkFDbkJPLFdBQVdULE1BQU1VLFNBQVM7b0JBQzFCWjtvQkFDQWEsaUJBQWlCWixhQUFhdEIsWUFBWTtvQkFDMUNtQyxrQkFBa0JiLGFBQWFyQixTQUFTO29CQUN4Q3lCLGFBQWFBLGNBQWM7d0JBQ3pCVSxNQUFNVixZQUFZVSxJQUFJO3dCQUN0QkMsV0FBV1gsWUFBWVcsU0FBUzt3QkFDaENOLFVBQVVMLFlBQVlLLFFBQVE7b0JBQ2hDLElBQUk7b0JBQ0pGO29CQUNBUyxjQUFjdEIsS0FBS3VCLGFBQWE7Z0JBQ2xDO1lBQ0Y7WUFFQSxvQ0FBb0M7WUFDcENwQixhQUFhcUIsSUFBSSxDQUFDLENBQUNDLEdBQUdDLElBQ3BCLElBQUlDLEtBQUtELEVBQUVKLFlBQVksRUFBRU0sT0FBTyxLQUFLLElBQUlELEtBQUtGLEVBQUVILFlBQVksRUFBRU0sT0FBTztZQUd2RXhDLElBQUlLLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQ25CbUMsU0FBUztnQkFDVGpDLE9BQU9PO1lBQ1Q7UUFFRixFQUFFLE9BQU92QyxPQUFPO1lBQ2RDLFFBQVFELEtBQUssQ0FBQyxvQkFBb0JBO1lBQ2xDd0IsSUFBSUssTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFDbkI5QixPQUFPO2dCQUNQK0IsU0FBUztZQUNYO1FBQ0Y7SUFFRixPQUFPO1FBQ0xQLElBQUlLLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFDbkI5QixPQUFPO1lBQ1ArQixTQUFTLENBQUMsT0FBTyxFQUFFTixPQUFPLGlCQUFpQixDQUFDO1FBQzlDO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3Rhc2tjaGFpbi11aS8uL3BhZ2VzL2FwaS9jaGF0cy50cz8wMjJkIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHBhZ2VzL2FwaS9jaGF0cy50c1xyXG5pbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCdcclxuaW1wb3J0IGZzIGZyb20gJ2ZzJ1xyXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJ1xyXG5pbXBvcnQgand0IGZyb20gJ2pzb253ZWJ0b2tlbidcclxuXHJcbmludGVyZmFjZSBDaGF0TWVzc2FnZSB7XHJcbiAgaWQ6IHN0cmluZ1xyXG4gIHNlbmRlcklkOiBzdHJpbmdcclxuICB0ZXh0OiBzdHJpbmdcclxuICB0aW1lc3RhbXA6IHN0cmluZ1xyXG4gIHN0YXR1czogJ3NlbnQnIHwgJ2RlbGl2ZXJlZCcgfCAncmVhZCdcclxufVxyXG5cclxuaW50ZXJmYWNlIENoYXQge1xyXG4gIGlkOiBzdHJpbmdcclxuICB0YXNrSWQ6IHN0cmluZ1xyXG4gIGNsaWVudElkOiBzdHJpbmdcclxuICBmcmVlbGFuY2VySWQ6IHN0cmluZ1xyXG4gIGNyZWF0ZWRBdDogc3RyaW5nXHJcbiAgbGFzdE1lc3NhZ2VBdDogc3RyaW5nXHJcbiAgbWVzc2FnZXM6IENoYXRNZXNzYWdlW11cclxufVxyXG5cclxuaW50ZXJmYWNlIENoYXRQcmV2aWV3IHtcclxuICBpZDogc3RyaW5nXHJcbiAgdGFza0lkOiBzdHJpbmdcclxuICB0YXNrVGl0bGU6IHN0cmluZ1xyXG4gIHBhcnRpY2lwYW50SWQ6IHN0cmluZ1xyXG4gIHBhcnRpY2lwYW50TmFtZTogc3RyaW5nXHJcbiAgcGFydGljaXBhbnRFbWFpbDogc3RyaW5nXHJcbiAgbGFzdE1lc3NhZ2U6IHtcclxuICAgIHRleHQ6IHN0cmluZ1xyXG4gICAgdGltZXN0YW1wOiBzdHJpbmdcclxuICAgIHNlbmRlcklkOiBzdHJpbmdcclxuICB9IHwgbnVsbFxyXG4gIHVucmVhZENvdW50OiBudW1iZXJcclxuICBsYXN0QWN0aXZpdHk6IHN0cmluZ1xyXG59XHJcblxyXG4vLyDQn9GD0YLQuCDQuiDRhNCw0LnQu9Cw0LxcclxuY29uc3QgZ2V0Q2hhdHNGaWxlUGF0aCA9ICgpID0+IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAnZGF0YScsICdjaGF0cy5qc29uJylcclxuY29uc3QgZ2V0VGFza3NGaWxlUGF0aCA9ICgpID0+IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAnZGF0YScsICd0YXNrcy5qc29uJylcclxuY29uc3QgZ2V0VXNlcnNGaWxlUGF0aCA9ICgpID0+IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAnZGF0YScsICd1c2Vycy5qc29uJylcclxuXHJcbi8vINCk0YPQvdC60YbQuNC4INC00LvRjyDRgNCw0LHQvtGC0Ysg0YEg0YTQsNC50LvQsNC80LhcclxuY29uc3QgbG9hZENoYXRzID0gKCk6IENoYXRbXSA9PiB7XHJcbiAgY29uc3QgZmlsZVBhdGggPSBnZXRDaGF0c0ZpbGVQYXRoKClcclxuICBcclxuICBpZiAoIWZzLmV4aXN0c1N5bmMoZmlsZVBhdGgpKSB7XHJcbiAgICByZXR1cm4gW11cclxuICB9XHJcbiAgXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGRhdGEgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZVBhdGgsICd1dGY4JylcclxuICAgIHJldHVybiBKU09OLnBhcnNlKGRhdGEpXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvYWRpbmcgY2hhdHM6JywgZXJyb3IpXHJcbiAgICByZXR1cm4gW11cclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IGxvYWRUYXNrcyA9ICgpID0+IHtcclxuICBjb25zdCBmaWxlUGF0aCA9IGdldFRhc2tzRmlsZVBhdGgoKVxyXG4gIFxyXG4gIGlmICghZnMuZXhpc3RzU3luYyhmaWxlUGF0aCkpIHtcclxuICAgIHJldHVybiBbXVxyXG4gIH1cclxuICBcclxuICB0cnkge1xyXG4gICAgY29uc3QgZGF0YSA9IGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwgJ3V0ZjgnKVxyXG4gICAgcmV0dXJuIEpTT04ucGFyc2UoZGF0YSlcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgbG9hZGluZyB0YXNrczonLCBlcnJvcilcclxuICAgIHJldHVybiBbXVxyXG4gIH1cclxufVxyXG5cclxuY29uc3QgbG9hZFVzZXJzID0gKCkgPT4ge1xyXG4gIGNvbnN0IGZpbGVQYXRoID0gZ2V0VXNlcnNGaWxlUGF0aCgpXHJcbiAgXHJcbiAgaWYgKCFmcy5leGlzdHNTeW5jKGZpbGVQYXRoKSkge1xyXG4gICAgcmV0dXJuIFtdXHJcbiAgfVxyXG4gIFxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBkYXRhID0gZnMucmVhZEZpbGVTeW5jKGZpbGVQYXRoLCAndXRmOCcpXHJcbiAgICByZXR1cm4gSlNPTi5wYXJzZShkYXRhKVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBsb2FkaW5nIHVzZXJzOicsIGVycm9yKVxyXG4gICAgcmV0dXJuIFtdXHJcbiAgfVxyXG59XHJcblxyXG4vLyDQn9GA0L7QstC10YDQutCwINGC0L7QutC10L3QsFxyXG5jb25zdCB2ZXJpZnlUb2tlbiA9ICh0b2tlbjogc3RyaW5nKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGRlY29kZWQgPSBqd3QudmVyaWZ5KFxyXG4gICAgICB0b2tlbiwgXHJcbiAgICAgIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgJ3dvcmtseS1sb2NhbC1zZWNyZXQta2V5LTIwMjUnXHJcbiAgICApIGFzIHsgdXNlcklkOiBzdHJpbmcgfVxyXG4gICAgcmV0dXJuIGRlY29kZWRcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIG51bGxcclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IGdldFVzZXJGcm9tVG9rZW4gPSAoYXV0aEhlYWRlcjogc3RyaW5nKSA9PiB7XHJcbiAgaWYgKCFhdXRoSGVhZGVyIHx8ICFhdXRoSGVhZGVyLnN0YXJ0c1dpdGgoJ0JlYXJlciAnKSkge1xyXG4gICAgcmV0dXJuIG51bGxcclxuICB9XHJcblxyXG4gIGNvbnN0IHRva2VuID0gYXV0aEhlYWRlci5zcGxpdCgnICcpWzFdXHJcbiAgY29uc3QgZGVjb2RlZCA9IHZlcmlmeVRva2VuKHRva2VuKVxyXG4gIFxyXG4gIGlmICghZGVjb2RlZCkgcmV0dXJuIG51bGxcclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHVzZXJzID0gbG9hZFVzZXJzKClcclxuICAgIGNvbnN0IHVzZXIgPSB1c2Vycy5maW5kKCh1OiBhbnkpID0+IHUuaWQgPT09IGRlY29kZWQudXNlcklkKVxyXG4gICAgXHJcbiAgICBpZiAoIXVzZXIpIHJldHVybiBudWxsXHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgaWQ6IHVzZXIuaWQsXHJcbiAgICAgIHVzZXJuYW1lOiB1c2VyLnVzZXJuYW1lLFxyXG4gICAgICBlbWFpbDogdXNlci5lbWFpbFxyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gbnVsbFxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkge1xyXG4gIGNvbnN0IHsgbWV0aG9kIH0gPSByZXFcclxuXHJcbiAgLy8g0J/RgNC+0LLQtdGA0Y/QtdC8INCw0YPRgtC10L3RgtC40YTQuNC60LDRhtC40Y5cclxuICBjb25zdCBjdXJyZW50VXNlciA9IGdldFVzZXJGcm9tVG9rZW4ocmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbilcclxuICBcclxuICBpZiAoIWN1cnJlbnRVc2VyKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xyXG4gICAgICBlcnJvcjogJ1VuYXV0aG9yaXplZCcsXHJcbiAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCdcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICBpZiAobWV0aG9kID09PSAnR0VUJykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8g0JfQsNCz0YDRg9C20LDQtdC8INC00LDQvdC90YvQtVxyXG4gICAgICBjb25zdCBjaGF0cyA9IGxvYWRDaGF0cygpXHJcbiAgICAgIGNvbnN0IHRhc2tzID0gbG9hZFRhc2tzKClcclxuICAgICAgY29uc3QgdXNlcnMgPSBsb2FkVXNlcnMoKVxyXG5cclxuICAgICAgLy8g0KTQuNC70YzRgtGA0YPQtdC8INGH0LDRgtGLINC00LvRjyDRgtC10LrRg9GJ0LXQs9C+INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRj1xyXG4gICAgICBjb25zdCB1c2VyQ2hhdHMgPSBjaGF0cy5maWx0ZXIoY2hhdCA9PiBcclxuICAgICAgICBjaGF0LmNsaWVudElkID09PSBjdXJyZW50VXNlci5pZCB8fCBjaGF0LmZyZWVsYW5jZXJJZCA9PT0gY3VycmVudFVzZXIuaWRcclxuICAgICAgKVxyXG5cclxuICAgICAgLy8g0KHQvtC30LTQsNC10Lwg0L/RgNC10LLRjNGOINGH0LDRgtC+0LJcclxuICAgICAgY29uc3QgY2hhdFByZXZpZXdzOiBDaGF0UHJldmlld1tdID0gdXNlckNoYXRzLm1hcChjaGF0ID0+IHtcclxuICAgICAgICAvLyDQntC/0YDQtdC00LXQu9GP0LXQvCDRg9GH0LDRgdGC0L3QuNC60LAgKNC90LUg0YLQtdC60YPRidC10LPQviDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8pXHJcbiAgICAgICAgY29uc3QgcGFydGljaXBhbnRJZCA9IGNoYXQuY2xpZW50SWQgPT09IGN1cnJlbnRVc2VyLmlkIFxyXG4gICAgICAgICAgPyBjaGF0LmZyZWVsYW5jZXJJZCBcclxuICAgICAgICAgIDogY2hhdC5jbGllbnRJZFxyXG4gICAgICAgIFxyXG4gICAgICAgIGNvbnN0IHBhcnRpY2lwYW50ID0gdXNlcnMuZmluZCgodTogYW55KSA9PiB1LmlkID09PSBwYXJ0aWNpcGFudElkKVxyXG4gICAgICAgIGNvbnN0IHRhc2sgPSB0YXNrcy5maW5kKCh0OiBhbnkpID0+IHQuaWQgPT09IGNoYXQudGFza0lkKVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vINCf0L7RgdC70LXQtNC90LXQtSDRgdC+0L7QsdGJ0LXQvdC40LVcclxuICAgICAgICBjb25zdCBsYXN0TWVzc2FnZSA9IGNoYXQubWVzc2FnZXMubGVuZ3RoID4gMCBcclxuICAgICAgICAgID8gY2hhdC5tZXNzYWdlc1tjaGF0Lm1lc3NhZ2VzLmxlbmd0aCAtIDFdXHJcbiAgICAgICAgICA6IG51bGxcclxuXHJcbiAgICAgICAgLy8g0J/QvtC00YHRh9C10YIg0L3QtdC/0YDQvtGH0LjRgtCw0L3QvdGL0YUg0YHQvtC+0LHRidC10L3QuNC5XHJcbiAgICAgICAgY29uc3QgdW5yZWFkQ291bnQgPSBjaGF0Lm1lc3NhZ2VzLmZpbHRlcihtc2cgPT4gXHJcbiAgICAgICAgICBtc2cuc2VuZGVySWQgIT09IGN1cnJlbnRVc2VyLmlkICYmIG1zZy5zdGF0dXMgIT09ICdyZWFkJ1xyXG4gICAgICAgICkubGVuZ3RoXHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBpZDogY2hhdC5pZCxcclxuICAgICAgICAgIHRhc2tJZDogY2hhdC50YXNrSWQsXHJcbiAgICAgICAgICB0YXNrVGl0bGU6IHRhc2s/LnRpdGxlIHx8ICdVbmtub3duIFRhc2snLFxyXG4gICAgICAgICAgcGFydGljaXBhbnRJZCxcclxuICAgICAgICAgIHBhcnRpY2lwYW50TmFtZTogcGFydGljaXBhbnQ/LnVzZXJuYW1lIHx8ICdVbmtub3duIFVzZXInLFxyXG4gICAgICAgICAgcGFydGljaXBhbnRFbWFpbDogcGFydGljaXBhbnQ/LmVtYWlsIHx8ICcnLFxyXG4gICAgICAgICAgbGFzdE1lc3NhZ2U6IGxhc3RNZXNzYWdlID8ge1xyXG4gICAgICAgICAgICB0ZXh0OiBsYXN0TWVzc2FnZS50ZXh0LFxyXG4gICAgICAgICAgICB0aW1lc3RhbXA6IGxhc3RNZXNzYWdlLnRpbWVzdGFtcCxcclxuICAgICAgICAgICAgc2VuZGVySWQ6IGxhc3RNZXNzYWdlLnNlbmRlcklkXHJcbiAgICAgICAgICB9IDogbnVsbCxcclxuICAgICAgICAgIHVucmVhZENvdW50LFxyXG4gICAgICAgICAgbGFzdEFjdGl2aXR5OiBjaGF0Lmxhc3RNZXNzYWdlQXRcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcblxyXG4gICAgICAvLyDQodC+0YDRgtC40YDRg9C10Lwg0L/QviDQv9C+0YHQu9C10LTQvdC10Lkg0LDQutGC0LjQstC90L7RgdGC0LhcclxuICAgICAgY2hhdFByZXZpZXdzLnNvcnQoKGEsIGIpID0+IFxyXG4gICAgICAgIG5ldyBEYXRlKGIubGFzdEFjdGl2aXR5KS5nZXRUaW1lKCkgLSBuZXcgRGF0ZShhLmxhc3RBY3Rpdml0eSkuZ2V0VGltZSgpXHJcbiAgICAgIClcclxuXHJcbiAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIGNoYXRzOiBjaGF0UHJldmlld3NcclxuICAgICAgfSlcclxuXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdHZXQgY2hhdHMgZXJyb3I6JywgZXJyb3IpXHJcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXHJcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBnZXQgY2hhdHMnXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gIH0gZWxzZSB7XHJcbiAgICByZXMuc3RhdHVzKDQwNSkuanNvbih7IFxyXG4gICAgICBlcnJvcjogJ01ldGhvZCBub3QgYWxsb3dlZCcsXHJcbiAgICAgIG1lc3NhZ2U6IGBNZXRob2QgJHttZXRob2R9IGlzIG5vdCBzdXBwb3J0ZWRgXHJcbiAgICB9KVxyXG4gIH1cclxufSJdLCJuYW1lcyI6WyJmcyIsInBhdGgiLCJqd3QiLCJnZXRDaGF0c0ZpbGVQYXRoIiwiam9pbiIsInByb2Nlc3MiLCJjd2QiLCJnZXRUYXNrc0ZpbGVQYXRoIiwiZ2V0VXNlcnNGaWxlUGF0aCIsImxvYWRDaGF0cyIsImZpbGVQYXRoIiwiZXhpc3RzU3luYyIsImRhdGEiLCJyZWFkRmlsZVN5bmMiLCJKU09OIiwicGFyc2UiLCJlcnJvciIsImNvbnNvbGUiLCJsb2FkVGFza3MiLCJsb2FkVXNlcnMiLCJ2ZXJpZnlUb2tlbiIsInRva2VuIiwiZGVjb2RlZCIsInZlcmlmeSIsImVudiIsIkpXVF9TRUNSRVQiLCJnZXRVc2VyRnJvbVRva2VuIiwiYXV0aEhlYWRlciIsInN0YXJ0c1dpdGgiLCJzcGxpdCIsInVzZXJzIiwidXNlciIsImZpbmQiLCJ1IiwiaWQiLCJ1c2VySWQiLCJ1c2VybmFtZSIsImVtYWlsIiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsImN1cnJlbnRVc2VyIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJzdGF0dXMiLCJqc29uIiwibWVzc2FnZSIsImNoYXRzIiwidGFza3MiLCJ1c2VyQ2hhdHMiLCJmaWx0ZXIiLCJjaGF0IiwiY2xpZW50SWQiLCJmcmVlbGFuY2VySWQiLCJjaGF0UHJldmlld3MiLCJtYXAiLCJwYXJ0aWNpcGFudElkIiwicGFydGljaXBhbnQiLCJ0YXNrIiwidCIsInRhc2tJZCIsImxhc3RNZXNzYWdlIiwibWVzc2FnZXMiLCJsZW5ndGgiLCJ1bnJlYWRDb3VudCIsIm1zZyIsInNlbmRlcklkIiwidGFza1RpdGxlIiwidGl0bGUiLCJwYXJ0aWNpcGFudE5hbWUiLCJwYXJ0aWNpcGFudEVtYWlsIiwidGV4dCIsInRpbWVzdGFtcCIsImxhc3RBY3Rpdml0eSIsImxhc3RNZXNzYWdlQXQiLCJzb3J0IiwiYSIsImIiLCJEYXRlIiwiZ2V0VGltZSIsInN1Y2Nlc3MiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/chats.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./pages/api/chats.ts"));
module.exports = __webpack_exports__;

})();