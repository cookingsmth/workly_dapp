"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/wallet/info";
exports.ids = ["pages/api/wallet/info"];
exports.modules = {

/***/ "@solana/web3.js":
/*!**********************************!*\
  !*** external "@solana/web3.js" ***!
  \**********************************/
/***/ ((module) => {

module.exports = require("@solana/web3.js");

/***/ }),

/***/ "jsonwebtoken":
/*!*******************************!*\
  !*** external "jsonwebtoken" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("jsonwebtoken");

/***/ }),

/***/ "bs58":
/*!***********************!*\
  !*** external "bs58" ***!
  \***********************/
/***/ ((module) => {

module.exports = import("bs58");;

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "(api)/./lib/wallet/walletService.ts":
/*!*************************************!*\
  !*** ./lib/wallet/walletService.ts ***!
  \*************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   WalletService: () => (/* binding */ WalletService),\n/* harmony export */   walletService: () => (/* binding */ walletService)\n/* harmony export */ });\n/* harmony import */ var _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @solana/web3.js */ \"@solana/web3.js\");\n/* harmony import */ var _solana_web3_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_solana_web3_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var bs58__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bs58 */ \"bs58\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([bs58__WEBPACK_IMPORTED_MODULE_1__]);\nbs58__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// lib/wallet/walletService.ts - Основной сервис кошельков\n\n\nclass WalletService {\n    constructor(rpcUrl = \"https://api.devnet.solana.com\"){\n        this.walletsFile = \"data/wallets.json\";\n        this.escrowsFile = \"data/escrow_accounts.json\";\n        this.transactionsFile = \"data/wallet_transactions.json\";\n        this.connection = new _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.Connection(rpcUrl, \"confirmed\");\n    }\n    // Создание кошелька для нового пользователя\n    async createUserWallet(userId) {\n        const keypair = _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.Keypair.generate();\n        const wallet = {\n            userId,\n            publicKey: keypair.publicKey.toString(),\n            privateKey: this.encryptPrivateKey(bs58__WEBPACK_IMPORTED_MODULE_1__[\"default\"].encode(keypair.secretKey)),\n            solBalance: 0,\n            usdtBalance: 0,\n            usdcBalance: 0,\n            worklyBalance: 0,\n            totalEarned: 0,\n            totalSpent: 0,\n            createdAt: new Date().toISOString(),\n            lastUpdated: new Date().toISOString()\n        };\n        await this.saveWallet(wallet);\n        // Логируем создание\n        await this.logTransaction({\n            type: \"wallet_created\",\n            userId,\n            walletAddress: wallet.publicKey,\n            timestamp: new Date().toISOString()\n        });\n        return wallet;\n    }\n    // Создание escrow адреса для задачи\n    async createTaskEscrow(taskId, clientId, amount, token) {\n        const escrowKeypair = _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.Keypair.generate();\n        const platformFee = this.calculatePlatformFee(amount);\n        const netAmount = amount - platformFee;\n        const escrow = {\n            taskId,\n            escrowAddress: escrowKeypair.publicKey.toString(),\n            escrowPrivateKey: this.encryptPrivateKey(bs58__WEBPACK_IMPORTED_MODULE_1__[\"default\"].encode(escrowKeypair.secretKey)),\n            clientId,\n            amount,\n            token,\n            status: \"pending_payment\",\n            createdAt: new Date().toISOString(),\n            platformFee,\n            netAmount\n        };\n        await this.saveEscrow(escrow);\n        // Логируем создание escrow\n        await this.logTransaction({\n            type: \"escrow_created\",\n            userId: clientId,\n            taskId,\n            escrowAddress: escrow.escrowAddress,\n            amount,\n            token,\n            timestamp: new Date().toISOString()\n        });\n        return escrow;\n    }\n    // Проверка поступления средств на escrow\n    async checkEscrowFunding(escrowAddress) {\n        try {\n            const escrow = await this.getEscrowByAddress(escrowAddress);\n            if (!escrow || escrow.status !== \"pending_payment\") {\n                return false;\n            }\n            let balance = 0;\n            if (escrow.token === \"SOL\") {\n                balance = await this.connection.getBalance(new _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.PublicKey(escrowAddress));\n                balance = balance / _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.LAMPORTS_PER_SOL;\n            }\n            // TODO: Добавить проверку для SPL токенов\n            // Проверяем, достаточно ли средств (с небольшой погрешностью)\n            if (balance >= escrow.amount * 0.99) {\n                await this.markEscrowAsFunded(escrowAddress);\n                return true;\n            }\n            return false;\n        } catch (error) {\n            console.error(\"Error checking escrow funding:\", error);\n            return false;\n        }\n    }\n    // Завершение задачи и перевод средств\n    async completeTaskAndTransfer(taskId, workerId) {\n        try {\n            const escrow = await this.getEscrowByTaskId(taskId);\n            if (!escrow || escrow.status !== \"funded\") {\n                return {\n                    success: false,\n                    error: \"Escrow not found or not funded\"\n                };\n            }\n            const workerWallet = await this.getUserWallet(workerId);\n            if (!workerWallet) {\n                return {\n                    success: false,\n                    error: \"Worker wallet not found\"\n                };\n            }\n            // Создаем транзакцию для перевода (только для SOL пока)\n            if (escrow.token === \"SOL\") {\n                const escrowKeypair = this.decryptPrivateKey(escrow.escrowPrivateKey);\n                const transaction = new _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.Transaction();\n                // Перевод SOL исполнителю\n                const workerTransfer = _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.SystemProgram.transfer({\n                    fromPubkey: new _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.PublicKey(escrow.escrowAddress),\n                    toPubkey: new _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.PublicKey(workerWallet.publicKey),\n                    lamports: Math.floor(escrow.netAmount * _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.LAMPORTS_PER_SOL)\n                });\n                transaction.add(workerTransfer);\n                const WORKLY_TREASURY_WALLET = \"25ZX5Cfc8Pxy7EnsvJ6JNbjbq4c8E9eFuPrzwjUabF4e\";\n                const platformTransfer = _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.SystemProgram.transfer({\n                    fromPubkey: new _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.PublicKey(escrow.escrowAddress),\n                    toPubkey: new _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.PublicKey(WORKLY_TREASURY_WALLET),\n                    lamports: Math.floor(escrow.platformFee * _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.LAMPORTS_PER_SOL)\n                });\n                transaction.add(platformTransfer);\n                const txHash = await (0,_solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.sendAndConfirmTransaction)(this.connection, transaction, [\n                    escrowKeypair\n                ], {\n                    commitment: \"confirmed\"\n                });\n                // Обновляем статус escrow\n                await this.markEscrowAsCompleted(escrow.escrowAddress, txHash);\n                // Обновляем балансы пользователей\n                await this.updateUserBalance(workerId, escrow.netAmount, escrow.token, \"earned\");\n                await this.updateUserBalance(escrow.clientId, escrow.amount, escrow.token, \"spent\");\n                // Начисляем WORKLY токены за завершение задачи\n                await this.rewardWorklyTokens(workerId, escrow.netAmount);\n                // Логируем транзакцию\n                await this.logTransaction({\n                    type: \"task_completed\",\n                    userId: workerId,\n                    taskId,\n                    amount: escrow.netAmount,\n                    token: escrow.token,\n                    txHash,\n                    timestamp: new Date().toISOString()\n                });\n                return {\n                    success: true,\n                    txHash\n                };\n            }\n            return {\n                success: false,\n                error: \"Only SOL transfers supported currently\"\n            };\n        } catch (error) {\n            console.error(\"Error completing task transfer:\", error);\n            return {\n                success: false,\n                error: \"Failed to transfer funds\"\n            };\n        }\n    }\n    // Начисление WORKLY токенов за активность\n    async rewardWorklyTokens(userId, earnedAmount) {\n        try {\n            // Формула: 1% от заработанной суммы в WORKLY токенах\n            const worklyReward = earnedAmount * 0.01;\n            const userWallet = await this.getUserWallet(userId);\n            if (userWallet) {\n                userWallet.worklyBalance += worklyReward;\n                userWallet.lastUpdated = new Date().toISOString();\n                await this.saveWallet(userWallet);\n                await this.logTransaction({\n                    type: \"workly_reward\",\n                    userId,\n                    amount: worklyReward,\n                    token: \"WORKLY\",\n                    timestamp: new Date().toISOString()\n                });\n            }\n        } catch (error) {\n            console.error(\"Error rewarding WORKLY tokens:\", error);\n        }\n    }\n    // Применение скидки WORKLY токена на комиссии\n    calculateDiscountedFee(amount, worklyBalance) {\n        const baseFee = this.calculatePlatformFee(amount);\n        if (worklyBalance >= 1000) {\n            return baseFee * 0.5 // 50% скидка\n            ;\n        } else if (worklyBalance >= 500) {\n            return baseFee * 0.7 // 30% скидка\n            ;\n        } else if (worklyBalance >= 100) {\n            return baseFee * 0.85 // 15% скидка\n            ;\n        }\n        return baseFee;\n    }\n    // Вспомогательные методы\n    calculatePlatformFee(amount) {\n        return amount * 0.025 // 2.5%\n        ;\n    }\n    encryptPrivateKey(privateKey) {\n        // В продакшене использовать реальное шифрование\n        return Buffer.from(privateKey).toString(\"base64\");\n    }\n    decryptPrivateKey(encryptedKey) {\n        // В продакшене использовать реальное расшифрование\n        const privateKey = Buffer.from(encryptedKey, \"base64\").toString();\n        return _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.Keypair.fromSecretKey(bs58__WEBPACK_IMPORTED_MODULE_1__[\"default\"].decode(privateKey));\n    }\n    // Методы работы с файлами (заменить на БД в продакшене)\n    async saveWallet(wallet) {\n        const fs = __webpack_require__(/*! fs */ \"fs\");\n        const path = __webpack_require__(/*! path */ \"path\");\n        const filePath = path.join(process.cwd(), this.walletsFile);\n        const dir = path.dirname(filePath);\n        if (!fs.existsSync(dir)) {\n            fs.mkdirSync(dir, {\n                recursive: true\n            });\n        }\n        let wallets = [];\n        if (fs.existsSync(filePath)) {\n            try {\n                const data = fs.readFileSync(filePath, \"utf8\");\n                wallets = JSON.parse(data);\n            } catch (error) {\n                wallets = [];\n            }\n        }\n        const existingIndex = wallets.findIndex((w)=>w.userId === wallet.userId);\n        if (existingIndex >= 0) {\n            wallets[existingIndex] = wallet;\n        } else {\n            wallets.push(wallet);\n        }\n        fs.writeFileSync(filePath, JSON.stringify(wallets, null, 2));\n    }\n    async getUserWallet(userId) {\n        const fs = __webpack_require__(/*! fs */ \"fs\");\n        const path = __webpack_require__(/*! path */ \"path\");\n        const filePath = path.join(process.cwd(), this.walletsFile);\n        if (!fs.existsSync(filePath)) return null;\n        try {\n            const data = fs.readFileSync(filePath, \"utf8\");\n            const wallets = JSON.parse(data);\n            return wallets.find((w)=>w.userId === userId) || null;\n        } catch (error) {\n            return null;\n        }\n    }\n    async saveEscrow(escrow) {\n        const fs = __webpack_require__(/*! fs */ \"fs\");\n        const path = __webpack_require__(/*! path */ \"path\");\n        const filePath = path.join(process.cwd(), this.escrowsFile);\n        const dir = path.dirname(filePath);\n        if (!fs.existsSync(dir)) {\n            fs.mkdirSync(dir, {\n                recursive: true\n            });\n        }\n        let escrows = [];\n        if (fs.existsSync(filePath)) {\n            try {\n                const data = fs.readFileSync(filePath, \"utf8\");\n                escrows = JSON.parse(data);\n            } catch (error) {\n                escrows = [];\n            }\n        }\n        const existingIndex = escrows.findIndex((e)=>e.taskId === escrow.taskId);\n        if (existingIndex >= 0) {\n            escrows[existingIndex] = escrow;\n        } else {\n            escrows.push(escrow);\n        }\n        fs.writeFileSync(filePath, JSON.stringify(escrows, null, 2));\n    }\n    async getEscrowByAddress(escrowAddress) {\n        const fs = __webpack_require__(/*! fs */ \"fs\");\n        const path = __webpack_require__(/*! path */ \"path\");\n        const filePath = path.join(process.cwd(), this.escrowsFile);\n        if (!fs.existsSync(filePath)) return null;\n        try {\n            const data = fs.readFileSync(filePath, \"utf8\");\n            const escrows = JSON.parse(data);\n            return escrows.find((e)=>e.escrowAddress === escrowAddress) || null;\n        } catch (error) {\n            return null;\n        }\n    }\n    async getEscrowByTaskId(taskId) {\n        const fs = __webpack_require__(/*! fs */ \"fs\");\n        const path = __webpack_require__(/*! path */ \"path\");\n        const filePath = path.join(process.cwd(), this.escrowsFile);\n        if (!fs.existsSync(filePath)) return null;\n        try {\n            const data = fs.readFileSync(filePath, \"utf8\");\n            const escrows = JSON.parse(data);\n            return escrows.find((e)=>e.taskId === taskId) || null;\n        } catch (error) {\n            return null;\n        }\n    }\n    async markEscrowAsFunded(escrowAddress) {\n        const escrow = await this.getEscrowByAddress(escrowAddress);\n        if (escrow) {\n            escrow.status = \"funded\";\n            escrow.fundedAt = new Date().toISOString();\n            await this.saveEscrow(escrow);\n        }\n    }\n    async markEscrowAsCompleted(escrowAddress, txHash) {\n        const escrow = await this.getEscrowByAddress(escrowAddress);\n        if (escrow) {\n            escrow.status = \"completed\";\n            escrow.completedAt = new Date().toISOString();\n            await this.saveEscrow(escrow);\n        }\n    }\n    async updateUserBalance(userId, amount, token, type) {\n        const wallet = await this.getUserWallet(userId);\n        if (!wallet) return;\n        if (type === \"earned\") {\n            switch(token){\n                case \"SOL\":\n                    wallet.solBalance += amount;\n                    break;\n                case \"USDT\":\n                    wallet.usdtBalance += amount;\n                    break;\n                case \"USDC\":\n                    wallet.usdcBalance += amount;\n                    break;\n            }\n            wallet.totalEarned += amount;\n        } else if (type === \"spent\") {\n            wallet.totalSpent += amount;\n        } else if (type === \"withdrawn\") {\n            switch(token){\n                case \"SOL\":\n                    wallet.solBalance -= amount;\n                    break;\n                case \"USDT\":\n                    wallet.usdtBalance -= amount;\n                    break;\n                case \"USDC\":\n                    wallet.usdcBalance -= amount;\n                    break;\n            }\n        }\n        wallet.lastUpdated = new Date().toISOString();\n        await this.saveWallet(wallet);\n    }\n    async logTransaction(transaction) {\n        const fs = __webpack_require__(/*! fs */ \"fs\");\n        const path = __webpack_require__(/*! path */ \"path\");\n        const filePath = path.join(process.cwd(), this.transactionsFile);\n        const dir = path.dirname(filePath);\n        if (!fs.existsSync(dir)) {\n            fs.mkdirSync(dir, {\n                recursive: true\n            });\n        }\n        let transactions = [];\n        if (fs.existsSync(filePath)) {\n            try {\n                const data = fs.readFileSync(filePath, \"utf8\");\n                transactions = JSON.parse(data);\n            } catch (error) {\n                transactions = [];\n            }\n        }\n        transactions.push({\n            id: Date.now().toString(),\n            ...transaction\n        });\n        fs.writeFileSync(filePath, JSON.stringify(transactions, null, 2));\n    }\n    async syncWalletBalance(userId) {\n        try {\n            const wallet = await this.getUserWallet(userId);\n            if (!wallet) return null;\n            // Получаем реальный баланс SOL с блокчейна\n            const publicKey = new _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.PublicKey(wallet.publicKey);\n            const balance = await this.connection.getBalance(publicKey);\n            const solBalance = balance / _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.LAMPORTS_PER_SOL;\n            // Обновляем баланс в локальных данных\n            wallet.solBalance = solBalance;\n            wallet.lastUpdated = new Date().toISOString();\n            // Сохраняем обновленный кошелек\n            await this.saveWallet(wallet);\n            console.log(`Updated balance for ${userId}: ${solBalance} SOL`);\n            return wallet;\n        } catch (error) {\n            console.error(\"Error syncing wallet balance:\", error);\n            return null;\n        }\n    }\n    // Публичные методы для API\n    async createWalletForUser(userId) {\n        return await this.createUserWallet(userId);\n    }\n    async getWalletInfo(userId) {\n        try {\n            // Сначала получаем кошелек из файла\n            let wallet = await this.getUserWallet(userId);\n            if (!wallet) return null;\n            // Синхронизируем баланс с блокчейном\n            wallet = await this.syncWalletBalance(userId);\n            return wallet;\n        } catch (error) {\n            console.error(\"Error getting wallet info:\", error);\n            return null;\n        }\n    }\n    async createTaskEscrowAddress(taskId, clientId, amount, token) {\n        return await this.createTaskEscrow(taskId, clientId, amount, token);\n    }\n    async checkTaskFunding(taskId) {\n        const escrow = await this.getEscrowByTaskId(taskId);\n        if (!escrow) return false;\n        return await this.checkEscrowFunding(escrow.escrowAddress);\n    }\n    async completeTask(taskId, workerId) {\n        return await this.completeTaskAndTransfer(taskId, workerId);\n    }\n    // Метод для вывода средств\n    async withdrawFunds(userId, amount, toAddress, token = \"SOL\") {\n        try {\n            const userWallet = await this.getUserWallet(userId);\n            if (!userWallet) {\n                return {\n                    success: false,\n                    error: \"User wallet not found\"\n                };\n            }\n            const currentBalance = userWallet.solBalance;\n            if (amount > currentBalance) {\n                return {\n                    success: false,\n                    error: \"Insufficient balance\"\n                };\n            }\n            try {\n                new _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.PublicKey(toAddress);\n            } catch (e) {\n                return {\n                    success: false,\n                    error: \"Invalid Solana address\"\n                };\n            }\n            if (amount < 0.001) {\n                return {\n                    success: false,\n                    error: \"Minimum withdrawal amount is 0.001 SOL\"\n                };\n            }\n            const userKeypair = this.decryptPrivateKey(userWallet.privateKey);\n            const transaction = new _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.Transaction();\n            const transfer = _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.SystemProgram.transfer({\n                fromPubkey: userKeypair.publicKey,\n                toPubkey: new _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.PublicKey(toAddress),\n                lamports: Math.floor(amount * _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.LAMPORTS_PER_SOL)\n            });\n            transaction.add(transfer);\n            const txHash = await (0,_solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.sendAndConfirmTransaction)(this.connection, transaction, [\n                userKeypair\n            ], {\n                commitment: \"confirmed\"\n            });\n            await this.updateUserBalance(userId, amount, token, \"withdrawn\");\n            await this.logTransaction({\n                type: \"withdrawal\",\n                userId,\n                amount,\n                token,\n                toAddress,\n                txHash,\n                timestamp: new Date().toISOString()\n            });\n            return {\n                success: true,\n                txHash\n            };\n        } catch (error) {\n            console.error(\"Error withdrawing funds:\", error);\n            return {\n                success: false,\n                error: \"Failed to process withdrawal\"\n            };\n        }\n    }\n    async forceRefreshWallet(userId) {\n        console.log(`Force refreshing wallet for user: ${userId}`);\n        return await this.syncWalletBalance(userId);\n    }\n    // Публичный метод для API\n    async processWithdrawal(userId, amount, toAddress) {\n        return await this.withdrawFunds(userId, amount, toAddress, \"SOL\");\n    }\n}\n// Экспортируем синглтон\nconst walletService = new WalletService();\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LFFBQVE0QixRQUFRMEYsV0FBVztJQUM3RDtBQUNGO0FBQ0Esd0JBQXdCO0FBQ2pCLE1BQU1LLGdCQUFnQixJQUFJbkksZ0JBQWUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90YXNrY2hhaW4tdWkvLi9saWIvd2FsbGV0L3dhbGxldFNlcnZpY2UudHM/OGNkNCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvd2FsbGV0L3dhbGxldFNlcnZpY2UudHMgLSDQntGB0L3QvtCy0L3QvtC5INGB0LXRgNCy0LjRgSDQutC+0YjQtdC70YzQutC+0LJcclxuaW1wb3J0IHsgS2V5cGFpciwgUHVibGljS2V5LCBDb25uZWN0aW9uLCBMQU1QT1JUU19QRVJfU09MLCBUcmFuc2FjdGlvbiwgU3lzdGVtUHJvZ3JhbSwgc2VuZEFuZENvbmZpcm1UcmFuc2FjdGlvbiB9IGZyb20gJ0Bzb2xhbmEvd2ViMy5qcydcclxuaW1wb3J0IGJzNTggZnJvbSAnYnM1OCdcclxuXHJcbi8vINCi0LjQv9GLXHJcbmludGVyZmFjZSBVc2VyV2FsbGV0IHtcclxuICB1c2VySWQ6IHN0cmluZ1xyXG4gIHB1YmxpY0tleTogc3RyaW5nXHJcbiAgcHJpdmF0ZUtleTogc3RyaW5nIC8vINC30LDRiNC40YTRgNC+0LLQsNC90L3Ri9C5XHJcbiAgc29sQmFsYW5jZTogbnVtYmVyXHJcbiAgdXNkdEJhbGFuY2U6IG51bWJlclxyXG4gIHVzZGNCYWxhbmNlOiBudW1iZXJcclxuICB3b3JrbHlCYWxhbmNlOiBudW1iZXJcclxuICB0b3RhbEVhcm5lZDogbnVtYmVyXHJcbiAgdG90YWxTcGVudDogbnVtYmVyXHJcbiAgY3JlYXRlZEF0OiBzdHJpbmdcclxuICBsYXN0VXBkYXRlZDogc3RyaW5nXHJcbn1cclxuXHJcbmludGVyZmFjZSBFc2Nyb3dBY2NvdW50IHtcclxuICB0YXNrSWQ6IHN0cmluZ1xyXG4gIGVzY3Jvd0FkZHJlc3M6IHN0cmluZ1xyXG4gIGVzY3Jvd1ByaXZhdGVLZXk6IHN0cmluZyAvLyDQt9Cw0YjQuNGE0YDQvtCy0LDQvdC90YvQuVxyXG4gIGNsaWVudElkOiBzdHJpbmdcclxuICB3b3JrZXJJZD86IHN0cmluZ1xyXG4gIGFtb3VudDogbnVtYmVyXHJcbiAgdG9rZW46ICdTT0wnIHwgJ1VTRFQnIHwgJ1VTREMnXHJcbiAgc3RhdHVzOiAncGVuZGluZ19wYXltZW50JyB8ICdmdW5kZWQnIHwgJ2NvbXBsZXRlZCcgfCAnY2FuY2VsbGVkJ1xyXG4gIGNyZWF0ZWRBdDogc3RyaW5nXHJcbiAgZnVuZGVkQXQ/OiBzdHJpbmdcclxuICBjb21wbGV0ZWRBdD86IHN0cmluZ1xyXG4gIHBsYXRmb3JtRmVlOiBudW1iZXJcclxuICBuZXRBbW91bnQ6IG51bWJlciAvLyBhbW91bnQgLSBwbGF0Zm9ybUZlZVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgV2FsbGV0U2VydmljZSB7XHJcbiAgcHJpdmF0ZSBjb25uZWN0aW9uOiBDb25uZWN0aW9uXHJcbiAgcHJpdmF0ZSB3YWxsZXRzRmlsZSA9ICdkYXRhL3dhbGxldHMuanNvbidcclxuICBwcml2YXRlIGVzY3Jvd3NGaWxlID0gJ2RhdGEvZXNjcm93X2FjY291bnRzLmpzb24nXHJcbiAgcHJpdmF0ZSB0cmFuc2FjdGlvbnNGaWxlID0gJ2RhdGEvd2FsbGV0X3RyYW5zYWN0aW9ucy5qc29uJ1xyXG5cclxuICBjb25zdHJ1Y3RvcihycGNVcmw6IHN0cmluZyA9ICdodHRwczovL2FwaS5kZXZuZXQuc29sYW5hLmNvbScpIHtcclxuICAgIHRoaXMuY29ubmVjdGlvbiA9IG5ldyBDb25uZWN0aW9uKHJwY1VybCwgJ2NvbmZpcm1lZCcpXHJcbiAgfVxyXG5cclxuICAvLyDQodC+0LfQtNCw0L3QuNC1INC60L7RiNC10LvRjNC60LAg0LTQu9GPINC90L7QstC+0LPQviDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y9cclxuICBhc3luYyBjcmVhdGVVc2VyV2FsbGV0KHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxVc2VyV2FsbGV0PiB7XHJcbiAgICBjb25zdCBrZXlwYWlyID0gS2V5cGFpci5nZW5lcmF0ZSgpXHJcblxyXG4gICAgY29uc3Qgd2FsbGV0OiBVc2VyV2FsbGV0ID0ge1xyXG4gICAgICB1c2VySWQsXHJcbiAgICAgIHB1YmxpY0tleToga2V5cGFpci5wdWJsaWNLZXkudG9TdHJpbmcoKSxcclxuICAgICAgcHJpdmF0ZUtleTogdGhpcy5lbmNyeXB0UHJpdmF0ZUtleShiczU4LmVuY29kZShrZXlwYWlyLnNlY3JldEtleSkpLFxyXG4gICAgICBzb2xCYWxhbmNlOiAwLFxyXG4gICAgICB1c2R0QmFsYW5jZTogMCxcclxuICAgICAgdXNkY0JhbGFuY2U6IDAsXHJcbiAgICAgIHdvcmtseUJhbGFuY2U6IDAsXHJcbiAgICAgIHRvdGFsRWFybmVkOiAwLFxyXG4gICAgICB0b3RhbFNwZW50OiAwLFxyXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgbGFzdFVwZGF0ZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgfVxyXG5cclxuICAgIGF3YWl0IHRoaXMuc2F2ZVdhbGxldCh3YWxsZXQpXHJcblxyXG4gICAgLy8g0JvQvtCz0LjRgNGD0LXQvCDRgdC+0LfQtNCw0L3QuNC1XHJcbiAgICBhd2FpdCB0aGlzLmxvZ1RyYW5zYWN0aW9uKHtcclxuICAgICAgdHlwZTogJ3dhbGxldF9jcmVhdGVkJyxcclxuICAgICAgdXNlcklkLFxyXG4gICAgICB3YWxsZXRBZGRyZXNzOiB3YWxsZXQucHVibGljS2V5LFxyXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgfSlcclxuXHJcbiAgICByZXR1cm4gd2FsbGV0XHJcbiAgfVxyXG5cclxuICAvLyDQodC+0LfQtNCw0L3QuNC1IGVzY3JvdyDQsNC00YDQtdGB0LAg0LTQu9GPINC30LDQtNCw0YfQuFxyXG4gIGFzeW5jIGNyZWF0ZVRhc2tFc2Nyb3codGFza0lkOiBzdHJpbmcsIGNsaWVudElkOiBzdHJpbmcsIGFtb3VudDogbnVtYmVyLCB0b2tlbjogJ1NPTCcgfCAnVVNEVCcgfCAnVVNEQycpOiBQcm9taXNlPEVzY3Jvd0FjY291bnQ+IHtcclxuICAgIGNvbnN0IGVzY3Jvd0tleXBhaXIgPSBLZXlwYWlyLmdlbmVyYXRlKClcclxuICAgIGNvbnN0IHBsYXRmb3JtRmVlID0gdGhpcy5jYWxjdWxhdGVQbGF0Zm9ybUZlZShhbW91bnQpXHJcbiAgICBjb25zdCBuZXRBbW91bnQgPSBhbW91bnQgLSBwbGF0Zm9ybUZlZVxyXG5cclxuICAgIGNvbnN0IGVzY3JvdzogRXNjcm93QWNjb3VudCA9IHtcclxuICAgICAgdGFza0lkLFxyXG4gICAgICBlc2Nyb3dBZGRyZXNzOiBlc2Nyb3dLZXlwYWlyLnB1YmxpY0tleS50b1N0cmluZygpLFxyXG4gICAgICBlc2Nyb3dQcml2YXRlS2V5OiB0aGlzLmVuY3J5cHRQcml2YXRlS2V5KGJzNTguZW5jb2RlKGVzY3Jvd0tleXBhaXIuc2VjcmV0S2V5KSksXHJcbiAgICAgIGNsaWVudElkLFxyXG4gICAgICBhbW91bnQsXHJcbiAgICAgIHRva2VuLFxyXG4gICAgICBzdGF0dXM6ICdwZW5kaW5nX3BheW1lbnQnLFxyXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgcGxhdGZvcm1GZWUsXHJcbiAgICAgIG5ldEFtb3VudFxyXG4gICAgfVxyXG5cclxuICAgIGF3YWl0IHRoaXMuc2F2ZUVzY3Jvdyhlc2Nyb3cpXHJcblxyXG4gICAgLy8g0JvQvtCz0LjRgNGD0LXQvCDRgdC+0LfQtNCw0L3QuNC1IGVzY3Jvd1xyXG4gICAgYXdhaXQgdGhpcy5sb2dUcmFuc2FjdGlvbih7XHJcbiAgICAgIHR5cGU6ICdlc2Nyb3dfY3JlYXRlZCcsXHJcbiAgICAgIHVzZXJJZDogY2xpZW50SWQsXHJcbiAgICAgIHRhc2tJZCxcclxuICAgICAgZXNjcm93QWRkcmVzczogZXNjcm93LmVzY3Jvd0FkZHJlc3MsXHJcbiAgICAgIGFtb3VudCxcclxuICAgICAgdG9rZW4sXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICB9KVxyXG5cclxuICAgIHJldHVybiBlc2Nyb3dcclxuICB9XHJcblxyXG4gIC8vINCf0YDQvtCy0LXRgNC60LAg0L/QvtGB0YLRg9C/0LvQtdC90LjRjyDRgdGA0LXQtNGB0YLQsiDQvdCwIGVzY3Jvd1xyXG4gIGFzeW5jIGNoZWNrRXNjcm93RnVuZGluZyhlc2Nyb3dBZGRyZXNzOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGVzY3JvdyA9IGF3YWl0IHRoaXMuZ2V0RXNjcm93QnlBZGRyZXNzKGVzY3Jvd0FkZHJlc3MpXHJcbiAgICAgIGlmICghZXNjcm93IHx8IGVzY3Jvdy5zdGF0dXMgIT09ICdwZW5kaW5nX3BheW1lbnQnKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGxldCBiYWxhbmNlID0gMFxyXG4gICAgICBpZiAoZXNjcm93LnRva2VuID09PSAnU09MJykge1xyXG4gICAgICAgIGJhbGFuY2UgPSBhd2FpdCB0aGlzLmNvbm5lY3Rpb24uZ2V0QmFsYW5jZShuZXcgUHVibGljS2V5KGVzY3Jvd0FkZHJlc3MpKVxyXG4gICAgICAgIGJhbGFuY2UgPSBiYWxhbmNlIC8gTEFNUE9SVFNfUEVSX1NPTFxyXG4gICAgICB9XHJcbiAgICAgIC8vIFRPRE86INCU0L7QsdCw0LLQuNGC0Ywg0L/RgNC+0LLQtdGA0LrRgyDQtNC70Y8gU1BMINGC0L7QutC10L3QvtCyXHJcblxyXG4gICAgICAvLyDQn9GA0L7QstC10YDRj9C10LwsINC00L7RgdGC0LDRgtC+0YfQvdC+INC70Lgg0YHRgNC10LTRgdGC0LIgKNGBINC90LXQsdC+0LvRjNGI0L7QuSDQv9C+0LPRgNC10YjQvdC+0YHRgtGM0Y4pXHJcbiAgICAgIGlmIChiYWxhbmNlID49IGVzY3Jvdy5hbW91bnQgKiAwLjk5KSB7IC8vIDElINC/0L7Qs9GA0LXRiNC90L7RgdGC0Ywg0L3QsCDQutC+0LzQuNGB0YHQuNC4INGB0LXRgtC4XHJcbiAgICAgICAgYXdhaXQgdGhpcy5tYXJrRXNjcm93QXNGdW5kZWQoZXNjcm93QWRkcmVzcylcclxuICAgICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4gZmFsc2VcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNoZWNraW5nIGVzY3JvdyBmdW5kaW5nOicsIGVycm9yKVxyXG4gICAgICByZXR1cm4gZmFsc2VcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vINCX0LDQstC10YDRiNC10L3QuNC1INC30LDQtNCw0YfQuCDQuCDQv9C10YDQtdCy0L7QtCDRgdGA0LXQtNGB0YLQslxyXG4gIGFzeW5jIGNvbXBsZXRlVGFza0FuZFRyYW5zZmVyKHRhc2tJZDogc3RyaW5nLCB3b3JrZXJJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IHR4SGFzaD86IHN0cmluZzsgZXJyb3I/OiBzdHJpbmcgfT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZXNjcm93ID0gYXdhaXQgdGhpcy5nZXRFc2Nyb3dCeVRhc2tJZCh0YXNrSWQpXHJcbiAgICAgIGlmICghZXNjcm93IHx8IGVzY3Jvdy5zdGF0dXMgIT09ICdmdW5kZWQnKSB7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRXNjcm93IG5vdCBmb3VuZCBvciBub3QgZnVuZGVkJyB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHdvcmtlcldhbGxldCA9IGF3YWl0IHRoaXMuZ2V0VXNlcldhbGxldCh3b3JrZXJJZClcclxuICAgICAgaWYgKCF3b3JrZXJXYWxsZXQpIHtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdXb3JrZXIgd2FsbGV0IG5vdCBmb3VuZCcgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDQodC+0LfQtNCw0LXQvCDRgtGA0LDQvdC30LDQutGG0LjRjiDQtNC70Y8g0L/QtdGA0LXQstC+0LTQsCAo0YLQvtC70YzQutC+INC00LvRjyBTT0wg0L/QvtC60LApXHJcbiAgICAgIGlmIChlc2Nyb3cudG9rZW4gPT09ICdTT0wnKSB7XHJcbiAgICAgICAgY29uc3QgZXNjcm93S2V5cGFpciA9IHRoaXMuZGVjcnlwdFByaXZhdGVLZXkoZXNjcm93LmVzY3Jvd1ByaXZhdGVLZXkpXHJcbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBuZXcgVHJhbnNhY3Rpb24oKVxyXG5cclxuICAgICAgICAvLyDQn9C10YDQtdCy0L7QtCBTT0wg0LjRgdC/0L7Qu9C90LjRgtC10LvRjlxyXG4gICAgICAgIGNvbnN0IHdvcmtlclRyYW5zZmVyID0gU3lzdGVtUHJvZ3JhbS50cmFuc2Zlcih7XHJcbiAgICAgICAgICBmcm9tUHVia2V5OiBuZXcgUHVibGljS2V5KGVzY3Jvdy5lc2Nyb3dBZGRyZXNzKSxcclxuICAgICAgICAgIHRvUHVia2V5OiBuZXcgUHVibGljS2V5KHdvcmtlcldhbGxldC5wdWJsaWNLZXkpLFxyXG4gICAgICAgICAgbGFtcG9ydHM6IE1hdGguZmxvb3IoZXNjcm93Lm5ldEFtb3VudCAqIExBTVBPUlRTX1BFUl9TT0wpXHJcbiAgICAgICAgfSlcclxuICAgICAgICB0cmFuc2FjdGlvbi5hZGQod29ya2VyVHJhbnNmZXIpXHJcblxyXG4gICAgICAgIGNvbnN0IFdPUktMWV9UUkVBU1VSWV9XQUxMRVQgPSBcIjI1Wlg1Q2ZjOFB4eTdFbnN2SjZKTmJqYnE0YzhFOWVGdVByendqVWFiRjRlXCJcclxuICAgICAgICBjb25zdCBwbGF0Zm9ybVRyYW5zZmVyID0gU3lzdGVtUHJvZ3JhbS50cmFuc2Zlcih7XHJcbiAgICAgICAgICBmcm9tUHVia2V5OiBuZXcgUHVibGljS2V5KGVzY3Jvdy5lc2Nyb3dBZGRyZXNzKSxcclxuICAgICAgICAgIHRvUHVia2V5OiBuZXcgUHVibGljS2V5KFdPUktMWV9UUkVBU1VSWV9XQUxMRVQpLFxyXG4gICAgICAgICAgbGFtcG9ydHM6IE1hdGguZmxvb3IoZXNjcm93LnBsYXRmb3JtRmVlICogTEFNUE9SVFNfUEVSX1NPTClcclxuICAgICAgICB9KVxyXG4gICAgICAgIHRyYW5zYWN0aW9uLmFkZChwbGF0Zm9ybVRyYW5zZmVyKVxyXG5cclxuICAgICAgICBjb25zdCB0eEhhc2ggPSBhd2FpdCBzZW5kQW5kQ29uZmlybVRyYW5zYWN0aW9uKFxyXG4gICAgICAgICAgdGhpcy5jb25uZWN0aW9uLFxyXG4gICAgICAgICAgdHJhbnNhY3Rpb24sXHJcbiAgICAgICAgICBbZXNjcm93S2V5cGFpcl0sXHJcbiAgICAgICAgICB7IGNvbW1pdG1lbnQ6ICdjb25maXJtZWQnIH1cclxuICAgICAgICApXHJcblxyXG4gICAgICAgIC8vINCe0LHQvdC+0LLQu9GP0LXQvCDRgdGC0LDRgtGD0YEgZXNjcm93XHJcbiAgICAgICAgYXdhaXQgdGhpcy5tYXJrRXNjcm93QXNDb21wbGV0ZWQoZXNjcm93LmVzY3Jvd0FkZHJlc3MsIHR4SGFzaClcclxuXHJcbiAgICAgICAgLy8g0J7QsdC90L7QstC70Y/QtdC8INCx0LDQu9Cw0L3RgdGLINC/0L7Qu9GM0LfQvtCy0LDRgtC10LvQtdC5XHJcbiAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVVc2VyQmFsYW5jZSh3b3JrZXJJZCwgZXNjcm93Lm5ldEFtb3VudCwgZXNjcm93LnRva2VuLCAnZWFybmVkJylcclxuICAgICAgICBhd2FpdCB0aGlzLnVwZGF0ZVVzZXJCYWxhbmNlKGVzY3Jvdy5jbGllbnRJZCwgZXNjcm93LmFtb3VudCwgZXNjcm93LnRva2VuLCAnc3BlbnQnKVxyXG5cclxuICAgICAgICAvLyDQndCw0YfQuNGB0LvRj9C10LwgV09SS0xZINGC0L7QutC10L3RiyDQt9CwINC30LDQstC10YDRiNC10L3QuNC1INC30LDQtNCw0YfQuFxyXG4gICAgICAgIGF3YWl0IHRoaXMucmV3YXJkV29ya2x5VG9rZW5zKHdvcmtlcklkLCBlc2Nyb3cubmV0QW1vdW50KVxyXG5cclxuICAgICAgICAvLyDQm9C+0LPQuNGA0YPQtdC8INGC0YDQsNC90LfQsNC60YbQuNGOXHJcbiAgICAgICAgYXdhaXQgdGhpcy5sb2dUcmFuc2FjdGlvbih7XHJcbiAgICAgICAgICB0eXBlOiAndGFza19jb21wbGV0ZWQnLFxyXG4gICAgICAgICAgdXNlcklkOiB3b3JrZXJJZCxcclxuICAgICAgICAgIHRhc2tJZCxcclxuICAgICAgICAgIGFtb3VudDogZXNjcm93Lm5ldEFtb3VudCxcclxuICAgICAgICAgIHRva2VuOiBlc2Nyb3cudG9rZW4sXHJcbiAgICAgICAgICB0eEhhc2gsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHR4SGFzaCB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ09ubHkgU09MIHRyYW5zZmVycyBzdXBwb3J0ZWQgY3VycmVudGx5JyB9XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY29tcGxldGluZyB0YXNrIHRyYW5zZmVyOicsIGVycm9yKVxyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdGYWlsZWQgdG8gdHJhbnNmZXIgZnVuZHMnIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vINCd0LDRh9C40YHQu9C10L3QuNC1IFdPUktMWSDRgtC+0LrQtdC90L7QsiDQt9CwINCw0LrRgtC40LLQvdC+0YHRgtGMXHJcbiAgYXN5bmMgcmV3YXJkV29ya2x5VG9rZW5zKHVzZXJJZDogc3RyaW5nLCBlYXJuZWRBbW91bnQ6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8g0KTQvtGA0LzRg9C70LA6IDElINC+0YIg0LfQsNGA0LDQsdC+0YLQsNC90L3QvtC5INGB0YPQvNC80Ysg0LIgV09SS0xZINGC0L7QutC10L3QsNGFXHJcbiAgICAgIGNvbnN0IHdvcmtseVJld2FyZCA9IGVhcm5lZEFtb3VudCAqIDAuMDFcclxuXHJcbiAgICAgIGNvbnN0IHVzZXJXYWxsZXQgPSBhd2FpdCB0aGlzLmdldFVzZXJXYWxsZXQodXNlcklkKVxyXG4gICAgICBpZiAodXNlcldhbGxldCkge1xyXG4gICAgICAgIHVzZXJXYWxsZXQud29ya2x5QmFsYW5jZSArPSB3b3JrbHlSZXdhcmRcclxuICAgICAgICB1c2VyV2FsbGV0Lmxhc3RVcGRhdGVkID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlV2FsbGV0KHVzZXJXYWxsZXQpXHJcblxyXG4gICAgICAgIGF3YWl0IHRoaXMubG9nVHJhbnNhY3Rpb24oe1xyXG4gICAgICAgICAgdHlwZTogJ3dvcmtseV9yZXdhcmQnLFxyXG4gICAgICAgICAgdXNlcklkLFxyXG4gICAgICAgICAgYW1vdW50OiB3b3JrbHlSZXdhcmQsXHJcbiAgICAgICAgICB0b2tlbjogJ1dPUktMWScsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJld2FyZGluZyBXT1JLTFkgdG9rZW5zOicsIGVycm9yKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8g0J/RgNC40LzQtdC90LXQvdC40LUg0YHQutC40LTQutC4IFdPUktMWSDRgtC+0LrQtdC90LAg0L3QsCDQutC+0LzQuNGB0YHQuNC4XHJcbiAgY2FsY3VsYXRlRGlzY291bnRlZEZlZShhbW91bnQ6IG51bWJlciwgd29ya2x5QmFsYW5jZTogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgIGNvbnN0IGJhc2VGZWUgPSB0aGlzLmNhbGN1bGF0ZVBsYXRmb3JtRmVlKGFtb3VudClcclxuXHJcbiAgICBpZiAod29ya2x5QmFsYW5jZSA+PSAxMDAwKSB7XHJcbiAgICAgIHJldHVybiBiYXNlRmVlICogMC41IC8vIDUwJSDRgdC60LjQtNC60LBcclxuICAgIH0gZWxzZSBpZiAod29ya2x5QmFsYW5jZSA+PSA1MDApIHtcclxuICAgICAgcmV0dXJuIGJhc2VGZWUgKiAwLjcgLy8gMzAlINGB0LrQuNC00LrQsFxyXG4gICAgfSBlbHNlIGlmICh3b3JrbHlCYWxhbmNlID49IDEwMCkge1xyXG4gICAgICByZXR1cm4gYmFzZUZlZSAqIDAuODUgLy8gMTUlINGB0LrQuNC00LrQsFxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBiYXNlRmVlXHJcbiAgfVxyXG5cclxuICAvLyDQktGB0L/QvtC80L7Qs9Cw0YLQtdC70YzQvdGL0LUg0LzQtdGC0L7QtNGLXHJcbiAgcHJpdmF0ZSBjYWxjdWxhdGVQbGF0Zm9ybUZlZShhbW91bnQ6IG51bWJlcik6IG51bWJlciB7XHJcbiAgICByZXR1cm4gYW1vdW50ICogMC4wMjUgLy8gMi41JVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBlbmNyeXB0UHJpdmF0ZUtleShwcml2YXRlS2V5OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgLy8g0JIg0L/RgNC+0LTQsNC60YjQtdC90LUg0LjRgdC/0L7Qu9GM0LfQvtCy0LDRgtGMINGA0LXQsNC70YzQvdC+0LUg0YjQuNGE0YDQvtCy0LDQvdC40LVcclxuICAgIHJldHVybiBCdWZmZXIuZnJvbShwcml2YXRlS2V5KS50b1N0cmluZygnYmFzZTY0JylcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZGVjcnlwdFByaXZhdGVLZXkoZW5jcnlwdGVkS2V5OiBzdHJpbmcpOiBLZXlwYWlyIHtcclxuICAgIC8vINCSINC/0YDQvtC00LDQutGI0LXQvdC1INC40YHQv9C+0LvRjNC30L7QstCw0YLRjCDRgNC10LDQu9GM0L3QvtC1INGA0LDRgdGI0LjRhNGA0L7QstCw0L3QuNC1XHJcbiAgICBjb25zdCBwcml2YXRlS2V5ID0gQnVmZmVyLmZyb20oZW5jcnlwdGVkS2V5LCAnYmFzZTY0JykudG9TdHJpbmcoKVxyXG4gICAgcmV0dXJuIEtleXBhaXIuZnJvbVNlY3JldEtleShiczU4LmRlY29kZShwcml2YXRlS2V5KSlcclxuICB9XHJcblxyXG4gIC8vINCc0LXRgtC+0LTRiyDRgNCw0LHQvtGC0Ysg0YEg0YTQsNC50LvQsNC80LggKNC30LDQvNC10L3QuNGC0Ywg0L3QsCDQkdCUINCyINC/0YDQvtC00LDQutGI0LXQvdC1KVxyXG4gIHByaXZhdGUgYXN5bmMgc2F2ZVdhbGxldCh3YWxsZXQ6IFVzZXJXYWxsZXQpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKVxyXG4gICAgY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKVxyXG5cclxuICAgIGNvbnN0IGZpbGVQYXRoID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIHRoaXMud2FsbGV0c0ZpbGUpXHJcbiAgICBjb25zdCBkaXIgPSBwYXRoLmRpcm5hbWUoZmlsZVBhdGgpXHJcblxyXG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKGRpcikpIHtcclxuICAgICAgZnMubWtkaXJTeW5jKGRpciwgeyByZWN1cnNpdmU6IHRydWUgfSlcclxuICAgIH1cclxuXHJcbiAgICBsZXQgd2FsbGV0cyA9IFtdXHJcbiAgICBpZiAoZnMuZXhpc3RzU3luYyhmaWxlUGF0aCkpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBkYXRhID0gZnMucmVhZEZpbGVTeW5jKGZpbGVQYXRoLCAndXRmOCcpXHJcbiAgICAgICAgd2FsbGV0cyA9IEpTT04ucGFyc2UoZGF0YSlcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICB3YWxsZXRzID0gW11cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGV4aXN0aW5nSW5kZXggPSB3YWxsZXRzLmZpbmRJbmRleCgodzogVXNlcldhbGxldCkgPT4gdy51c2VySWQgPT09IHdhbGxldC51c2VySWQpXHJcbiAgICBpZiAoZXhpc3RpbmdJbmRleCA+PSAwKSB7XHJcbiAgICAgIHdhbGxldHNbZXhpc3RpbmdJbmRleF0gPSB3YWxsZXRcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHdhbGxldHMucHVzaCh3YWxsZXQpXHJcbiAgICB9XHJcblxyXG4gICAgZnMud3JpdGVGaWxlU3luYyhmaWxlUGF0aCwgSlNPTi5zdHJpbmdpZnkod2FsbGV0cywgbnVsbCwgMikpXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGdldFVzZXJXYWxsZXQodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJXYWxsZXQgfCBudWxsPiB7XHJcbiAgICBjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJylcclxuICAgIGNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJylcclxuXHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCB0aGlzLndhbGxldHNGaWxlKVxyXG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKGZpbGVQYXRoKSkgcmV0dXJuIG51bGxcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBkYXRhID0gZnMucmVhZEZpbGVTeW5jKGZpbGVQYXRoLCAndXRmOCcpXHJcbiAgICAgIGNvbnN0IHdhbGxldHMgPSBKU09OLnBhcnNlKGRhdGEpXHJcbiAgICAgIHJldHVybiB3YWxsZXRzLmZpbmQoKHc6IFVzZXJXYWxsZXQpID0+IHcudXNlcklkID09PSB1c2VySWQpIHx8IG51bGxcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHJldHVybiBudWxsXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIHNhdmVFc2Nyb3coZXNjcm93OiBFc2Nyb3dBY2NvdW50KTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJylcclxuICAgIGNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJylcclxuXHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCB0aGlzLmVzY3Jvd3NGaWxlKVxyXG4gICAgY29uc3QgZGlyID0gcGF0aC5kaXJuYW1lKGZpbGVQYXRoKVxyXG5cclxuICAgIGlmICghZnMuZXhpc3RzU3luYyhkaXIpKSB7XHJcbiAgICAgIGZzLm1rZGlyU3luYyhkaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pXHJcbiAgICB9XHJcblxyXG4gICAgbGV0IGVzY3Jvd3MgPSBbXVxyXG4gICAgaWYgKGZzLmV4aXN0c1N5bmMoZmlsZVBhdGgpKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwgJ3V0ZjgnKVxyXG4gICAgICAgIGVzY3Jvd3MgPSBKU09OLnBhcnNlKGRhdGEpXHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgZXNjcm93cyA9IFtdXHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBleGlzdGluZ0luZGV4ID0gZXNjcm93cy5maW5kSW5kZXgoKGU6IEVzY3Jvd0FjY291bnQpID0+IGUudGFza0lkID09PSBlc2Nyb3cudGFza0lkKVxyXG4gICAgaWYgKGV4aXN0aW5nSW5kZXggPj0gMCkge1xyXG4gICAgICBlc2Nyb3dzW2V4aXN0aW5nSW5kZXhdID0gZXNjcm93XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBlc2Nyb3dzLnB1c2goZXNjcm93KVxyXG4gICAgfVxyXG5cclxuICAgIGZzLndyaXRlRmlsZVN5bmMoZmlsZVBhdGgsIEpTT04uc3RyaW5naWZ5KGVzY3Jvd3MsIG51bGwsIDIpKVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBnZXRFc2Nyb3dCeUFkZHJlc3MoZXNjcm93QWRkcmVzczogc3RyaW5nKTogUHJvbWlzZTxFc2Nyb3dBY2NvdW50IHwgbnVsbD4ge1xyXG4gICAgY29uc3QgZnMgPSByZXF1aXJlKCdmcycpXHJcbiAgICBjb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpXHJcblxyXG4gICAgY29uc3QgZmlsZVBhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgdGhpcy5lc2Nyb3dzRmlsZSlcclxuICAgIGlmICghZnMuZXhpc3RzU3luYyhmaWxlUGF0aCkpIHJldHVybiBudWxsXHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZGF0YSA9IGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwgJ3V0ZjgnKVxyXG4gICAgICBjb25zdCBlc2Nyb3dzID0gSlNPTi5wYXJzZShkYXRhKVxyXG4gICAgICByZXR1cm4gZXNjcm93cy5maW5kKChlOiBFc2Nyb3dBY2NvdW50KSA9PiBlLmVzY3Jvd0FkZHJlc3MgPT09IGVzY3Jvd0FkZHJlc3MpIHx8IG51bGxcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHJldHVybiBudWxsXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIGdldEVzY3Jvd0J5VGFza0lkKHRhc2tJZDogc3RyaW5nKTogUHJvbWlzZTxFc2Nyb3dBY2NvdW50IHwgbnVsbD4ge1xyXG4gICAgY29uc3QgZnMgPSByZXF1aXJlKCdmcycpXHJcbiAgICBjb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpXHJcblxyXG4gICAgY29uc3QgZmlsZVBhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgdGhpcy5lc2Nyb3dzRmlsZSlcclxuICAgIGlmICghZnMuZXhpc3RzU3luYyhmaWxlUGF0aCkpIHJldHVybiBudWxsXHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZGF0YSA9IGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwgJ3V0ZjgnKVxyXG4gICAgICBjb25zdCBlc2Nyb3dzID0gSlNPTi5wYXJzZShkYXRhKVxyXG4gICAgICByZXR1cm4gZXNjcm93cy5maW5kKChlOiBFc2Nyb3dBY2NvdW50KSA9PiBlLnRhc2tJZCA9PT0gdGFza0lkKSB8fCBudWxsXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICByZXR1cm4gbnVsbFxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBtYXJrRXNjcm93QXNGdW5kZWQoZXNjcm93QWRkcmVzczogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBjb25zdCBlc2Nyb3cgPSBhd2FpdCB0aGlzLmdldEVzY3Jvd0J5QWRkcmVzcyhlc2Nyb3dBZGRyZXNzKVxyXG4gICAgaWYgKGVzY3Jvdykge1xyXG4gICAgICBlc2Nyb3cuc3RhdHVzID0gJ2Z1bmRlZCdcclxuICAgICAgZXNjcm93LmZ1bmRlZEF0ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgIGF3YWl0IHRoaXMuc2F2ZUVzY3Jvdyhlc2Nyb3cpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIG1hcmtFc2Nyb3dBc0NvbXBsZXRlZChlc2Nyb3dBZGRyZXNzOiBzdHJpbmcsIHR4SGFzaDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBjb25zdCBlc2Nyb3cgPSBhd2FpdCB0aGlzLmdldEVzY3Jvd0J5QWRkcmVzcyhlc2Nyb3dBZGRyZXNzKVxyXG4gICAgaWYgKGVzY3Jvdykge1xyXG4gICAgICBlc2Nyb3cuc3RhdHVzID0gJ2NvbXBsZXRlZCdcclxuICAgICAgZXNjcm93LmNvbXBsZXRlZEF0ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgIGF3YWl0IHRoaXMuc2F2ZUVzY3Jvdyhlc2Nyb3cpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIHVwZGF0ZVVzZXJCYWxhbmNlKHVzZXJJZDogc3RyaW5nLCBhbW91bnQ6IG51bWJlciwgdG9rZW46IHN0cmluZywgdHlwZTogJ2Vhcm5lZCcgfCAnc3BlbnQnIHwgJ3dpdGhkcmF3bicpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGNvbnN0IHdhbGxldCA9IGF3YWl0IHRoaXMuZ2V0VXNlcldhbGxldCh1c2VySWQpXHJcbiAgICBpZiAoIXdhbGxldCkgcmV0dXJuXHJcblxyXG4gICAgaWYgKHR5cGUgPT09ICdlYXJuZWQnKSB7XHJcbiAgICAgIHN3aXRjaCAodG9rZW4pIHtcclxuICAgICAgICBjYXNlICdTT0wnOiB3YWxsZXQuc29sQmFsYW5jZSArPSBhbW91bnQ7IGJyZWFrXHJcbiAgICAgICAgY2FzZSAnVVNEVCc6IHdhbGxldC51c2R0QmFsYW5jZSArPSBhbW91bnQ7IGJyZWFrXHJcbiAgICAgICAgY2FzZSAnVVNEQyc6IHdhbGxldC51c2RjQmFsYW5jZSArPSBhbW91bnQ7IGJyZWFrXHJcbiAgICAgIH1cclxuICAgICAgd2FsbGV0LnRvdGFsRWFybmVkICs9IGFtb3VudFxyXG4gICAgfSBlbHNlIGlmICh0eXBlID09PSAnc3BlbnQnKSB7XHJcbiAgICAgIHdhbGxldC50b3RhbFNwZW50ICs9IGFtb3VudFxyXG4gICAgfSBlbHNlIGlmICh0eXBlID09PSAnd2l0aGRyYXduJykge1xyXG4gICAgICBzd2l0Y2ggKHRva2VuKSB7XHJcbiAgICAgICAgY2FzZSAnU09MJzogd2FsbGV0LnNvbEJhbGFuY2UgLT0gYW1vdW50OyBicmVha1xyXG4gICAgICAgIGNhc2UgJ1VTRFQnOiB3YWxsZXQudXNkdEJhbGFuY2UgLT0gYW1vdW50OyBicmVha1xyXG4gICAgICAgIGNhc2UgJ1VTREMnOiB3YWxsZXQudXNkY0JhbGFuY2UgLT0gYW1vdW50OyBicmVha1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgd2FsbGV0Lmxhc3RVcGRhdGVkID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICBhd2FpdCB0aGlzLnNhdmVXYWxsZXQod2FsbGV0KVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBsb2dUcmFuc2FjdGlvbih0cmFuc2FjdGlvbjogYW55KTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJylcclxuICAgIGNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJylcclxuXHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCB0aGlzLnRyYW5zYWN0aW9uc0ZpbGUpXHJcbiAgICBjb25zdCBkaXIgPSBwYXRoLmRpcm5hbWUoZmlsZVBhdGgpXHJcblxyXG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKGRpcikpIHtcclxuICAgICAgZnMubWtkaXJTeW5jKGRpciwgeyByZWN1cnNpdmU6IHRydWUgfSlcclxuICAgIH1cclxuXHJcbiAgICBsZXQgdHJhbnNhY3Rpb25zID0gW11cclxuICAgIGlmIChmcy5leGlzdHNTeW5jKGZpbGVQYXRoKSkge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGRhdGEgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZVBhdGgsICd1dGY4JylcclxuICAgICAgICB0cmFuc2FjdGlvbnMgPSBKU09OLnBhcnNlKGRhdGEpXHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgdHJhbnNhY3Rpb25zID0gW11cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHRyYW5zYWN0aW9ucy5wdXNoKHtcclxuICAgICAgaWQ6IERhdGUubm93KCkudG9TdHJpbmcoKSxcclxuICAgICAgLi4udHJhbnNhY3Rpb25cclxuICAgIH0pXHJcblxyXG4gICAgZnMud3JpdGVGaWxlU3luYyhmaWxlUGF0aCwgSlNPTi5zdHJpbmdpZnkodHJhbnNhY3Rpb25zLCBudWxsLCAyKSlcclxuICB9XHJcblxyXG4gIGFzeW5jIHN5bmNXYWxsZXRCYWxhbmNlKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxVc2VyV2FsbGV0IHwgbnVsbD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgd2FsbGV0ID0gYXdhaXQgdGhpcy5nZXRVc2VyV2FsbGV0KHVzZXJJZClcclxuICAgICAgaWYgKCF3YWxsZXQpIHJldHVybiBudWxsXHJcblxyXG4gICAgICAvLyDQn9C+0LvRg9GH0LDQtdC8INGA0LXQsNC70YzQvdGL0Lkg0LHQsNC70LDQvdGBIFNPTCDRgSDQsdC70L7QutGH0LXQudC90LBcclxuICAgICAgY29uc3QgcHVibGljS2V5ID0gbmV3IFB1YmxpY0tleSh3YWxsZXQucHVibGljS2V5KVxyXG4gICAgICBjb25zdCBiYWxhbmNlID0gYXdhaXQgdGhpcy5jb25uZWN0aW9uLmdldEJhbGFuY2UocHVibGljS2V5KVxyXG4gICAgICBjb25zdCBzb2xCYWxhbmNlID0gYmFsYW5jZSAvIExBTVBPUlRTX1BFUl9TT0xcclxuXHJcbiAgICAgIC8vINCe0LHQvdC+0LLQu9GP0LXQvCDQsdCw0LvQsNC90YEg0LIg0LvQvtC60LDQu9GM0L3Ri9GFINC00LDQvdC90YvRhVxyXG4gICAgICB3YWxsZXQuc29sQmFsYW5jZSA9IHNvbEJhbGFuY2VcclxuICAgICAgd2FsbGV0Lmxhc3RVcGRhdGVkID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcblxyXG4gICAgICAvLyDQodC+0YXRgNCw0L3Rj9C10Lwg0L7QsdC90L7QstC70LXQvdC90YvQuSDQutC+0YjQtdC70LXQulxyXG4gICAgICBhd2FpdCB0aGlzLnNhdmVXYWxsZXQod2FsbGV0KVxyXG5cclxuICAgICAgY29uc29sZS5sb2coYFVwZGF0ZWQgYmFsYW5jZSBmb3IgJHt1c2VySWR9OiAke3NvbEJhbGFuY2V9IFNPTGApXHJcbiAgICAgIHJldHVybiB3YWxsZXRcclxuXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzeW5jaW5nIHdhbGxldCBiYWxhbmNlOicsIGVycm9yKVxyXG4gICAgICByZXR1cm4gbnVsbFxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8g0J/Rg9Cx0LvQuNGH0L3Ri9C1INC80LXRgtC+0LTRiyDQtNC70Y8gQVBJXHJcbiAgYXN5bmMgY3JlYXRlV2FsbGV0Rm9yVXNlcih1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8VXNlcldhbGxldD4ge1xyXG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY3JlYXRlVXNlcldhbGxldCh1c2VySWQpXHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRXYWxsZXRJbmZvKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxVc2VyV2FsbGV0IHwgbnVsbD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8g0KHQvdCw0YfQsNC70LAg0L/QvtC70YPRh9Cw0LXQvCDQutC+0YjQtdC70LXQuiDQuNC3INGE0LDQudC70LBcclxuICAgICAgbGV0IHdhbGxldCA9IGF3YWl0IHRoaXMuZ2V0VXNlcldhbGxldCh1c2VySWQpXHJcbiAgICAgIGlmICghd2FsbGV0KSByZXR1cm4gbnVsbFxyXG5cclxuICAgICAgLy8g0KHQuNC90YXRgNC+0L3QuNC30LjRgNGD0LXQvCDQsdCw0LvQsNC90YEg0YEg0LHQu9C+0LrRh9C10LnQvdC+0LxcclxuICAgICAgd2FsbGV0ID0gYXdhaXQgdGhpcy5zeW5jV2FsbGV0QmFsYW5jZSh1c2VySWQpXHJcblxyXG4gICAgICByZXR1cm4gd2FsbGV0XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZXR0aW5nIHdhbGxldCBpbmZvOicsIGVycm9yKVxyXG4gICAgICByZXR1cm4gbnVsbFxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgY3JlYXRlVGFza0VzY3Jvd0FkZHJlc3ModGFza0lkOiBzdHJpbmcsIGNsaWVudElkOiBzdHJpbmcsIGFtb3VudDogbnVtYmVyLCB0b2tlbjogJ1NPTCcgfCAnVVNEVCcgfCAnVVNEQycpOiBQcm9taXNlPEVzY3Jvd0FjY291bnQ+IHtcclxuICAgIHJldHVybiBhd2FpdCB0aGlzLmNyZWF0ZVRhc2tFc2Nyb3codGFza0lkLCBjbGllbnRJZCwgYW1vdW50LCB0b2tlbilcclxuICB9XHJcblxyXG4gIGFzeW5jIGNoZWNrVGFza0Z1bmRpbmcodGFza0lkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgIGNvbnN0IGVzY3JvdyA9IGF3YWl0IHRoaXMuZ2V0RXNjcm93QnlUYXNrSWQodGFza0lkKVxyXG4gICAgaWYgKCFlc2Nyb3cpIHJldHVybiBmYWxzZVxyXG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY2hlY2tFc2Nyb3dGdW5kaW5nKGVzY3Jvdy5lc2Nyb3dBZGRyZXNzKVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgY29tcGxldGVUYXNrKHRhc2tJZDogc3RyaW5nLCB3b3JrZXJJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IHR4SGFzaD86IHN0cmluZzsgZXJyb3I/OiBzdHJpbmcgfT4ge1xyXG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY29tcGxldGVUYXNrQW5kVHJhbnNmZXIodGFza0lkLCB3b3JrZXJJZClcclxuICB9XHJcblxyXG4gIC8vINCc0LXRgtC+0LQg0LTQu9GPINCy0YvQstC+0LTQsCDRgdGA0LXQtNGB0YLQslxyXG4gIGFzeW5jIHdpdGhkcmF3RnVuZHModXNlcklkOiBzdHJpbmcsIGFtb3VudDogbnVtYmVyLCB0b0FkZHJlc3M6IHN0cmluZywgdG9rZW46ICdTT0wnID0gJ1NPTCcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgdHhIYXNoPzogc3RyaW5nOyBlcnJvcj86IHN0cmluZyB9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB1c2VyV2FsbGV0ID0gYXdhaXQgdGhpcy5nZXRVc2VyV2FsbGV0KHVzZXJJZClcclxuICAgICAgaWYgKCF1c2VyV2FsbGV0KSB7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnVXNlciB3YWxsZXQgbm90IGZvdW5kJyB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGN1cnJlbnRCYWxhbmNlID0gdXNlcldhbGxldC5zb2xCYWxhbmNlXHJcbiAgICAgIGlmIChhbW91bnQgPiBjdXJyZW50QmFsYW5jZSkge1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0luc3VmZmljaWVudCBiYWxhbmNlJyB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgbmV3IFB1YmxpY0tleSh0b0FkZHJlc3MpXHJcbiAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdJbnZhbGlkIFNvbGFuYSBhZGRyZXNzJyB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChhbW91bnQgPCAwLjAwMSkge1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ01pbmltdW0gd2l0aGRyYXdhbCBhbW91bnQgaXMgMC4wMDEgU09MJyB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHVzZXJLZXlwYWlyID0gdGhpcy5kZWNyeXB0UHJpdmF0ZUtleSh1c2VyV2FsbGV0LnByaXZhdGVLZXkpXHJcbiAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gbmV3IFRyYW5zYWN0aW9uKClcclxuXHJcbiAgICAgIGNvbnN0IHRyYW5zZmVyID0gU3lzdGVtUHJvZ3JhbS50cmFuc2Zlcih7XHJcbiAgICAgICAgZnJvbVB1YmtleTogdXNlcktleXBhaXIucHVibGljS2V5LFxyXG4gICAgICAgIHRvUHVia2V5OiBuZXcgUHVibGljS2V5KHRvQWRkcmVzcyksXHJcbiAgICAgICAgbGFtcG9ydHM6IE1hdGguZmxvb3IoYW1vdW50ICogTEFNUE9SVFNfUEVSX1NPTClcclxuICAgICAgfSlcclxuICAgICAgdHJhbnNhY3Rpb24uYWRkKHRyYW5zZmVyKVxyXG5cclxuICAgICAgY29uc3QgdHhIYXNoID0gYXdhaXQgc2VuZEFuZENvbmZpcm1UcmFuc2FjdGlvbihcclxuICAgICAgICB0aGlzLmNvbm5lY3Rpb24sXHJcbiAgICAgICAgdHJhbnNhY3Rpb24sXHJcbiAgICAgICAgW3VzZXJLZXlwYWlyXSxcclxuICAgICAgICB7IGNvbW1pdG1lbnQ6ICdjb25maXJtZWQnIH1cclxuICAgICAgKVxyXG5cclxuICAgICAgYXdhaXQgdGhpcy51cGRhdGVVc2VyQmFsYW5jZSh1c2VySWQsIGFtb3VudCwgdG9rZW4sICd3aXRoZHJhd24nKVxyXG5cclxuICAgICAgYXdhaXQgdGhpcy5sb2dUcmFuc2FjdGlvbih7XHJcbiAgICAgICAgdHlwZTogJ3dpdGhkcmF3YWwnLFxyXG4gICAgICAgIHVzZXJJZCxcclxuICAgICAgICBhbW91bnQsXHJcbiAgICAgICAgdG9rZW4sXHJcbiAgICAgICAgdG9BZGRyZXNzLFxyXG4gICAgICAgIHR4SGFzaCxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICB9KVxyXG5cclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdHhIYXNoIH1cclxuXHJcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHdpdGhkcmF3aW5nIGZ1bmRzOicsIGVycm9yKVxyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdGYWlsZWQgdG8gcHJvY2VzcyB3aXRoZHJhd2FsJyB9XHJcbiAgICB9XHJcbiAgfSBcclxuXHJcbiAgYXN5bmMgZm9yY2VSZWZyZXNoV2FsbGV0KHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxVc2VyV2FsbGV0IHwgbnVsbD4ge1xyXG4gIGNvbnNvbGUubG9nKGBGb3JjZSByZWZyZXNoaW5nIHdhbGxldCBmb3IgdXNlcjogJHt1c2VySWR9YClcclxuICByZXR1cm4gYXdhaXQgdGhpcy5zeW5jV2FsbGV0QmFsYW5jZSh1c2VySWQpXHJcbn1cclxuXHJcbiAgLy8g0J/Rg9Cx0LvQuNGH0L3Ri9C5INC80LXRgtC+0LQg0LTQu9GPIEFQSVxyXG4gIGFzeW5jIHByb2Nlc3NXaXRoZHJhd2FsKHVzZXJJZDogc3RyaW5nLCBhbW91bnQ6IG51bWJlciwgdG9BZGRyZXNzOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgdHhIYXNoPzogc3RyaW5nOyBlcnJvcj86IHN0cmluZyB9PiB7XHJcbiAgICByZXR1cm4gYXdhaXQgdGhpcy53aXRoZHJhd0Z1bmRzKHVzZXJJZCwgYW1vdW50LCB0b0FkZHJlc3MsICdTT0wnKVxyXG4gIH1cclxufVxyXG4vLyDQrdC60YHQv9C+0YDRgtC40YDRg9C10Lwg0YHQuNC90LPQu9GC0L7QvVxyXG5leHBvcnQgY29uc3Qgd2FsbGV0U2VydmljZSA9IG5ldyBXYWxsZXRTZXJ2aWNlKCkiXSwibmFtZXMiOlsiS2V5cGFpciIsIlB1YmxpY0tleSIsIkNvbm5lY3Rpb24iLCJMQU1QT1JUU19QRVJfU09MIiwiVHJhbnNhY3Rpb24iLCJTeXN0ZW1Qcm9ncmFtIiwic2VuZEFuZENvbmZpcm1UcmFuc2FjdGlvbiIsImJzNTgiLCJXYWxsZXRTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJycGNVcmwiLCJ3YWxsZXRzRmlsZSIsImVzY3Jvd3NGaWxlIiwidHJhbnNhY3Rpb25zRmlsZSIsImNvbm5lY3Rpb24iLCJjcmVhdGVVc2VyV2FsbGV0IiwidXNlcklkIiwia2V5cGFpciIsImdlbmVyYXRlIiwid2FsbGV0IiwicHVibGljS2V5IiwidG9TdHJpbmciLCJwcml2YXRlS2V5IiwiZW5jcnlwdFByaXZhdGVLZXkiLCJlbmNvZGUiLCJzZWNyZXRLZXkiLCJzb2xCYWxhbmNlIiwidXNkdEJhbGFuY2UiLCJ1c2RjQmFsYW5jZSIsIndvcmtseUJhbGFuY2UiLCJ0b3RhbEVhcm5lZCIsInRvdGFsU3BlbnQiLCJjcmVhdGVkQXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJsYXN0VXBkYXRlZCIsInNhdmVXYWxsZXQiLCJsb2dUcmFuc2FjdGlvbiIsInR5cGUiLCJ3YWxsZXRBZGRyZXNzIiwidGltZXN0YW1wIiwiY3JlYXRlVGFza0VzY3JvdyIsInRhc2tJZCIsImNsaWVudElkIiwiYW1vdW50IiwidG9rZW4iLCJlc2Nyb3dLZXlwYWlyIiwicGxhdGZvcm1GZWUiLCJjYWxjdWxhdGVQbGF0Zm9ybUZlZSIsIm5ldEFtb3VudCIsImVzY3JvdyIsImVzY3Jvd0FkZHJlc3MiLCJlc2Nyb3dQcml2YXRlS2V5Iiwic3RhdHVzIiwic2F2ZUVzY3JvdyIsImNoZWNrRXNjcm93RnVuZGluZyIsImdldEVzY3Jvd0J5QWRkcmVzcyIsImJhbGFuY2UiLCJnZXRCYWxhbmNlIiwibWFya0VzY3Jvd0FzRnVuZGVkIiwiZXJyb3IiLCJjb25zb2xlIiwiY29tcGxldGVUYXNrQW5kVHJhbnNmZXIiLCJ3b3JrZXJJZCIsImdldEVzY3Jvd0J5VGFza0lkIiwic3VjY2VzcyIsIndvcmtlcldhbGxldCIsImdldFVzZXJXYWxsZXQiLCJkZWNyeXB0UHJpdmF0ZUtleSIsInRyYW5zYWN0aW9uIiwid29ya2VyVHJhbnNmZXIiLCJ0cmFuc2ZlciIsImZyb21QdWJrZXkiLCJ0b1B1YmtleSIsImxhbXBvcnRzIiwiTWF0aCIsImZsb29yIiwiYWRkIiwiV09SS0xZX1RSRUFTVVJZX1dBTExFVCIsInBsYXRmb3JtVHJhbnNmZXIiLCJ0eEhhc2giLCJjb21taXRtZW50IiwibWFya0VzY3Jvd0FzQ29tcGxldGVkIiwidXBkYXRlVXNlckJhbGFuY2UiLCJyZXdhcmRXb3JrbHlUb2tlbnMiLCJlYXJuZWRBbW91bnQiLCJ3b3JrbHlSZXdhcmQiLCJ1c2VyV2FsbGV0IiwiY2FsY3VsYXRlRGlzY291bnRlZEZlZSIsImJhc2VGZWUiLCJCdWZmZXIiLCJmcm9tIiwiZW5jcnlwdGVkS2V5IiwiZnJvbVNlY3JldEtleSIsImRlY29kZSIsImZzIiwicmVxdWlyZSIsInBhdGgiLCJmaWxlUGF0aCIsImpvaW4iLCJwcm9jZXNzIiwiY3dkIiwiZGlyIiwiZGlybmFtZSIsImV4aXN0c1N5bmMiLCJta2RpclN5bmMiLCJyZWN1cnNpdmUiLCJ3YWxsZXRzIiwiZGF0YSIsInJlYWRGaWxlU3luYyIsIkpTT04iLCJwYXJzZSIsImV4aXN0aW5nSW5kZXgiLCJmaW5kSW5kZXgiLCJ3IiwicHVzaCIsIndyaXRlRmlsZVN5bmMiLCJzdHJpbmdpZnkiLCJmaW5kIiwiZXNjcm93cyIsImUiLCJmdW5kZWRBdCIsImNvbXBsZXRlZEF0IiwidHJhbnNhY3Rpb25zIiwiaWQiLCJub3ciLCJzeW5jV2FsbGV0QmFsYW5jZSIsImxvZyIsImNyZWF0ZVdhbGxldEZvclVzZXIiLCJnZXRXYWxsZXRJbmZvIiwiY3JlYXRlVGFza0VzY3Jvd0FkZHJlc3MiLCJjaGVja1Rhc2tGdW5kaW5nIiwiY29tcGxldGVUYXNrIiwid2l0aGRyYXdGdW5kcyIsInRvQWRkcmVzcyIsImN1cnJlbnRCYWxhbmNlIiwidXNlcktleXBhaXIiLCJmb3JjZVJlZnJlc2hXYWxsZXQiLCJwcm9jZXNzV2l0aGRyYXdhbCIsIndhbGxldFNlcnZpY2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./lib/wallet/walletService.ts\n");

/***/ }),

/***/ "(api)/./pages/api/wallet/info.ts":
/*!**********************************!*\
  !*** ./pages/api/wallet/info.ts ***!
  \**********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jsonwebtoken */ \"jsonwebtoken\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_wallet_walletService__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/wallet/walletService */ \"(api)/./lib/wallet/walletService.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_wallet_walletService__WEBPACK_IMPORTED_MODULE_1__]);\n_lib_wallet_walletService__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// pages/api/wallet/info.ts - API для получения информации о кошельке\n\n\nconst getUserFromToken = (authHeader)=>{\n    if (!authHeader || !authHeader.startsWith(\"Bearer \")) return null;\n    const token = authHeader.split(\" \")[1];\n    try {\n        const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default().verify(token, process.env.JWT_SECRET || \"workly-local-secret-key-2025\");\n        return decoded;\n    } catch (error) {\n        return null;\n    }\n};\nasync function handler(req, res) {\n    if (req.method !== \"GET\") {\n        return res.status(405).json({\n            error: \"Method not allowed\"\n        });\n    }\n    const user = getUserFromToken(req.headers.authorization);\n    if (!user) {\n        return res.status(401).json({\n            error: \"Unauthorized\"\n        });\n    }\n    try {\n        const wallet = await _lib_wallet_walletService__WEBPACK_IMPORTED_MODULE_1__.walletService.getWalletInfo(user.userId);\n        if (!wallet) {\n            return res.status(404).json({\n                error: \"Wallet not found\",\n                needsCreation: true\n            });\n        }\n        res.status(200).json({\n            success: true,\n            wallet: {\n                ...wallet,\n                privateKey: undefined // Не отправляем приватный ключ\n            }\n        });\n    } catch (error) {\n        console.error(\"Get wallet info error:\", error);\n        res.status(500).json({\n            error: \"Internal server error\"\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvd2FsbGV0L2luZm8udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLHFFQUFxRTtBQUV2QztBQUNtQztBQUVqRSxNQUFNRSxtQkFBbUIsQ0FBQ0M7SUFDeEIsSUFBSSxDQUFDQSxjQUFjLENBQUNBLFdBQVdDLFVBQVUsQ0FBQyxZQUFZLE9BQU87SUFFN0QsTUFBTUMsUUFBUUYsV0FBV0csS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFO0lBQ3RDLElBQUk7UUFDRixNQUFNQyxVQUFVUCwwREFBVSxDQUN4QkssT0FDQUksUUFBUUMsR0FBRyxDQUFDQyxVQUFVLElBQUk7UUFFNUIsT0FBT0o7SUFDVCxFQUFFLE9BQU9LLE9BQU87UUFDZCxPQUFPO0lBQ1Q7QUFDRjtBQUVlLGVBQWVDLFFBQVFDLEdBQW1CLEVBQUVDLEdBQW9CO0lBQzdFLElBQUlELElBQUlFLE1BQU0sS0FBSyxPQUFPO1FBQ3hCLE9BQU9ELElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRU4sT0FBTztRQUFxQjtJQUM1RDtJQUVBLE1BQU1PLE9BQU9qQixpQkFBaUJZLElBQUlNLE9BQU8sQ0FBQ0MsYUFBYTtJQUN2RCxJQUFJLENBQUNGLE1BQU07UUFDVCxPQUFPSixJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVOLE9BQU87UUFBZTtJQUN0RDtJQUVBLElBQUk7UUFDRixNQUFNVSxTQUFTLE1BQU1yQixvRUFBYUEsQ0FBQ3NCLGFBQWEsQ0FBQ0osS0FBS0ssTUFBTTtRQUU1RCxJQUFJLENBQUNGLFFBQVE7WUFDWCxPQUFPUCxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUMxQk4sT0FBTztnQkFDUGEsZUFBZTtZQUNqQjtRQUNGO1FBRUFWLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFDbkJRLFNBQVM7WUFDVEosUUFBUTtnQkFDTixHQUFHQSxNQUFNO2dCQUNUSyxZQUFZQyxVQUFVLCtCQUErQjtZQUN2RDtRQUNGO0lBRUYsRUFBRSxPQUFPaEIsT0FBTztRQUNkaUIsUUFBUWpCLEtBQUssQ0FBQywwQkFBMEJBO1FBQ3hDRyxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVOLE9BQU87UUFBd0I7SUFDeEQ7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3Rhc2tjaGFpbi11aS8uL3BhZ2VzL2FwaS93YWxsZXQvaW5mby50cz9iMzAxIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHBhZ2VzL2FwaS93YWxsZXQvaW5mby50cyAtIEFQSSDQtNC70Y8g0L/QvtC70YPRh9C10L3QuNGPINC40L3RhNC+0YDQvNCw0YbQuNC4INC+INC60L7RiNC10LvRjNC60LVcclxuaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnXHJcbmltcG9ydCBqd3QgZnJvbSAnanNvbndlYnRva2VuJ1xyXG5pbXBvcnQgeyB3YWxsZXRTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vbGliL3dhbGxldC93YWxsZXRTZXJ2aWNlJ1xyXG5cclxuY29uc3QgZ2V0VXNlckZyb21Ub2tlbiA9IChhdXRoSGVhZGVyOiBzdHJpbmcgfCB1bmRlZmluZWQpID0+IHtcclxuICBpZiAoIWF1dGhIZWFkZXIgfHwgIWF1dGhIZWFkZXIuc3RhcnRzV2l0aCgnQmVhcmVyICcpKSByZXR1cm4gbnVsbFxyXG4gIFxyXG4gIGNvbnN0IHRva2VuID0gYXV0aEhlYWRlci5zcGxpdCgnICcpWzFdXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGRlY29kZWQgPSBqd3QudmVyaWZ5KFxyXG4gICAgICB0b2tlbixcclxuICAgICAgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCB8fCAnd29ya2x5LWxvY2FsLXNlY3JldC1rZXktMjAyNSdcclxuICAgICkgYXMgeyB1c2VySWQ6IHN0cmluZyB9XHJcbiAgICByZXR1cm4gZGVjb2RlZFxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICByZXR1cm4gbnVsbFxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkge1xyXG4gIGlmIChyZXEubWV0aG9kICE9PSAnR0VUJykge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgZXJyb3I6ICdNZXRob2Qgbm90IGFsbG93ZWQnIH0pXHJcbiAgfVxyXG5cclxuICBjb25zdCB1c2VyID0gZ2V0VXNlckZyb21Ub2tlbihyZXEuaGVhZGVycy5hdXRob3JpemF0aW9uKVxyXG4gIGlmICghdXNlcikge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0pXHJcbiAgfVxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3Qgd2FsbGV0ID0gYXdhaXQgd2FsbGV0U2VydmljZS5nZXRXYWxsZXRJbmZvKHVzZXIudXNlcklkKVxyXG4gICAgXHJcbiAgICBpZiAoIXdhbGxldCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBcclxuICAgICAgICBlcnJvcjogJ1dhbGxldCBub3QgZm91bmQnLFxyXG4gICAgICAgIG5lZWRzQ3JlYXRpb246IHRydWVcclxuICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7XHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgIHdhbGxldDoge1xyXG4gICAgICAgIC4uLndhbGxldCxcclxuICAgICAgICBwcml2YXRlS2V5OiB1bmRlZmluZWQgLy8g0J3QtSDQvtGC0L/RgNCw0LLQu9GP0LXQvCDQv9GA0LjQstCw0YLQvdGL0Lkg0LrQu9GO0YdcclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0dldCB3YWxsZXQgaW5mbyBlcnJvcjonLCBlcnJvcilcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0pXHJcbiAgfVxyXG59Il0sIm5hbWVzIjpbImp3dCIsIndhbGxldFNlcnZpY2UiLCJnZXRVc2VyRnJvbVRva2VuIiwiYXV0aEhlYWRlciIsInN0YXJ0c1dpdGgiLCJ0b2tlbiIsInNwbGl0IiwiZGVjb2RlZCIsInZlcmlmeSIsInByb2Nlc3MiLCJlbnYiLCJKV1RfU0VDUkVUIiwiZXJyb3IiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwibWV0aG9kIiwic3RhdHVzIiwianNvbiIsInVzZXIiLCJoZWFkZXJzIiwiYXV0aG9yaXphdGlvbiIsIndhbGxldCIsImdldFdhbGxldEluZm8iLCJ1c2VySWQiLCJuZWVkc0NyZWF0aW9uIiwic3VjY2VzcyIsInByaXZhdGVLZXkiLCJ1bmRlZmluZWQiLCJjb25zb2xlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/wallet/info.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./pages/api/wallet/info.ts"));
module.exports = __webpack_exports__;

})();