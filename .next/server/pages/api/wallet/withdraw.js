"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/wallet/withdraw";
exports.ids = ["pages/api/wallet/withdraw"];
exports.modules = {

/***/ "@solana/web3.js":
/*!**********************************!*\
  !*** external "@solana/web3.js" ***!
  \**********************************/
/***/ ((module) => {

module.exports = require("@solana/web3.js");

/***/ }),

/***/ "jsonwebtoken":
/*!*******************************!*\
  !*** external "jsonwebtoken" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("jsonwebtoken");

/***/ }),

/***/ "bs58":
/*!***********************!*\
  !*** external "bs58" ***!
  \***********************/
/***/ ((module) => {

module.exports = import("bs58");;

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "(api)/./lib/wallet/walletService.ts":
/*!*************************************!*\
  !*** ./lib/wallet/walletService.ts ***!
  \*************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   WalletService: () => (/* binding */ WalletService),\n/* harmony export */   walletService: () => (/* binding */ walletService)\n/* harmony export */ });\n/* harmony import */ var _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @solana/web3.js */ \"@solana/web3.js\");\n/* harmony import */ var _solana_web3_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_solana_web3_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var bs58__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bs58 */ \"bs58\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([bs58__WEBPACK_IMPORTED_MODULE_1__]);\nbs58__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// lib/wallet/walletService.ts - Основной сервис кошельков\n\n\nclass WalletService {\n    constructor(rpcUrl = \"https://api.devnet.solana.com\"){\n        this.walletsFile = \"data/wallets.json\";\n        this.escrowsFile = \"data/escrow_accounts.json\";\n        this.transactionsFile = \"data/wallet_transactions.json\";\n        this.connection = new _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.Connection(rpcUrl, \"confirmed\");\n    }\n    // Создание кошелька для нового пользователя\n    async createUserWallet(userId) {\n        const keypair = _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.Keypair.generate();\n        const wallet = {\n            userId,\n            publicKey: keypair.publicKey.toString(),\n            privateKey: this.encryptPrivateKey(bs58__WEBPACK_IMPORTED_MODULE_1__[\"default\"].encode(keypair.secretKey)),\n            solBalance: 0,\n            usdtBalance: 0,\n            usdcBalance: 0,\n            worklyBalance: 0,\n            totalEarned: 0,\n            totalSpent: 0,\n            createdAt: new Date().toISOString(),\n            lastUpdated: new Date().toISOString()\n        };\n        await this.saveWallet(wallet);\n        // Логируем создание\n        await this.logTransaction({\n            type: \"wallet_created\",\n            userId,\n            walletAddress: wallet.publicKey,\n            timestamp: new Date().toISOString()\n        });\n        return wallet;\n    }\n    // Создание escrow адреса для задачи\n    async createTaskEscrow(taskId, clientId, amount, token) {\n        const escrowKeypair = _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.Keypair.generate();\n        const platformFee = this.calculatePlatformFee(amount);\n        const netAmount = amount - platformFee;\n        const escrow = {\n            taskId,\n            escrowAddress: escrowKeypair.publicKey.toString(),\n            escrowPrivateKey: this.encryptPrivateKey(bs58__WEBPACK_IMPORTED_MODULE_1__[\"default\"].encode(escrowKeypair.secretKey)),\n            clientId,\n            amount,\n            token,\n            status: \"pending_payment\",\n            createdAt: new Date().toISOString(),\n            platformFee,\n            netAmount\n        };\n        await this.saveEscrow(escrow);\n        // Логируем создание escrow\n        await this.logTransaction({\n            type: \"escrow_created\",\n            userId: clientId,\n            taskId,\n            escrowAddress: escrow.escrowAddress,\n            amount,\n            token,\n            timestamp: new Date().toISOString()\n        });\n        return escrow;\n    }\n    // Проверка поступления средств на escrow\n    async checkEscrowFunding(escrowAddress) {\n        try {\n            const escrow = await this.getEscrowByAddress(escrowAddress);\n            if (!escrow || escrow.status !== \"pending_payment\") {\n                return false;\n            }\n            let balance = 0;\n            if (escrow.token === \"SOL\") {\n                balance = await this.connection.getBalance(new _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.PublicKey(escrowAddress));\n                balance = balance / _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.LAMPORTS_PER_SOL;\n            }\n            // TODO: Добавить проверку для SPL токенов\n            // Проверяем, достаточно ли средств (с небольшой погрешностью)\n            if (balance >= escrow.amount * 0.99) {\n                await this.markEscrowAsFunded(escrowAddress);\n                return true;\n            }\n            return false;\n        } catch (error) {\n            console.error(\"Error checking escrow funding:\", error);\n            return false;\n        }\n    }\n    // Завершение задачи и перевод средств\n    async completeTaskAndTransfer(taskId, workerId) {\n        try {\n            const escrow = await this.getEscrowByTaskId(taskId);\n            if (!escrow || escrow.status !== \"funded\") {\n                return {\n                    success: false,\n                    error: \"Escrow not found or not funded\"\n                };\n            }\n            const workerWallet = await this.getUserWallet(workerId);\n            if (!workerWallet) {\n                return {\n                    success: false,\n                    error: \"Worker wallet not found\"\n                };\n            }\n            // Создаем транзакцию для перевода (только для SOL пока)\n            if (escrow.token === \"SOL\") {\n                const escrowKeypair = this.decryptPrivateKey(escrow.escrowPrivateKey);\n                const transaction = new _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.Transaction();\n                // Перевод SOL исполнителю\n                const workerTransfer = _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.SystemProgram.transfer({\n                    fromPubkey: new _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.PublicKey(escrow.escrowAddress),\n                    toPubkey: new _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.PublicKey(workerWallet.publicKey),\n                    lamports: Math.floor(escrow.netAmount * _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.LAMPORTS_PER_SOL)\n                });\n                transaction.add(workerTransfer);\n                // Перевод комиссии платформе (пока пропускаем)\n                // TODO: Добавить платформенный кошелек\n                const txHash = await (0,_solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.sendAndConfirmTransaction)(this.connection, transaction, [\n                    escrowKeypair\n                ], {\n                    commitment: \"confirmed\"\n                });\n                // Обновляем статус escrow\n                await this.markEscrowAsCompleted(escrow.escrowAddress, txHash);\n                // Обновляем балансы пользователей\n                await this.updateUserBalance(workerId, escrow.netAmount, escrow.token, \"earned\");\n                await this.updateUserBalance(escrow.clientId, escrow.amount, escrow.token, \"spent\");\n                // Начисляем WORKLY токены за завершение задачи\n                await this.rewardWorklyTokens(workerId, escrow.netAmount);\n                // Логируем транзакцию\n                await this.logTransaction({\n                    type: \"task_completed\",\n                    userId: workerId,\n                    taskId,\n                    amount: escrow.netAmount,\n                    token: escrow.token,\n                    txHash,\n                    timestamp: new Date().toISOString()\n                });\n                return {\n                    success: true,\n                    txHash\n                };\n            }\n            return {\n                success: false,\n                error: \"Only SOL transfers supported currently\"\n            };\n        } catch (error) {\n            console.error(\"Error completing task transfer:\", error);\n            return {\n                success: false,\n                error: \"Failed to transfer funds\"\n            };\n        }\n    }\n    // Начисление WORKLY токенов за активность\n    async rewardWorklyTokens(userId, earnedAmount) {\n        try {\n            // Формула: 1% от заработанной суммы в WORKLY токенах\n            const worklyReward = earnedAmount * 0.01;\n            const userWallet = await this.getUserWallet(userId);\n            if (userWallet) {\n                userWallet.worklyBalance += worklyReward;\n                userWallet.lastUpdated = new Date().toISOString();\n                await this.saveWallet(userWallet);\n                await this.logTransaction({\n                    type: \"workly_reward\",\n                    userId,\n                    amount: worklyReward,\n                    token: \"WORKLY\",\n                    timestamp: new Date().toISOString()\n                });\n            }\n        } catch (error) {\n            console.error(\"Error rewarding WORKLY tokens:\", error);\n        }\n    }\n    // Применение скидки WORKLY токена на комиссии\n    calculateDiscountedFee(amount, worklyBalance) {\n        const baseFee = this.calculatePlatformFee(amount);\n        if (worklyBalance >= 1000) {\n            return baseFee * 0.5 // 50% скидка\n            ;\n        } else if (worklyBalance >= 500) {\n            return baseFee * 0.7 // 30% скидка\n            ;\n        } else if (worklyBalance >= 100) {\n            return baseFee * 0.85 // 15% скидка\n            ;\n        }\n        return baseFee;\n    }\n    // Вспомогательные методы\n    calculatePlatformFee(amount) {\n        return amount * 0.025 // 2.5%\n        ;\n    }\n    encryptPrivateKey(privateKey) {\n        // В продакшене использовать реальное шифрование\n        return Buffer.from(privateKey).toString(\"base64\");\n    }\n    decryptPrivateKey(encryptedKey) {\n        // В продакшене использовать реальное расшифрование\n        const privateKey = Buffer.from(encryptedKey, \"base64\").toString();\n        return _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.Keypair.fromSecretKey(bs58__WEBPACK_IMPORTED_MODULE_1__[\"default\"].decode(privateKey));\n    }\n    // Методы работы с файлами (заменить на БД в продакшене)\n    async saveWallet(wallet) {\n        const fs = __webpack_require__(/*! fs */ \"fs\");\n        const path = __webpack_require__(/*! path */ \"path\");\n        const filePath = path.join(process.cwd(), this.walletsFile);\n        const dir = path.dirname(filePath);\n        if (!fs.existsSync(dir)) {\n            fs.mkdirSync(dir, {\n                recursive: true\n            });\n        }\n        let wallets = [];\n        if (fs.existsSync(filePath)) {\n            try {\n                const data = fs.readFileSync(filePath, \"utf8\");\n                wallets = JSON.parse(data);\n            } catch (error) {\n                wallets = [];\n            }\n        }\n        const existingIndex = wallets.findIndex((w)=>w.userId === wallet.userId);\n        if (existingIndex >= 0) {\n            wallets[existingIndex] = wallet;\n        } else {\n            wallets.push(wallet);\n        }\n        fs.writeFileSync(filePath, JSON.stringify(wallets, null, 2));\n    }\n    async getUserWallet(userId) {\n        const fs = __webpack_require__(/*! fs */ \"fs\");\n        const path = __webpack_require__(/*! path */ \"path\");\n        const filePath = path.join(process.cwd(), this.walletsFile);\n        if (!fs.existsSync(filePath)) return null;\n        try {\n            const data = fs.readFileSync(filePath, \"utf8\");\n            const wallets = JSON.parse(data);\n            return wallets.find((w)=>w.userId === userId) || null;\n        } catch (error) {\n            return null;\n        }\n    }\n    async saveEscrow(escrow) {\n        const fs = __webpack_require__(/*! fs */ \"fs\");\n        const path = __webpack_require__(/*! path */ \"path\");\n        const filePath = path.join(process.cwd(), this.escrowsFile);\n        const dir = path.dirname(filePath);\n        if (!fs.existsSync(dir)) {\n            fs.mkdirSync(dir, {\n                recursive: true\n            });\n        }\n        let escrows = [];\n        if (fs.existsSync(filePath)) {\n            try {\n                const data = fs.readFileSync(filePath, \"utf8\");\n                escrows = JSON.parse(data);\n            } catch (error) {\n                escrows = [];\n            }\n        }\n        const existingIndex = escrows.findIndex((e)=>e.taskId === escrow.taskId);\n        if (existingIndex >= 0) {\n            escrows[existingIndex] = escrow;\n        } else {\n            escrows.push(escrow);\n        }\n        fs.writeFileSync(filePath, JSON.stringify(escrows, null, 2));\n    }\n    async getEscrowByAddress(escrowAddress) {\n        const fs = __webpack_require__(/*! fs */ \"fs\");\n        const path = __webpack_require__(/*! path */ \"path\");\n        const filePath = path.join(process.cwd(), this.escrowsFile);\n        if (!fs.existsSync(filePath)) return null;\n        try {\n            const data = fs.readFileSync(filePath, \"utf8\");\n            const escrows = JSON.parse(data);\n            return escrows.find((e)=>e.escrowAddress === escrowAddress) || null;\n        } catch (error) {\n            return null;\n        }\n    }\n    async getEscrowByTaskId(taskId) {\n        const fs = __webpack_require__(/*! fs */ \"fs\");\n        const path = __webpack_require__(/*! path */ \"path\");\n        const filePath = path.join(process.cwd(), this.escrowsFile);\n        if (!fs.existsSync(filePath)) return null;\n        try {\n            const data = fs.readFileSync(filePath, \"utf8\");\n            const escrows = JSON.parse(data);\n            return escrows.find((e)=>e.taskId === taskId) || null;\n        } catch (error) {\n            return null;\n        }\n    }\n    async markEscrowAsFunded(escrowAddress) {\n        const escrow = await this.getEscrowByAddress(escrowAddress);\n        if (escrow) {\n            escrow.status = \"funded\";\n            escrow.fundedAt = new Date().toISOString();\n            await this.saveEscrow(escrow);\n        }\n    }\n    async markEscrowAsCompleted(escrowAddress, txHash) {\n        const escrow = await this.getEscrowByAddress(escrowAddress);\n        if (escrow) {\n            escrow.status = \"completed\";\n            escrow.completedAt = new Date().toISOString();\n            await this.saveEscrow(escrow);\n        }\n    }\n    async updateUserBalance(userId, amount, token, type) {\n        const wallet = await this.getUserWallet(userId);\n        if (!wallet) return;\n        if (type === \"earned\") {\n            switch(token){\n                case \"SOL\":\n                    wallet.solBalance += amount;\n                    break;\n                case \"USDT\":\n                    wallet.usdtBalance += amount;\n                    break;\n                case \"USDC\":\n                    wallet.usdcBalance += amount;\n                    break;\n            }\n            wallet.totalEarned += amount;\n        } else if (type === \"spent\") {\n            wallet.totalSpent += amount;\n        } else if (type === \"withdrawn\") {\n            switch(token){\n                case \"SOL\":\n                    wallet.solBalance -= amount;\n                    break;\n                case \"USDT\":\n                    wallet.usdtBalance -= amount;\n                    break;\n                case \"USDC\":\n                    wallet.usdcBalance -= amount;\n                    break;\n            }\n        }\n        wallet.lastUpdated = new Date().toISOString();\n        await this.saveWallet(wallet);\n    }\n    async logTransaction(transaction) {\n        const fs = __webpack_require__(/*! fs */ \"fs\");\n        const path = __webpack_require__(/*! path */ \"path\");\n        const filePath = path.join(process.cwd(), this.transactionsFile);\n        const dir = path.dirname(filePath);\n        if (!fs.existsSync(dir)) {\n            fs.mkdirSync(dir, {\n                recursive: true\n            });\n        }\n        let transactions = [];\n        if (fs.existsSync(filePath)) {\n            try {\n                const data = fs.readFileSync(filePath, \"utf8\");\n                transactions = JSON.parse(data);\n            } catch (error) {\n                transactions = [];\n            }\n        }\n        transactions.push({\n            id: Date.now().toString(),\n            ...transaction\n        });\n        fs.writeFileSync(filePath, JSON.stringify(transactions, null, 2));\n    }\n    async syncWalletBalance(userId) {\n        try {\n            const wallet = await this.getUserWallet(userId);\n            if (!wallet) return null;\n            // Получаем реальный баланс SOL с блокчейна\n            const publicKey = new _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.PublicKey(wallet.publicKey);\n            const balance = await this.connection.getBalance(publicKey);\n            const solBalance = balance / _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.LAMPORTS_PER_SOL;\n            // Обновляем баланс в локальных данных\n            wallet.solBalance = solBalance;\n            wallet.lastUpdated = new Date().toISOString();\n            // Сохраняем обновленный кошелек\n            await this.saveWallet(wallet);\n            console.log(`Updated balance for ${userId}: ${solBalance} SOL`);\n            return wallet;\n        } catch (error) {\n            console.error(\"Error syncing wallet balance:\", error);\n            return null;\n        }\n    }\n    // Публичные методы для API\n    async createWalletForUser(userId) {\n        return await this.createUserWallet(userId);\n    }\n    async getWalletInfo(userId) {\n        try {\n            // Сначала получаем кошелек из файла\n            let wallet = await this.getUserWallet(userId);\n            if (!wallet) return null;\n            // Синхронизируем баланс с блокчейном\n            wallet = await this.syncWalletBalance(userId);\n            return wallet;\n        } catch (error) {\n            console.error(\"Error getting wallet info:\", error);\n            return null;\n        }\n    }\n    async createTaskEscrowAddress(taskId, clientId, amount, token) {\n        return await this.createTaskEscrow(taskId, clientId, amount, token);\n    }\n    async checkTaskFunding(taskId) {\n        const escrow = await this.getEscrowByTaskId(taskId);\n        if (!escrow) return false;\n        return await this.checkEscrowFunding(escrow.escrowAddress);\n    }\n    async completeTask(taskId, workerId) {\n        return await this.completeTaskAndTransfer(taskId, workerId);\n    }\n    // Метод для вывода средств\n    async withdrawFunds(userId, amount, toAddress, token = \"SOL\") {\n        try {\n            const userWallet = await this.getUserWallet(userId);\n            if (!userWallet) {\n                return {\n                    success: false,\n                    error: \"User wallet not found\"\n                };\n            }\n            const currentBalance = userWallet.solBalance;\n            if (amount > currentBalance) {\n                return {\n                    success: false,\n                    error: \"Insufficient balance\"\n                };\n            }\n            try {\n                new _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.PublicKey(toAddress);\n            } catch (e) {\n                return {\n                    success: false,\n                    error: \"Invalid Solana address\"\n                };\n            }\n            if (amount < 0.001) {\n                return {\n                    success: false,\n                    error: \"Minimum withdrawal amount is 0.001 SOL\"\n                };\n            }\n            const userKeypair = this.decryptPrivateKey(userWallet.privateKey);\n            const transaction = new _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.Transaction();\n            const transfer = _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.SystemProgram.transfer({\n                fromPubkey: userKeypair.publicKey,\n                toPubkey: new _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.PublicKey(toAddress),\n                lamports: Math.floor(amount * _solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.LAMPORTS_PER_SOL)\n            });\n            transaction.add(transfer);\n            const txHash = await (0,_solana_web3_js__WEBPACK_IMPORTED_MODULE_0__.sendAndConfirmTransaction)(this.connection, transaction, [\n                userKeypair\n            ], {\n                commitment: \"confirmed\"\n            });\n            await this.updateUserBalance(userId, amount, token, \"withdrawn\");\n            await this.logTransaction({\n                type: \"withdrawal\",\n                userId,\n                amount,\n                token,\n                toAddress,\n                txHash,\n                timestamp: new Date().toISOString()\n            });\n            return {\n                success: true,\n                txHash\n            };\n        } catch (error) {\n            console.error(\"Error withdrawing funds:\", error);\n            return {\n                success: false,\n                error: \"Failed to process withdrawal\"\n            };\n        }\n    }\n    async forceRefreshWallet(userId) {\n        console.log(`Force refreshing wallet for user: ${userId}`);\n        return await this.syncWalletBalance(userId);\n    }\n    // Публичный метод для API\n    async processWithdrawal(userId, amount, toAddress) {\n        return await this.withdrawFunds(userId, amount, toAddress, \"SOL\");\n    }\n}\n// Экспортируем синглтон\nconst walletService = new WalletService();\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkE7WUFDaEQ7WUFDQWtFLFlBQVlRLEdBQUcsQ0FBQ047WUFFaEIsTUFBTU8sU0FBUyxNQUFNeEUsMEVBQXlCQSxDQUM1QyxJQUFJLENBQUNRLFVBQVUsRUFDZnVELGFBQ0E7Z0JBQUNpRTthQUFZLEVBQ2I7Z0JBQUV2RCxZQUFZO1lBQVk7WUFHNUIsTUFBTSxJQUFJLENBQUNFLGlCQUFpQixDQUFDakUsUUFBUTRCLFFBQVFDLE9BQU87WUFFcEQsTUFBTSxJQUFJLENBQUNSLGNBQWMsQ0FBQztnQkFDeEJDLE1BQU07Z0JBQ050QjtnQkFDQTRCO2dCQUNBQztnQkFDQXVGO2dCQUNBdEQ7Z0JBQ0F0QyxXQUFXLElBQUlQLE9BQU9DLFdBQVc7WUFDbkM7WUFFQSxPQUFPO2dCQUFFK0IsU0FBUztnQkFBTWE7WUFBTztRQUVqQyxFQUFFLE9BQU9sQixPQUFZO1lBQ25CQyxRQUFRRCxLQUFLLENBQUMsNEJBQTRCQTtZQUMxQyxPQUFPO2dCQUFFSyxTQUFTO2dCQUFPTCxPQUFPO1lBQStCO1FBQ2pFO0lBQ0Y7SUFFQSxNQUFNMkUsbUJBQW1CdkgsTUFBYyxFQUE4QjtRQUNyRTZDLFFBQVFnRSxHQUFHLENBQUMsQ0FBQyxrQ0FBa0MsRUFBRTdHLE9BQU8sQ0FBQztRQUN6RCxPQUFPLE1BQU0sSUFBSSxDQUFDNEcsaUJBQWlCLENBQUM1RztJQUN0QztJQUVFLDBCQUEwQjtJQUMxQixNQUFNd0gsa0JBQWtCeEgsTUFBYyxFQUFFNEIsTUFBYyxFQUFFd0YsU0FBaUIsRUFBa0U7UUFDekksT0FBTyxNQUFNLElBQUksQ0FBQ0QsYUFBYSxDQUFDbkgsUUFBUTRCLFFBQVF3RixXQUFXO0lBQzdEO0FBQ0Y7QUFDQSx3QkFBd0I7QUFDakIsTUFBTUssZ0JBQWdCLElBQUlqSSxnQkFBZSIsInNvdXJjZXMiOlsid2VicGFjazovL3Rhc2tjaGFpbi11aS8uL2xpYi93YWxsZXQvd2FsbGV0U2VydmljZS50cz84Y2Q0Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGxpYi93YWxsZXQvd2FsbGV0U2VydmljZS50cyAtINCe0YHQvdC+0LLQvdC+0Lkg0YHQtdGA0LLQuNGBINC60L7RiNC10LvRjNC60L7QslxyXG5pbXBvcnQgeyBLZXlwYWlyLCBQdWJsaWNLZXksIENvbm5lY3Rpb24sIExBTVBPUlRTX1BFUl9TT0wsIFRyYW5zYWN0aW9uLCBTeXN0ZW1Qcm9ncmFtLCBzZW5kQW5kQ29uZmlybVRyYW5zYWN0aW9uIH0gZnJvbSAnQHNvbGFuYS93ZWIzLmpzJ1xyXG5pbXBvcnQgYnM1OCBmcm9tICdiczU4J1xyXG5cclxuLy8g0KLQuNC/0YtcclxuaW50ZXJmYWNlIFVzZXJXYWxsZXQge1xyXG4gIHVzZXJJZDogc3RyaW5nXHJcbiAgcHVibGljS2V5OiBzdHJpbmdcclxuICBwcml2YXRlS2V5OiBzdHJpbmcgLy8g0LfQsNGI0LjRhNGA0L7QstCw0L3QvdGL0LlcclxuICBzb2xCYWxhbmNlOiBudW1iZXJcclxuICB1c2R0QmFsYW5jZTogbnVtYmVyXHJcbiAgdXNkY0JhbGFuY2U6IG51bWJlclxyXG4gIHdvcmtseUJhbGFuY2U6IG51bWJlclxyXG4gIHRvdGFsRWFybmVkOiBudW1iZXJcclxuICB0b3RhbFNwZW50OiBudW1iZXJcclxuICBjcmVhdGVkQXQ6IHN0cmluZ1xyXG4gIGxhc3RVcGRhdGVkOiBzdHJpbmdcclxufVxyXG5cclxuaW50ZXJmYWNlIEVzY3Jvd0FjY291bnQge1xyXG4gIHRhc2tJZDogc3RyaW5nXHJcbiAgZXNjcm93QWRkcmVzczogc3RyaW5nXHJcbiAgZXNjcm93UHJpdmF0ZUtleTogc3RyaW5nIC8vINC30LDRiNC40YTRgNC+0LLQsNC90L3Ri9C5XHJcbiAgY2xpZW50SWQ6IHN0cmluZ1xyXG4gIHdvcmtlcklkPzogc3RyaW5nXHJcbiAgYW1vdW50OiBudW1iZXJcclxuICB0b2tlbjogJ1NPTCcgfCAnVVNEVCcgfCAnVVNEQydcclxuICBzdGF0dXM6ICdwZW5kaW5nX3BheW1lbnQnIHwgJ2Z1bmRlZCcgfCAnY29tcGxldGVkJyB8ICdjYW5jZWxsZWQnXHJcbiAgY3JlYXRlZEF0OiBzdHJpbmdcclxuICBmdW5kZWRBdD86IHN0cmluZ1xyXG4gIGNvbXBsZXRlZEF0Pzogc3RyaW5nXHJcbiAgcGxhdGZvcm1GZWU6IG51bWJlclxyXG4gIG5ldEFtb3VudDogbnVtYmVyIC8vIGFtb3VudCAtIHBsYXRmb3JtRmVlXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBXYWxsZXRTZXJ2aWNlIHtcclxuICBwcml2YXRlIGNvbm5lY3Rpb246IENvbm5lY3Rpb25cclxuICBwcml2YXRlIHdhbGxldHNGaWxlID0gJ2RhdGEvd2FsbGV0cy5qc29uJ1xyXG4gIHByaXZhdGUgZXNjcm93c0ZpbGUgPSAnZGF0YS9lc2Nyb3dfYWNjb3VudHMuanNvbidcclxuICBwcml2YXRlIHRyYW5zYWN0aW9uc0ZpbGUgPSAnZGF0YS93YWxsZXRfdHJhbnNhY3Rpb25zLmpzb24nXHJcblxyXG4gIGNvbnN0cnVjdG9yKHJwY1VybDogc3RyaW5nID0gJ2h0dHBzOi8vYXBpLmRldm5ldC5zb2xhbmEuY29tJykge1xyXG4gICAgdGhpcy5jb25uZWN0aW9uID0gbmV3IENvbm5lY3Rpb24ocnBjVXJsLCAnY29uZmlybWVkJylcclxuICB9XHJcblxyXG4gIC8vINCh0L7Qt9C00LDQvdC40LUg0LrQvtGI0LXQu9GM0LrQsCDQtNC70Y8g0L3QvtCy0L7Qs9C+INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRj1xyXG4gIGFzeW5jIGNyZWF0ZVVzZXJXYWxsZXQodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJXYWxsZXQ+IHtcclxuICAgIGNvbnN0IGtleXBhaXIgPSBLZXlwYWlyLmdlbmVyYXRlKClcclxuXHJcbiAgICBjb25zdCB3YWxsZXQ6IFVzZXJXYWxsZXQgPSB7XHJcbiAgICAgIHVzZXJJZCxcclxuICAgICAgcHVibGljS2V5OiBrZXlwYWlyLnB1YmxpY0tleS50b1N0cmluZygpLFxyXG4gICAgICBwcml2YXRlS2V5OiB0aGlzLmVuY3J5cHRQcml2YXRlS2V5KGJzNTguZW5jb2RlKGtleXBhaXIuc2VjcmV0S2V5KSksXHJcbiAgICAgIHNvbEJhbGFuY2U6IDAsXHJcbiAgICAgIHVzZHRCYWxhbmNlOiAwLFxyXG4gICAgICB1c2RjQmFsYW5jZTogMCxcclxuICAgICAgd29ya2x5QmFsYW5jZTogMCxcclxuICAgICAgdG90YWxFYXJuZWQ6IDAsXHJcbiAgICAgIHRvdGFsU3BlbnQ6IDAsXHJcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgdGhpcy5zYXZlV2FsbGV0KHdhbGxldClcclxuXHJcbiAgICAvLyDQm9C+0LPQuNGA0YPQtdC8INGB0L7Qt9C00LDQvdC40LVcclxuICAgIGF3YWl0IHRoaXMubG9nVHJhbnNhY3Rpb24oe1xyXG4gICAgICB0eXBlOiAnd2FsbGV0X2NyZWF0ZWQnLFxyXG4gICAgICB1c2VySWQsXHJcbiAgICAgIHdhbGxldEFkZHJlc3M6IHdhbGxldC5wdWJsaWNLZXksXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICB9KVxyXG5cclxuICAgIHJldHVybiB3YWxsZXRcclxuICB9XHJcblxyXG4gIC8vINCh0L7Qt9C00LDQvdC40LUgZXNjcm93INCw0LTRgNC10YHQsCDQtNC70Y8g0LfQsNC00LDRh9C4XHJcbiAgYXN5bmMgY3JlYXRlVGFza0VzY3Jvdyh0YXNrSWQ6IHN0cmluZywgY2xpZW50SWQ6IHN0cmluZywgYW1vdW50OiBudW1iZXIsIHRva2VuOiAnU09MJyB8ICdVU0RUJyB8ICdVU0RDJyk6IFByb21pc2U8RXNjcm93QWNjb3VudD4ge1xyXG4gICAgY29uc3QgZXNjcm93S2V5cGFpciA9IEtleXBhaXIuZ2VuZXJhdGUoKVxyXG4gICAgY29uc3QgcGxhdGZvcm1GZWUgPSB0aGlzLmNhbGN1bGF0ZVBsYXRmb3JtRmVlKGFtb3VudClcclxuICAgIGNvbnN0IG5ldEFtb3VudCA9IGFtb3VudCAtIHBsYXRmb3JtRmVlXHJcblxyXG4gICAgY29uc3QgZXNjcm93OiBFc2Nyb3dBY2NvdW50ID0ge1xyXG4gICAgICB0YXNrSWQsXHJcbiAgICAgIGVzY3Jvd0FkZHJlc3M6IGVzY3Jvd0tleXBhaXIucHVibGljS2V5LnRvU3RyaW5nKCksXHJcbiAgICAgIGVzY3Jvd1ByaXZhdGVLZXk6IHRoaXMuZW5jcnlwdFByaXZhdGVLZXkoYnM1OC5lbmNvZGUoZXNjcm93S2V5cGFpci5zZWNyZXRLZXkpKSxcclxuICAgICAgY2xpZW50SWQsXHJcbiAgICAgIGFtb3VudCxcclxuICAgICAgdG9rZW4sXHJcbiAgICAgIHN0YXR1czogJ3BlbmRpbmdfcGF5bWVudCcsXHJcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICBwbGF0Zm9ybUZlZSxcclxuICAgICAgbmV0QW1vdW50XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgdGhpcy5zYXZlRXNjcm93KGVzY3JvdylcclxuXHJcbiAgICAvLyDQm9C+0LPQuNGA0YPQtdC8INGB0L7Qt9C00LDQvdC40LUgZXNjcm93XHJcbiAgICBhd2FpdCB0aGlzLmxvZ1RyYW5zYWN0aW9uKHtcclxuICAgICAgdHlwZTogJ2VzY3Jvd19jcmVhdGVkJyxcclxuICAgICAgdXNlcklkOiBjbGllbnRJZCxcclxuICAgICAgdGFza0lkLFxyXG4gICAgICBlc2Nyb3dBZGRyZXNzOiBlc2Nyb3cuZXNjcm93QWRkcmVzcyxcclxuICAgICAgYW1vdW50LFxyXG4gICAgICB0b2tlbixcclxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgIH0pXHJcblxyXG4gICAgcmV0dXJuIGVzY3Jvd1xyXG4gIH1cclxuXHJcbiAgLy8g0J/RgNC+0LLQtdGA0LrQsCDQv9C+0YHRgtGD0L/Qu9C10L3QuNGPINGB0YDQtdC00YHRgtCyINC90LAgZXNjcm93XHJcbiAgYXN5bmMgY2hlY2tFc2Nyb3dGdW5kaW5nKGVzY3Jvd0FkZHJlc3M6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZXNjcm93ID0gYXdhaXQgdGhpcy5nZXRFc2Nyb3dCeUFkZHJlc3MoZXNjcm93QWRkcmVzcylcclxuICAgICAgaWYgKCFlc2Nyb3cgfHwgZXNjcm93LnN0YXR1cyAhPT0gJ3BlbmRpbmdfcGF5bWVudCcpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2VcclxuICAgICAgfVxyXG5cclxuICAgICAgbGV0IGJhbGFuY2UgPSAwXHJcbiAgICAgIGlmIChlc2Nyb3cudG9rZW4gPT09ICdTT0wnKSB7XHJcbiAgICAgICAgYmFsYW5jZSA9IGF3YWl0IHRoaXMuY29ubmVjdGlvbi5nZXRCYWxhbmNlKG5ldyBQdWJsaWNLZXkoZXNjcm93QWRkcmVzcykpXHJcbiAgICAgICAgYmFsYW5jZSA9IGJhbGFuY2UgLyBMQU1QT1JUU19QRVJfU09MXHJcbiAgICAgIH1cclxuICAgICAgLy8gVE9ETzog0JTQvtCx0LDQstC40YLRjCDQv9GA0L7QstC10YDQutGDINC00LvRjyBTUEwg0YLQvtC60LXQvdC+0LJcclxuXHJcbiAgICAgIC8vINCf0YDQvtCy0LXRgNGP0LXQvCwg0LTQvtGB0YLQsNGC0L7Rh9C90L4g0LvQuCDRgdGA0LXQtNGB0YLQsiAo0YEg0L3QtdCx0L7Qu9GM0YjQvtC5INC/0L7Qs9GA0LXRiNC90L7RgdGC0YzRjilcclxuICAgICAgaWYgKGJhbGFuY2UgPj0gZXNjcm93LmFtb3VudCAqIDAuOTkpIHsgLy8gMSUg0L/QvtCz0YDQtdGI0L3QvtGB0YLRjCDQvdCwINC60L7QvNC40YHRgdC40Lgg0YHQtdGC0LhcclxuICAgICAgICBhd2FpdCB0aGlzLm1hcmtFc2Nyb3dBc0Z1bmRlZChlc2Nyb3dBZGRyZXNzKVxyXG4gICAgICAgIHJldHVybiB0cnVlXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiBmYWxzZVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY2hlY2tpbmcgZXNjcm93IGZ1bmRpbmc6JywgZXJyb3IpXHJcbiAgICAgIHJldHVybiBmYWxzZVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8g0JfQsNCy0LXRgNGI0LXQvdC40LUg0LfQsNC00LDRh9C4INC4INC/0LXRgNC10LLQvtC0INGB0YDQtdC00YHRgtCyXHJcbiAgYXN5bmMgY29tcGxldGVUYXNrQW5kVHJhbnNmZXIodGFza0lkOiBzdHJpbmcsIHdvcmtlcklkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgdHhIYXNoPzogc3RyaW5nOyBlcnJvcj86IHN0cmluZyB9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBlc2Nyb3cgPSBhd2FpdCB0aGlzLmdldEVzY3Jvd0J5VGFza0lkKHRhc2tJZClcclxuICAgICAgaWYgKCFlc2Nyb3cgfHwgZXNjcm93LnN0YXR1cyAhPT0gJ2Z1bmRlZCcpIHtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFc2Nyb3cgbm90IGZvdW5kIG9yIG5vdCBmdW5kZWQnIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3Qgd29ya2VyV2FsbGV0ID0gYXdhaXQgdGhpcy5nZXRVc2VyV2FsbGV0KHdvcmtlcklkKVxyXG4gICAgICBpZiAoIXdvcmtlcldhbGxldCkge1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1dvcmtlciB3YWxsZXQgbm90IGZvdW5kJyB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vINCh0L7Qt9C00LDQtdC8INGC0YDQsNC90LfQsNC60YbQuNGOINC00LvRjyDQv9C10YDQtdCy0L7QtNCwICjRgtC+0LvRjNC60L4g0LTQu9GPIFNPTCDQv9C+0LrQsClcclxuICAgICAgaWYgKGVzY3Jvdy50b2tlbiA9PT0gJ1NPTCcpIHtcclxuICAgICAgICBjb25zdCBlc2Nyb3dLZXlwYWlyID0gdGhpcy5kZWNyeXB0UHJpdmF0ZUtleShlc2Nyb3cuZXNjcm93UHJpdmF0ZUtleSlcclxuICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbigpXHJcblxyXG4gICAgICAgIC8vINCf0LXRgNC10LLQvtC0IFNPTCDQuNGB0L/QvtC70L3QuNGC0LXQu9GOXHJcbiAgICAgICAgY29uc3Qgd29ya2VyVHJhbnNmZXIgPSBTeXN0ZW1Qcm9ncmFtLnRyYW5zZmVyKHtcclxuICAgICAgICAgIGZyb21QdWJrZXk6IG5ldyBQdWJsaWNLZXkoZXNjcm93LmVzY3Jvd0FkZHJlc3MpLFxyXG4gICAgICAgICAgdG9QdWJrZXk6IG5ldyBQdWJsaWNLZXkod29ya2VyV2FsbGV0LnB1YmxpY0tleSksXHJcbiAgICAgICAgICBsYW1wb3J0czogTWF0aC5mbG9vcihlc2Nyb3cubmV0QW1vdW50ICogTEFNUE9SVFNfUEVSX1NPTClcclxuICAgICAgICB9KVxyXG4gICAgICAgIHRyYW5zYWN0aW9uLmFkZCh3b3JrZXJUcmFuc2ZlcilcclxuXHJcbiAgICAgICAgLy8g0J/QtdGA0LXQstC+0LQg0LrQvtC80LjRgdGB0LjQuCDQv9C70LDRgtGE0L7RgNC80LUgKNC/0L7QutCwINC/0YDQvtC/0YPRgdC60LDQtdC8KVxyXG4gICAgICAgIC8vIFRPRE86INCU0L7QsdCw0LLQuNGC0Ywg0L/Qu9Cw0YLRhNC+0YDQvNC10L3QvdGL0Lkg0LrQvtGI0LXQu9C10LpcclxuXHJcbiAgICAgICAgY29uc3QgdHhIYXNoID0gYXdhaXQgc2VuZEFuZENvbmZpcm1UcmFuc2FjdGlvbihcclxuICAgICAgICAgIHRoaXMuY29ubmVjdGlvbixcclxuICAgICAgICAgIHRyYW5zYWN0aW9uLFxyXG4gICAgICAgICAgW2VzY3Jvd0tleXBhaXJdLFxyXG4gICAgICAgICAgeyBjb21taXRtZW50OiAnY29uZmlybWVkJyB9XHJcbiAgICAgICAgKVxyXG5cclxuICAgICAgICAvLyDQntCx0L3QvtCy0LvRj9C10Lwg0YHRgtCw0YLRg9GBIGVzY3Jvd1xyXG4gICAgICAgIGF3YWl0IHRoaXMubWFya0VzY3Jvd0FzQ29tcGxldGVkKGVzY3Jvdy5lc2Nyb3dBZGRyZXNzLCB0eEhhc2gpXHJcblxyXG4gICAgICAgIC8vINCe0LHQvdC+0LLQu9GP0LXQvCDQsdCw0LvQsNC90YHRiyDQv9C+0LvRjNC30L7QstCw0YLQtdC70LXQuVxyXG4gICAgICAgIGF3YWl0IHRoaXMudXBkYXRlVXNlckJhbGFuY2Uod29ya2VySWQsIGVzY3Jvdy5uZXRBbW91bnQsIGVzY3Jvdy50b2tlbiwgJ2Vhcm5lZCcpXHJcbiAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVVc2VyQmFsYW5jZShlc2Nyb3cuY2xpZW50SWQsIGVzY3Jvdy5hbW91bnQsIGVzY3Jvdy50b2tlbiwgJ3NwZW50JylcclxuXHJcbiAgICAgICAgLy8g0J3QsNGH0LjRgdC70Y/QtdC8IFdPUktMWSDRgtC+0LrQtdC90Ysg0LfQsCDQt9Cw0LLQtdGA0YjQtdC90LjQtSDQt9Cw0LTQsNGH0LhcclxuICAgICAgICBhd2FpdCB0aGlzLnJld2FyZFdvcmtseVRva2Vucyh3b3JrZXJJZCwgZXNjcm93Lm5ldEFtb3VudClcclxuXHJcbiAgICAgICAgLy8g0JvQvtCz0LjRgNGD0LXQvCDRgtGA0LDQvdC30LDQutGG0LjRjlxyXG4gICAgICAgIGF3YWl0IHRoaXMubG9nVHJhbnNhY3Rpb24oe1xyXG4gICAgICAgICAgdHlwZTogJ3Rhc2tfY29tcGxldGVkJyxcclxuICAgICAgICAgIHVzZXJJZDogd29ya2VySWQsXHJcbiAgICAgICAgICB0YXNrSWQsXHJcbiAgICAgICAgICBhbW91bnQ6IGVzY3Jvdy5uZXRBbW91bnQsXHJcbiAgICAgICAgICB0b2tlbjogZXNjcm93LnRva2VuLFxyXG4gICAgICAgICAgdHhIYXNoLFxyXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB0eEhhc2ggfVxyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdPbmx5IFNPTCB0cmFuc2ZlcnMgc3VwcG9ydGVkIGN1cnJlbnRseScgfVxyXG5cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNvbXBsZXRpbmcgdGFzayB0cmFuc2ZlcjonLCBlcnJvcilcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRmFpbGVkIHRvIHRyYW5zZmVyIGZ1bmRzJyB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyDQndCw0YfQuNGB0LvQtdC90LjQtSBXT1JLTFkg0YLQvtC60LXQvdC+0LIg0LfQsCDQsNC60YLQuNCy0L3QvtGB0YLRjFxyXG4gIGFzeW5jIHJld2FyZFdvcmtseVRva2Vucyh1c2VySWQ6IHN0cmluZywgZWFybmVkQW1vdW50OiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vINCk0L7RgNC80YPQu9CwOiAxJSDQvtGCINC30LDRgNCw0LHQvtGC0LDQvdC90L7QuSDRgdGD0LzQvNGLINCyIFdPUktMWSDRgtC+0LrQtdC90LDRhVxyXG4gICAgICBjb25zdCB3b3JrbHlSZXdhcmQgPSBlYXJuZWRBbW91bnQgKiAwLjAxXHJcblxyXG4gICAgICBjb25zdCB1c2VyV2FsbGV0ID0gYXdhaXQgdGhpcy5nZXRVc2VyV2FsbGV0KHVzZXJJZClcclxuICAgICAgaWYgKHVzZXJXYWxsZXQpIHtcclxuICAgICAgICB1c2VyV2FsbGV0LndvcmtseUJhbGFuY2UgKz0gd29ya2x5UmV3YXJkXHJcbiAgICAgICAgdXNlcldhbGxldC5sYXN0VXBkYXRlZCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICAgIGF3YWl0IHRoaXMuc2F2ZVdhbGxldCh1c2VyV2FsbGV0KVxyXG5cclxuICAgICAgICBhd2FpdCB0aGlzLmxvZ1RyYW5zYWN0aW9uKHtcclxuICAgICAgICAgIHR5cGU6ICd3b3JrbHlfcmV3YXJkJyxcclxuICAgICAgICAgIHVzZXJJZCxcclxuICAgICAgICAgIGFtb3VudDogd29ya2x5UmV3YXJkLFxyXG4gICAgICAgICAgdG9rZW46ICdXT1JLTFknLFxyXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICB9KVxyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciByZXdhcmRpbmcgV09SS0xZIHRva2VuczonLCBlcnJvcilcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vINCf0YDQuNC80LXQvdC10L3QuNC1INGB0LrQuNC00LrQuCBXT1JLTFkg0YLQvtC60LXQvdCwINC90LAg0LrQvtC80LjRgdGB0LjQuFxyXG4gIGNhbGN1bGF0ZURpc2NvdW50ZWRGZWUoYW1vdW50OiBudW1iZXIsIHdvcmtseUJhbGFuY2U6IG51bWJlcik6IG51bWJlciB7XHJcbiAgICBjb25zdCBiYXNlRmVlID0gdGhpcy5jYWxjdWxhdGVQbGF0Zm9ybUZlZShhbW91bnQpXHJcblxyXG4gICAgaWYgKHdvcmtseUJhbGFuY2UgPj0gMTAwMCkge1xyXG4gICAgICByZXR1cm4gYmFzZUZlZSAqIDAuNSAvLyA1MCUg0YHQutC40LTQutCwXHJcbiAgICB9IGVsc2UgaWYgKHdvcmtseUJhbGFuY2UgPj0gNTAwKSB7XHJcbiAgICAgIHJldHVybiBiYXNlRmVlICogMC43IC8vIDMwJSDRgdC60LjQtNC60LBcclxuICAgIH0gZWxzZSBpZiAod29ya2x5QmFsYW5jZSA+PSAxMDApIHtcclxuICAgICAgcmV0dXJuIGJhc2VGZWUgKiAwLjg1IC8vIDE1JSDRgdC60LjQtNC60LBcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gYmFzZUZlZVxyXG4gIH1cclxuXHJcbiAgLy8g0JLRgdC/0L7QvNC+0LPQsNGC0LXQu9GM0L3Ri9C1INC80LXRgtC+0LTRi1xyXG4gIHByaXZhdGUgY2FsY3VsYXRlUGxhdGZvcm1GZWUoYW1vdW50OiBudW1iZXIpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIGFtb3VudCAqIDAuMDI1IC8vIDIuNSVcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZW5jcnlwdFByaXZhdGVLZXkocHJpdmF0ZUtleTogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIC8vINCSINC/0YDQvtC00LDQutGI0LXQvdC1INC40YHQv9C+0LvRjNC30L7QstCw0YLRjCDRgNC10LDQu9GM0L3QvtC1INGI0LjRhNGA0L7QstCw0L3QuNC1XHJcbiAgICByZXR1cm4gQnVmZmVyLmZyb20ocHJpdmF0ZUtleSkudG9TdHJpbmcoJ2Jhc2U2NCcpXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGRlY3J5cHRQcml2YXRlS2V5KGVuY3J5cHRlZEtleTogc3RyaW5nKTogS2V5cGFpciB7XHJcbiAgICAvLyDQkiDQv9GA0L7QtNCw0LrRiNC10L3QtSDQuNGB0L/QvtC70YzQt9C+0LLQsNGC0Ywg0YDQtdCw0LvRjNC90L7QtSDRgNCw0YHRiNC40YTRgNC+0LLQsNC90LjQtVxyXG4gICAgY29uc3QgcHJpdmF0ZUtleSA9IEJ1ZmZlci5mcm9tKGVuY3J5cHRlZEtleSwgJ2Jhc2U2NCcpLnRvU3RyaW5nKClcclxuICAgIHJldHVybiBLZXlwYWlyLmZyb21TZWNyZXRLZXkoYnM1OC5kZWNvZGUocHJpdmF0ZUtleSkpXHJcbiAgfVxyXG5cclxuICAvLyDQnNC10YLQvtC00Ysg0YDQsNCx0L7RgtGLINGBINGE0LDQudC70LDQvNC4ICjQt9Cw0LzQtdC90LjRgtGMINC90LAg0JHQlCDQsiDQv9GA0L7QtNCw0LrRiNC10L3QtSlcclxuICBwcml2YXRlIGFzeW5jIHNhdmVXYWxsZXQod2FsbGV0OiBVc2VyV2FsbGV0KTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJylcclxuICAgIGNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJylcclxuXHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCB0aGlzLndhbGxldHNGaWxlKVxyXG4gICAgY29uc3QgZGlyID0gcGF0aC5kaXJuYW1lKGZpbGVQYXRoKVxyXG5cclxuICAgIGlmICghZnMuZXhpc3RzU3luYyhkaXIpKSB7XHJcbiAgICAgIGZzLm1rZGlyU3luYyhkaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pXHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHdhbGxldHMgPSBbXVxyXG4gICAgaWYgKGZzLmV4aXN0c1N5bmMoZmlsZVBhdGgpKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgZGF0YSA9IGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwgJ3V0ZjgnKVxyXG4gICAgICAgIHdhbGxldHMgPSBKU09OLnBhcnNlKGRhdGEpXHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgd2FsbGV0cyA9IFtdXHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBleGlzdGluZ0luZGV4ID0gd2FsbGV0cy5maW5kSW5kZXgoKHc6IFVzZXJXYWxsZXQpID0+IHcudXNlcklkID09PSB3YWxsZXQudXNlcklkKVxyXG4gICAgaWYgKGV4aXN0aW5nSW5kZXggPj0gMCkge1xyXG4gICAgICB3YWxsZXRzW2V4aXN0aW5nSW5kZXhdID0gd2FsbGV0XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB3YWxsZXRzLnB1c2god2FsbGV0KVxyXG4gICAgfVxyXG5cclxuICAgIGZzLndyaXRlRmlsZVN5bmMoZmlsZVBhdGgsIEpTT04uc3RyaW5naWZ5KHdhbGxldHMsIG51bGwsIDIpKVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBnZXRVc2VyV2FsbGV0KHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxVc2VyV2FsbGV0IHwgbnVsbD4ge1xyXG4gICAgY29uc3QgZnMgPSByZXF1aXJlKCdmcycpXHJcbiAgICBjb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpXHJcblxyXG4gICAgY29uc3QgZmlsZVBhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgdGhpcy53YWxsZXRzRmlsZSlcclxuICAgIGlmICghZnMuZXhpc3RzU3luYyhmaWxlUGF0aCkpIHJldHVybiBudWxsXHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZGF0YSA9IGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwgJ3V0ZjgnKVxyXG4gICAgICBjb25zdCB3YWxsZXRzID0gSlNPTi5wYXJzZShkYXRhKVxyXG4gICAgICByZXR1cm4gd2FsbGV0cy5maW5kKCh3OiBVc2VyV2FsbGV0KSA9PiB3LnVzZXJJZCA9PT0gdXNlcklkKSB8fCBudWxsXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICByZXR1cm4gbnVsbFxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBzYXZlRXNjcm93KGVzY3JvdzogRXNjcm93QWNjb3VudCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgY29uc3QgZnMgPSByZXF1aXJlKCdmcycpXHJcbiAgICBjb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpXHJcblxyXG4gICAgY29uc3QgZmlsZVBhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgdGhpcy5lc2Nyb3dzRmlsZSlcclxuICAgIGNvbnN0IGRpciA9IHBhdGguZGlybmFtZShmaWxlUGF0aClcclxuXHJcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMoZGlyKSkge1xyXG4gICAgICBmcy5ta2RpclN5bmMoZGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KVxyXG4gICAgfVxyXG5cclxuICAgIGxldCBlc2Nyb3dzID0gW11cclxuICAgIGlmIChmcy5leGlzdHNTeW5jKGZpbGVQYXRoKSkge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGRhdGEgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZVBhdGgsICd1dGY4JylcclxuICAgICAgICBlc2Nyb3dzID0gSlNPTi5wYXJzZShkYXRhKVxyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGVzY3Jvd3MgPSBbXVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZXhpc3RpbmdJbmRleCA9IGVzY3Jvd3MuZmluZEluZGV4KChlOiBFc2Nyb3dBY2NvdW50KSA9PiBlLnRhc2tJZCA9PT0gZXNjcm93LnRhc2tJZClcclxuICAgIGlmIChleGlzdGluZ0luZGV4ID49IDApIHtcclxuICAgICAgZXNjcm93c1tleGlzdGluZ0luZGV4XSA9IGVzY3Jvd1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZXNjcm93cy5wdXNoKGVzY3JvdylcclxuICAgIH1cclxuXHJcbiAgICBmcy53cml0ZUZpbGVTeW5jKGZpbGVQYXRoLCBKU09OLnN0cmluZ2lmeShlc2Nyb3dzLCBudWxsLCAyKSlcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgZ2V0RXNjcm93QnlBZGRyZXNzKGVzY3Jvd0FkZHJlc3M6IHN0cmluZyk6IFByb21pc2U8RXNjcm93QWNjb3VudCB8IG51bGw+IHtcclxuICAgIGNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKVxyXG4gICAgY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKVxyXG5cclxuICAgIGNvbnN0IGZpbGVQYXRoID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIHRoaXMuZXNjcm93c0ZpbGUpXHJcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMoZmlsZVBhdGgpKSByZXR1cm4gbnVsbFxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGRhdGEgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZVBhdGgsICd1dGY4JylcclxuICAgICAgY29uc3QgZXNjcm93cyA9IEpTT04ucGFyc2UoZGF0YSlcclxuICAgICAgcmV0dXJuIGVzY3Jvd3MuZmluZCgoZTogRXNjcm93QWNjb3VudCkgPT4gZS5lc2Nyb3dBZGRyZXNzID09PSBlc2Nyb3dBZGRyZXNzKSB8fCBudWxsXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICByZXR1cm4gbnVsbFxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBnZXRFc2Nyb3dCeVRhc2tJZCh0YXNrSWQ6IHN0cmluZyk6IFByb21pc2U8RXNjcm93QWNjb3VudCB8IG51bGw+IHtcclxuICAgIGNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKVxyXG4gICAgY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKVxyXG5cclxuICAgIGNvbnN0IGZpbGVQYXRoID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIHRoaXMuZXNjcm93c0ZpbGUpXHJcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMoZmlsZVBhdGgpKSByZXR1cm4gbnVsbFxyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGRhdGEgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZVBhdGgsICd1dGY4JylcclxuICAgICAgY29uc3QgZXNjcm93cyA9IEpTT04ucGFyc2UoZGF0YSlcclxuICAgICAgcmV0dXJuIGVzY3Jvd3MuZmluZCgoZTogRXNjcm93QWNjb3VudCkgPT4gZS50YXNrSWQgPT09IHRhc2tJZCkgfHwgbnVsbFxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgcmV0dXJuIG51bGxcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgbWFya0VzY3Jvd0FzRnVuZGVkKGVzY3Jvd0FkZHJlc3M6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgY29uc3QgZXNjcm93ID0gYXdhaXQgdGhpcy5nZXRFc2Nyb3dCeUFkZHJlc3MoZXNjcm93QWRkcmVzcylcclxuICAgIGlmIChlc2Nyb3cpIHtcclxuICAgICAgZXNjcm93LnN0YXR1cyA9ICdmdW5kZWQnXHJcbiAgICAgIGVzY3Jvdy5mdW5kZWRBdCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICBhd2FpdCB0aGlzLnNhdmVFc2Nyb3coZXNjcm93KVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBtYXJrRXNjcm93QXNDb21wbGV0ZWQoZXNjcm93QWRkcmVzczogc3RyaW5nLCB0eEhhc2g6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgY29uc3QgZXNjcm93ID0gYXdhaXQgdGhpcy5nZXRFc2Nyb3dCeUFkZHJlc3MoZXNjcm93QWRkcmVzcylcclxuICAgIGlmIChlc2Nyb3cpIHtcclxuICAgICAgZXNjcm93LnN0YXR1cyA9ICdjb21wbGV0ZWQnXHJcbiAgICAgIGVzY3Jvdy5jb21wbGV0ZWRBdCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgICBhd2FpdCB0aGlzLnNhdmVFc2Nyb3coZXNjcm93KVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyB1cGRhdGVVc2VyQmFsYW5jZSh1c2VySWQ6IHN0cmluZywgYW1vdW50OiBudW1iZXIsIHRva2VuOiBzdHJpbmcsIHR5cGU6ICdlYXJuZWQnIHwgJ3NwZW50JyB8ICd3aXRoZHJhd24nKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBjb25zdCB3YWxsZXQgPSBhd2FpdCB0aGlzLmdldFVzZXJXYWxsZXQodXNlcklkKVxyXG4gICAgaWYgKCF3YWxsZXQpIHJldHVyblxyXG5cclxuICAgIGlmICh0eXBlID09PSAnZWFybmVkJykge1xyXG4gICAgICBzd2l0Y2ggKHRva2VuKSB7XHJcbiAgICAgICAgY2FzZSAnU09MJzogd2FsbGV0LnNvbEJhbGFuY2UgKz0gYW1vdW50OyBicmVha1xyXG4gICAgICAgIGNhc2UgJ1VTRFQnOiB3YWxsZXQudXNkdEJhbGFuY2UgKz0gYW1vdW50OyBicmVha1xyXG4gICAgICAgIGNhc2UgJ1VTREMnOiB3YWxsZXQudXNkY0JhbGFuY2UgKz0gYW1vdW50OyBicmVha1xyXG4gICAgICB9XHJcbiAgICAgIHdhbGxldC50b3RhbEVhcm5lZCArPSBhbW91bnRcclxuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3NwZW50Jykge1xyXG4gICAgICB3YWxsZXQudG90YWxTcGVudCArPSBhbW91bnRcclxuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3dpdGhkcmF3bicpIHtcclxuICAgICAgc3dpdGNoICh0b2tlbikge1xyXG4gICAgICAgIGNhc2UgJ1NPTCc6IHdhbGxldC5zb2xCYWxhbmNlIC09IGFtb3VudDsgYnJlYWtcclxuICAgICAgICBjYXNlICdVU0RUJzogd2FsbGV0LnVzZHRCYWxhbmNlIC09IGFtb3VudDsgYnJlYWtcclxuICAgICAgICBjYXNlICdVU0RDJzogd2FsbGV0LnVzZGNCYWxhbmNlIC09IGFtb3VudDsgYnJlYWtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHdhbGxldC5sYXN0VXBkYXRlZCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG4gICAgYXdhaXQgdGhpcy5zYXZlV2FsbGV0KHdhbGxldClcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgbG9nVHJhbnNhY3Rpb24odHJhbnNhY3Rpb246IGFueSk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgY29uc3QgZnMgPSByZXF1aXJlKCdmcycpXHJcbiAgICBjb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpXHJcblxyXG4gICAgY29uc3QgZmlsZVBhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgdGhpcy50cmFuc2FjdGlvbnNGaWxlKVxyXG4gICAgY29uc3QgZGlyID0gcGF0aC5kaXJuYW1lKGZpbGVQYXRoKVxyXG5cclxuICAgIGlmICghZnMuZXhpc3RzU3luYyhkaXIpKSB7XHJcbiAgICAgIGZzLm1rZGlyU3luYyhkaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pXHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHRyYW5zYWN0aW9ucyA9IFtdXHJcbiAgICBpZiAoZnMuZXhpc3RzU3luYyhmaWxlUGF0aCkpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBkYXRhID0gZnMucmVhZEZpbGVTeW5jKGZpbGVQYXRoLCAndXRmOCcpXHJcbiAgICAgICAgdHJhbnNhY3Rpb25zID0gSlNPTi5wYXJzZShkYXRhKVxyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIHRyYW5zYWN0aW9ucyA9IFtdXHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0cmFuc2FjdGlvbnMucHVzaCh7XHJcbiAgICAgIGlkOiBEYXRlLm5vdygpLnRvU3RyaW5nKCksXHJcbiAgICAgIC4uLnRyYW5zYWN0aW9uXHJcbiAgICB9KVxyXG5cclxuICAgIGZzLndyaXRlRmlsZVN5bmMoZmlsZVBhdGgsIEpTT04uc3RyaW5naWZ5KHRyYW5zYWN0aW9ucywgbnVsbCwgMikpXHJcbiAgfVxyXG5cclxuICBhc3luYyBzeW5jV2FsbGV0QmFsYW5jZSh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8VXNlcldhbGxldCB8IG51bGw+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHdhbGxldCA9IGF3YWl0IHRoaXMuZ2V0VXNlcldhbGxldCh1c2VySWQpXHJcbiAgICAgIGlmICghd2FsbGV0KSByZXR1cm4gbnVsbFxyXG5cclxuICAgICAgLy8g0J/QvtC70YPRh9Cw0LXQvCDRgNC10LDQu9GM0L3Ri9C5INCx0LDQu9Cw0L3RgSBTT0wg0YEg0LHQu9C+0LrRh9C10LnQvdCwXHJcbiAgICAgIGNvbnN0IHB1YmxpY0tleSA9IG5ldyBQdWJsaWNLZXkod2FsbGV0LnB1YmxpY0tleSlcclxuICAgICAgY29uc3QgYmFsYW5jZSA9IGF3YWl0IHRoaXMuY29ubmVjdGlvbi5nZXRCYWxhbmNlKHB1YmxpY0tleSlcclxuICAgICAgY29uc3Qgc29sQmFsYW5jZSA9IGJhbGFuY2UgLyBMQU1QT1JUU19QRVJfU09MXHJcblxyXG4gICAgICAvLyDQntCx0L3QvtCy0LvRj9C10Lwg0LHQsNC70LDQvdGBINCyINC70L7QutCw0LvRjNC90YvRhSDQtNCw0L3QvdGL0YVcclxuICAgICAgd2FsbGV0LnNvbEJhbGFuY2UgPSBzb2xCYWxhbmNlXHJcbiAgICAgIHdhbGxldC5sYXN0VXBkYXRlZCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxyXG5cclxuICAgICAgLy8g0KHQvtGF0YDQsNC90Y/QtdC8INC+0LHQvdC+0LLQu9C10L3QvdGL0Lkg0LrQvtGI0LXQu9C10LpcclxuICAgICAgYXdhaXQgdGhpcy5zYXZlV2FsbGV0KHdhbGxldClcclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKGBVcGRhdGVkIGJhbGFuY2UgZm9yICR7dXNlcklkfTogJHtzb2xCYWxhbmNlfSBTT0xgKVxyXG4gICAgICByZXR1cm4gd2FsbGV0XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igc3luY2luZyB3YWxsZXQgYmFsYW5jZTonLCBlcnJvcilcclxuICAgICAgcmV0dXJuIG51bGxcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vINCf0YPQsdC70LjRh9C90YvQtSDQvNC10YLQvtC00Ysg0LTQu9GPIEFQSVxyXG4gIGFzeW5jIGNyZWF0ZVdhbGxldEZvclVzZXIodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJXYWxsZXQ+IHtcclxuICAgIHJldHVybiBhd2FpdCB0aGlzLmNyZWF0ZVVzZXJXYWxsZXQodXNlcklkKVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0V2FsbGV0SW5mbyh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8VXNlcldhbGxldCB8IG51bGw+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vINCh0L3QsNGH0LDQu9CwINC/0L7Qu9GD0YfQsNC10Lwg0LrQvtGI0LXQu9C10Log0LjQtyDRhNCw0LnQu9CwXHJcbiAgICAgIGxldCB3YWxsZXQgPSBhd2FpdCB0aGlzLmdldFVzZXJXYWxsZXQodXNlcklkKVxyXG4gICAgICBpZiAoIXdhbGxldCkgcmV0dXJuIG51bGxcclxuXHJcbiAgICAgIC8vINCh0LjQvdGF0YDQvtC90LjQt9C40YDRg9C10Lwg0LHQsNC70LDQvdGBINGBINCx0LvQvtC60YfQtdC50L3QvtC8XHJcbiAgICAgIHdhbGxldCA9IGF3YWl0IHRoaXMuc3luY1dhbGxldEJhbGFuY2UodXNlcklkKVxyXG5cclxuICAgICAgcmV0dXJuIHdhbGxldFxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyB3YWxsZXQgaW5mbzonLCBlcnJvcilcclxuICAgICAgcmV0dXJuIG51bGxcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIGNyZWF0ZVRhc2tFc2Nyb3dBZGRyZXNzKHRhc2tJZDogc3RyaW5nLCBjbGllbnRJZDogc3RyaW5nLCBhbW91bnQ6IG51bWJlciwgdG9rZW46ICdTT0wnIHwgJ1VTRFQnIHwgJ1VTREMnKTogUHJvbWlzZTxFc2Nyb3dBY2NvdW50PiB7XHJcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5jcmVhdGVUYXNrRXNjcm93KHRhc2tJZCwgY2xpZW50SWQsIGFtb3VudCwgdG9rZW4pXHJcbiAgfVxyXG5cclxuICBhc3luYyBjaGVja1Rhc2tGdW5kaW5nKHRhc2tJZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICBjb25zdCBlc2Nyb3cgPSBhd2FpdCB0aGlzLmdldEVzY3Jvd0J5VGFza0lkKHRhc2tJZClcclxuICAgIGlmICghZXNjcm93KSByZXR1cm4gZmFsc2VcclxuICAgIHJldHVybiBhd2FpdCB0aGlzLmNoZWNrRXNjcm93RnVuZGluZyhlc2Nyb3cuZXNjcm93QWRkcmVzcylcclxuICB9XHJcblxyXG4gIGFzeW5jIGNvbXBsZXRlVGFzayh0YXNrSWQ6IHN0cmluZywgd29ya2VySWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyB0eEhhc2g/OiBzdHJpbmc7IGVycm9yPzogc3RyaW5nIH0+IHtcclxuICAgIHJldHVybiBhd2FpdCB0aGlzLmNvbXBsZXRlVGFza0FuZFRyYW5zZmVyKHRhc2tJZCwgd29ya2VySWQpXHJcbiAgfVxyXG5cclxuICAvLyDQnNC10YLQvtC0INC00LvRjyDQstGL0LLQvtC00LAg0YHRgNC10LTRgdGC0LJcclxuICBhc3luYyB3aXRoZHJhd0Z1bmRzKHVzZXJJZDogc3RyaW5nLCBhbW91bnQ6IG51bWJlciwgdG9BZGRyZXNzOiBzdHJpbmcsIHRva2VuOiAnU09MJyA9ICdTT0wnKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IHR4SGFzaD86IHN0cmluZzsgZXJyb3I/OiBzdHJpbmcgfT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgdXNlcldhbGxldCA9IGF3YWl0IHRoaXMuZ2V0VXNlcldhbGxldCh1c2VySWQpXHJcbiAgICAgIGlmICghdXNlcldhbGxldCkge1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1VzZXIgd2FsbGV0IG5vdCBmb3VuZCcgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBjdXJyZW50QmFsYW5jZSA9IHVzZXJXYWxsZXQuc29sQmFsYW5jZVxyXG4gICAgICBpZiAoYW1vdW50ID4gY3VycmVudEJhbGFuY2UpIHtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdJbnN1ZmZpY2llbnQgYmFsYW5jZScgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIG5ldyBQdWJsaWNLZXkodG9BZGRyZXNzKVxyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBTb2xhbmEgYWRkcmVzcycgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoYW1vdW50IDwgMC4wMDEpIHtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdNaW5pbXVtIHdpdGhkcmF3YWwgYW1vdW50IGlzIDAuMDAxIFNPTCcgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCB1c2VyS2V5cGFpciA9IHRoaXMuZGVjcnlwdFByaXZhdGVLZXkodXNlcldhbGxldC5wcml2YXRlS2V5KVxyXG4gICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbigpXHJcblxyXG4gICAgICBjb25zdCB0cmFuc2ZlciA9IFN5c3RlbVByb2dyYW0udHJhbnNmZXIoe1xyXG4gICAgICAgIGZyb21QdWJrZXk6IHVzZXJLZXlwYWlyLnB1YmxpY0tleSxcclxuICAgICAgICB0b1B1YmtleTogbmV3IFB1YmxpY0tleSh0b0FkZHJlc3MpLFxyXG4gICAgICAgIGxhbXBvcnRzOiBNYXRoLmZsb29yKGFtb3VudCAqIExBTVBPUlRTX1BFUl9TT0wpXHJcbiAgICAgIH0pXHJcbiAgICAgIHRyYW5zYWN0aW9uLmFkZCh0cmFuc2ZlcilcclxuXHJcbiAgICAgIGNvbnN0IHR4SGFzaCA9IGF3YWl0IHNlbmRBbmRDb25maXJtVHJhbnNhY3Rpb24oXHJcbiAgICAgICAgdGhpcy5jb25uZWN0aW9uLFxyXG4gICAgICAgIHRyYW5zYWN0aW9uLFxyXG4gICAgICAgIFt1c2VyS2V5cGFpcl0sXHJcbiAgICAgICAgeyBjb21taXRtZW50OiAnY29uZmlybWVkJyB9XHJcbiAgICAgIClcclxuXHJcbiAgICAgIGF3YWl0IHRoaXMudXBkYXRlVXNlckJhbGFuY2UodXNlcklkLCBhbW91bnQsIHRva2VuLCAnd2l0aGRyYXduJylcclxuXHJcbiAgICAgIGF3YWl0IHRoaXMubG9nVHJhbnNhY3Rpb24oe1xyXG4gICAgICAgIHR5cGU6ICd3aXRoZHJhd2FsJyxcclxuICAgICAgICB1c2VySWQsXHJcbiAgICAgICAgYW1vdW50LFxyXG4gICAgICAgIHRva2VuLFxyXG4gICAgICAgIHRvQWRkcmVzcyxcclxuICAgICAgICB0eEhhc2gsXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcclxuICAgICAgfSlcclxuXHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHR4SGFzaCB9XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB3aXRoZHJhd2luZyBmdW5kczonLCBlcnJvcilcclxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRmFpbGVkIHRvIHByb2Nlc3Mgd2l0aGRyYXdhbCcgfVxyXG4gICAgfVxyXG4gIH0gXHJcblxyXG4gIGFzeW5jIGZvcmNlUmVmcmVzaFdhbGxldCh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8VXNlcldhbGxldCB8IG51bGw+IHtcclxuICBjb25zb2xlLmxvZyhgRm9yY2UgcmVmcmVzaGluZyB3YWxsZXQgZm9yIHVzZXI6ICR7dXNlcklkfWApXHJcbiAgcmV0dXJuIGF3YWl0IHRoaXMuc3luY1dhbGxldEJhbGFuY2UodXNlcklkKVxyXG59XHJcblxyXG4gIC8vINCf0YPQsdC70LjRh9C90YvQuSDQvNC10YLQvtC0INC00LvRjyBBUElcclxuICBhc3luYyBwcm9jZXNzV2l0aGRyYXdhbCh1c2VySWQ6IHN0cmluZywgYW1vdW50OiBudW1iZXIsIHRvQWRkcmVzczogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IHR4SGFzaD86IHN0cmluZzsgZXJyb3I/OiBzdHJpbmcgfT4ge1xyXG4gICAgcmV0dXJuIGF3YWl0IHRoaXMud2l0aGRyYXdGdW5kcyh1c2VySWQsIGFtb3VudCwgdG9BZGRyZXNzLCAnU09MJylcclxuICB9XHJcbn1cclxuLy8g0K3QutGB0L/QvtGA0YLQuNGA0YPQtdC8INGB0LjQvdCz0LvRgtC+0L1cclxuZXhwb3J0IGNvbnN0IHdhbGxldFNlcnZpY2UgPSBuZXcgV2FsbGV0U2VydmljZSgpIl0sIm5hbWVzIjpbIktleXBhaXIiLCJQdWJsaWNLZXkiLCJDb25uZWN0aW9uIiwiTEFNUE9SVFNfUEVSX1NPTCIsIlRyYW5zYWN0aW9uIiwiU3lzdGVtUHJvZ3JhbSIsInNlbmRBbmRDb25maXJtVHJhbnNhY3Rpb24iLCJiczU4IiwiV2FsbGV0U2VydmljZSIsImNvbnN0cnVjdG9yIiwicnBjVXJsIiwid2FsbGV0c0ZpbGUiLCJlc2Nyb3dzRmlsZSIsInRyYW5zYWN0aW9uc0ZpbGUiLCJjb25uZWN0aW9uIiwiY3JlYXRlVXNlcldhbGxldCIsInVzZXJJZCIsImtleXBhaXIiLCJnZW5lcmF0ZSIsIndhbGxldCIsInB1YmxpY0tleSIsInRvU3RyaW5nIiwicHJpdmF0ZUtleSIsImVuY3J5cHRQcml2YXRlS2V5IiwiZW5jb2RlIiwic2VjcmV0S2V5Iiwic29sQmFsYW5jZSIsInVzZHRCYWxhbmNlIiwidXNkY0JhbGFuY2UiLCJ3b3JrbHlCYWxhbmNlIiwidG90YWxFYXJuZWQiLCJ0b3RhbFNwZW50IiwiY3JlYXRlZEF0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwibGFzdFVwZGF0ZWQiLCJzYXZlV2FsbGV0IiwibG9nVHJhbnNhY3Rpb24iLCJ0eXBlIiwid2FsbGV0QWRkcmVzcyIsInRpbWVzdGFtcCIsImNyZWF0ZVRhc2tFc2Nyb3ciLCJ0YXNrSWQiLCJjbGllbnRJZCIsImFtb3VudCIsInRva2VuIiwiZXNjcm93S2V5cGFpciIsInBsYXRmb3JtRmVlIiwiY2FsY3VsYXRlUGxhdGZvcm1GZWUiLCJuZXRBbW91bnQiLCJlc2Nyb3ciLCJlc2Nyb3dBZGRyZXNzIiwiZXNjcm93UHJpdmF0ZUtleSIsInN0YXR1cyIsInNhdmVFc2Nyb3ciLCJjaGVja0VzY3Jvd0Z1bmRpbmciLCJnZXRFc2Nyb3dCeUFkZHJlc3MiLCJiYWxhbmNlIiwiZ2V0QmFsYW5jZSIsIm1hcmtFc2Nyb3dBc0Z1bmRlZCIsImVycm9yIiwiY29uc29sZSIsImNvbXBsZXRlVGFza0FuZFRyYW5zZmVyIiwid29ya2VySWQiLCJnZXRFc2Nyb3dCeVRhc2tJZCIsInN1Y2Nlc3MiLCJ3b3JrZXJXYWxsZXQiLCJnZXRVc2VyV2FsbGV0IiwiZGVjcnlwdFByaXZhdGVLZXkiLCJ0cmFuc2FjdGlvbiIsIndvcmtlclRyYW5zZmVyIiwidHJhbnNmZXIiLCJmcm9tUHVia2V5IiwidG9QdWJrZXkiLCJsYW1wb3J0cyIsIk1hdGgiLCJmbG9vciIsImFkZCIsInR4SGFzaCIsImNvbW1pdG1lbnQiLCJtYXJrRXNjcm93QXNDb21wbGV0ZWQiLCJ1cGRhdGVVc2VyQmFsYW5jZSIsInJld2FyZFdvcmtseVRva2VucyIsImVhcm5lZEFtb3VudCIsIndvcmtseVJld2FyZCIsInVzZXJXYWxsZXQiLCJjYWxjdWxhdGVEaXNjb3VudGVkRmVlIiwiYmFzZUZlZSIsIkJ1ZmZlciIsImZyb20iLCJlbmNyeXB0ZWRLZXkiLCJmcm9tU2VjcmV0S2V5IiwiZGVjb2RlIiwiZnMiLCJyZXF1aXJlIiwicGF0aCIsImZpbGVQYXRoIiwiam9pbiIsInByb2Nlc3MiLCJjd2QiLCJkaXIiLCJkaXJuYW1lIiwiZXhpc3RzU3luYyIsIm1rZGlyU3luYyIsInJlY3Vyc2l2ZSIsIndhbGxldHMiLCJkYXRhIiwicmVhZEZpbGVTeW5jIiwiSlNPTiIsInBhcnNlIiwiZXhpc3RpbmdJbmRleCIsImZpbmRJbmRleCIsInciLCJwdXNoIiwid3JpdGVGaWxlU3luYyIsInN0cmluZ2lmeSIsImZpbmQiLCJlc2Nyb3dzIiwiZSIsImZ1bmRlZEF0IiwiY29tcGxldGVkQXQiLCJ0cmFuc2FjdGlvbnMiLCJpZCIsIm5vdyIsInN5bmNXYWxsZXRCYWxhbmNlIiwibG9nIiwiY3JlYXRlV2FsbGV0Rm9yVXNlciIsImdldFdhbGxldEluZm8iLCJjcmVhdGVUYXNrRXNjcm93QWRkcmVzcyIsImNoZWNrVGFza0Z1bmRpbmciLCJjb21wbGV0ZVRhc2siLCJ3aXRoZHJhd0Z1bmRzIiwidG9BZGRyZXNzIiwiY3VycmVudEJhbGFuY2UiLCJ1c2VyS2V5cGFpciIsImZvcmNlUmVmcmVzaFdhbGxldCIsInByb2Nlc3NXaXRoZHJhd2FsIiwid2FsbGV0U2VydmljZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/wallet/walletService.ts\n");

/***/ }),

/***/ "(api)/./pages/api/wallet/withdraw.ts":
/*!**************************************!*\
  !*** ./pages/api/wallet/withdraw.ts ***!
  \**************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jsonwebtoken */ \"jsonwebtoken\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_wallet_walletService__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/wallet/walletService */ \"(api)/./lib/wallet/walletService.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_wallet_walletService__WEBPACK_IMPORTED_MODULE_1__]);\n_lib_wallet_walletService__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// pages/api/wallet/withdraw.ts\n\n\nconst getUserFromToken = (authHeader)=>{\n    if (!authHeader || !authHeader.startsWith(\"Bearer \")) return null;\n    const token = authHeader.split(\" \")[1];\n    try {\n        const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_0___default().verify(token, process.env.JWT_SECRET || \"workly-local-secret-key-2025\");\n        return decoded;\n    } catch (error) {\n        return null;\n    }\n};\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            error: \"Method not allowed\"\n        });\n    }\n    const user = getUserFromToken(req.headers.authorization);\n    if (!user) {\n        return res.status(401).json({\n            error: \"Unauthorized\"\n        });\n    }\n    try {\n        const { amount, toAddress, token = \"SOL\" } = req.body;\n        if (!amount || amount <= 0) {\n            return res.status(400).json({\n                error: \"Invalid amount\"\n            });\n        }\n        if (!toAddress || typeof toAddress !== \"string\") {\n            return res.status(400).json({\n                error: \"Invalid destination address\"\n            });\n        }\n        // Используем walletService!\n        const result = await _lib_wallet_walletService__WEBPACK_IMPORTED_MODULE_1__.walletService.processWithdrawal(user.userId, parseFloat(amount), toAddress.trim());\n        if (result.success) {\n            res.status(200).json({\n                success: true,\n                message: \"Withdrawal processed successfully\",\n                txHash: result.txHash,\n                explorerUrl: `https://explorer.solana.com/tx/${result.txHash}?cluster=devnet`\n            });\n        } else {\n            res.status(400).json({\n                success: false,\n                error: result.error\n            });\n        }\n    } catch (error) {\n        console.error(\"Withdraw API error:\", error);\n        res.status(500).json({\n            success: false,\n            error: \"Internal server error\"\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvd2FsbGV0L3dpdGhkcmF3LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSwrQkFBK0I7QUFFRDtBQUNtQztBQUVqRSxNQUFNRSxtQkFBbUIsQ0FBQ0M7SUFDeEIsSUFBSSxDQUFDQSxjQUFjLENBQUNBLFdBQVdDLFVBQVUsQ0FBQyxZQUFZLE9BQU87SUFFN0QsTUFBTUMsUUFBUUYsV0FBV0csS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFO0lBQ3RDLElBQUk7UUFDRixNQUFNQyxVQUFVUCwwREFBVSxDQUN4QkssT0FDQUksUUFBUUMsR0FBRyxDQUFDQyxVQUFVLElBQUk7UUFFNUIsT0FBT0o7SUFDVCxFQUFFLE9BQU9LLE9BQU87UUFDZCxPQUFPO0lBQ1Q7QUFDRjtBQUVlLGVBQWVDLFFBQVFDLEdBQW1CLEVBQUVDLEdBQW9CO0lBQzdFLElBQUlELElBQUlFLE1BQU0sS0FBSyxRQUFRO1FBQ3pCLE9BQU9ELElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRU4sT0FBTztRQUFxQjtJQUM1RDtJQUVBLE1BQU1PLE9BQU9qQixpQkFBaUJZLElBQUlNLE9BQU8sQ0FBQ0MsYUFBYTtJQUN2RCxJQUFJLENBQUNGLE1BQU07UUFDVCxPQUFPSixJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVOLE9BQU87UUFBZTtJQUN0RDtJQUVBLElBQUk7UUFDRixNQUFNLEVBQUVVLE1BQU0sRUFBRUMsU0FBUyxFQUFFbEIsUUFBUSxLQUFLLEVBQUUsR0FBR1MsSUFBSVUsSUFBSTtRQUVyRCxJQUFJLENBQUNGLFVBQVVBLFVBQVUsR0FBRztZQUMxQixPQUFPUCxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUFFTixPQUFPO1lBQWlCO1FBQ3hEO1FBRUEsSUFBSSxDQUFDVyxhQUFhLE9BQU9BLGNBQWMsVUFBVTtZQUMvQyxPQUFPUixJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUFFTixPQUFPO1lBQThCO1FBQ3JFO1FBRUEsNEJBQTRCO1FBQzVCLE1BQU1hLFNBQVMsTUFBTXhCLG9FQUFhQSxDQUFDeUIsaUJBQWlCLENBQ2xEUCxLQUFLUSxNQUFNLEVBQ1hDLFdBQVdOLFNBQ1hDLFVBQVVNLElBQUk7UUFHaEIsSUFBSUosT0FBT0ssT0FBTyxFQUFFO1lBQ2xCZixJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUNuQlksU0FBUztnQkFDVEMsU0FBUztnQkFDVEMsUUFBUVAsT0FBT08sTUFBTTtnQkFDckJDLGFBQWEsQ0FBQywrQkFBK0IsRUFBRVIsT0FBT08sTUFBTSxDQUFDLGVBQWUsQ0FBQztZQUMvRTtRQUNGLE9BQU87WUFDTGpCLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQ25CWSxTQUFTO2dCQUNUbEIsT0FBT2EsT0FBT2IsS0FBSztZQUNyQjtRQUNGO0lBRUYsRUFBRSxPQUFPQSxPQUFPO1FBQ2RzQixRQUFRdEIsS0FBSyxDQUFDLHVCQUF1QkE7UUFDckNHLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFDbkJZLFNBQVM7WUFDVGxCLE9BQU87UUFDVDtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90YXNrY2hhaW4tdWkvLi9wYWdlcy9hcGkvd2FsbGV0L3dpdGhkcmF3LnRzP2I5MGIiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gcGFnZXMvYXBpL3dhbGxldC93aXRoZHJhdy50c1xyXG5pbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCdcclxuaW1wb3J0IGp3dCBmcm9tICdqc29ud2VidG9rZW4nXHJcbmltcG9ydCB7IHdhbGxldFNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9saWIvd2FsbGV0L3dhbGxldFNlcnZpY2UnXHJcblxyXG5jb25zdCBnZXRVc2VyRnJvbVRva2VuID0gKGF1dGhIZWFkZXI6IHN0cmluZyB8IHVuZGVmaW5lZCkgPT4ge1xyXG4gIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHJldHVybiBudWxsXHJcbiAgXHJcbiAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyLnNwbGl0KCcgJylbMV1cclxuICB0cnkge1xyXG4gICAgY29uc3QgZGVjb2RlZCA9IGp3dC52ZXJpZnkoXHJcbiAgICAgIHRva2VuLFxyXG4gICAgICBwcm9jZXNzLmVudi5KV1RfU0VDUkVUIHx8ICd3b3JrbHktbG9jYWwtc2VjcmV0LWtleS0yMDI1J1xyXG4gICAgKSBhcyB7IHVzZXJJZDogc3RyaW5nIH1cclxuICAgIHJldHVybiBkZWNvZGVkXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiBudWxsXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSB7XHJcbiAgaWYgKHJlcS5tZXRob2QgIT09ICdQT1NUJykge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgZXJyb3I6ICdNZXRob2Qgbm90IGFsbG93ZWQnIH0pXHJcbiAgfVxyXG5cclxuICBjb25zdCB1c2VyID0gZ2V0VXNlckZyb21Ub2tlbihyZXEuaGVhZGVycy5hdXRob3JpemF0aW9uKVxyXG4gIGlmICghdXNlcikge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0pXHJcbiAgfVxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgeyBhbW91bnQsIHRvQWRkcmVzcywgdG9rZW4gPSAnU09MJyB9ID0gcmVxLmJvZHlcclxuXHJcbiAgICBpZiAoIWFtb3VudCB8fCBhbW91bnQgPD0gMCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ0ludmFsaWQgYW1vdW50JyB9KVxyXG4gICAgfVxyXG5cclxuICAgIGlmICghdG9BZGRyZXNzIHx8IHR5cGVvZiB0b0FkZHJlc3MgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnSW52YWxpZCBkZXN0aW5hdGlvbiBhZGRyZXNzJyB9KVxyXG4gICAgfVxyXG5cclxuICAgIC8vINCY0YHQv9C+0LvRjNC30YPQtdC8IHdhbGxldFNlcnZpY2UhXHJcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB3YWxsZXRTZXJ2aWNlLnByb2Nlc3NXaXRoZHJhd2FsKFxyXG4gICAgICB1c2VyLnVzZXJJZCxcclxuICAgICAgcGFyc2VGbG9hdChhbW91bnQpLFxyXG4gICAgICB0b0FkZHJlc3MudHJpbSgpXHJcbiAgICApXHJcblxyXG4gICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdXaXRoZHJhd2FsIHByb2Nlc3NlZCBzdWNjZXNzZnVsbHknLFxyXG4gICAgICAgIHR4SGFzaDogcmVzdWx0LnR4SGFzaCxcclxuICAgICAgICBleHBsb3JlclVybDogYGh0dHBzOi8vZXhwbG9yZXIuc29sYW5hLmNvbS90eC8ke3Jlc3VsdC50eEhhc2h9P2NsdXN0ZXI9ZGV2bmV0YFxyXG4gICAgICB9KVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiByZXN1bHQuZXJyb3JcclxuICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1dpdGhkcmF3IEFQSSBlcnJvcjonLCBlcnJvcilcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJ1xyXG4gICAgfSlcclxuICB9XHJcbn0iXSwibmFtZXMiOlsiand0Iiwid2FsbGV0U2VydmljZSIsImdldFVzZXJGcm9tVG9rZW4iLCJhdXRoSGVhZGVyIiwic3RhcnRzV2l0aCIsInRva2VuIiwic3BsaXQiLCJkZWNvZGVkIiwidmVyaWZ5IiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJlcnJvciIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJzdGF0dXMiLCJqc29uIiwidXNlciIsImhlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwiYW1vdW50IiwidG9BZGRyZXNzIiwiYm9keSIsInJlc3VsdCIsInByb2Nlc3NXaXRoZHJhd2FsIiwidXNlcklkIiwicGFyc2VGbG9hdCIsInRyaW0iLCJzdWNjZXNzIiwibWVzc2FnZSIsInR4SGFzaCIsImV4cGxvcmVyVXJsIiwiY29uc29sZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/wallet/withdraw.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./pages/api/wallet/withdraw.ts"));
module.exports = __webpack_exports__;

})();