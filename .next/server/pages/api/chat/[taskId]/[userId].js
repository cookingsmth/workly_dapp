"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/chat/[taskId]/[userId]";
exports.ids = ["pages/api/chat/[taskId]/[userId]"];
exports.modules = {

/***/ "jsonwebtoken":
/*!*******************************!*\
  !*** external "jsonwebtoken" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("jsonwebtoken");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "(api)/./pages/api/chat/[taskId]/[userId].ts":
/*!*********************************************!*\
  !*** ./pages/api/chat/[taskId]/[userId].ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! jsonwebtoken */ \"jsonwebtoken\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_2__);\n// pages/api/chat/[taskId]/[userId].ts\n\n\n\n// Пути к файлам\nconst getChatsFilePath = ()=>path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"data\", \"chats.json\");\nconst getTasksFilePath = ()=>path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"data\", \"tasks.json\");\nconst getUsersFilePath = ()=>path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"data\", \"users.json\");\n// Функции для работы с файлами\nconst loadChats = ()=>{\n    const filePath = getChatsFilePath();\n    if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(filePath)) {\n        return [];\n    }\n    try {\n        const data = fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(filePath, \"utf8\");\n        return JSON.parse(data);\n    } catch (error) {\n        console.error(\"Error loading chats:\", error);\n        return [];\n    }\n};\nconst saveChats = (chats)=>{\n    const filePath = getChatsFilePath();\n    const dir = path__WEBPACK_IMPORTED_MODULE_1___default().dirname(filePath);\n    if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(dir)) {\n        fs__WEBPACK_IMPORTED_MODULE_0___default().mkdirSync(dir, {\n            recursive: true\n        });\n    }\n    fs__WEBPACK_IMPORTED_MODULE_0___default().writeFileSync(filePath, JSON.stringify(chats, null, 2));\n};\nconst loadTasks = ()=>{\n    const filePath = getTasksFilePath();\n    if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(filePath)) {\n        return [];\n    }\n    try {\n        const data = fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(filePath, \"utf8\");\n        return JSON.parse(data);\n    } catch (error) {\n        console.error(\"Error loading tasks:\", error);\n        return [];\n    }\n};\nconst loadUsers = ()=>{\n    const filePath = getUsersFilePath();\n    if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(filePath)) {\n        return [];\n    }\n    try {\n        const data = fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(filePath, \"utf8\");\n        return JSON.parse(data);\n    } catch (error) {\n        console.error(\"Error loading users:\", error);\n        return [];\n    }\n};\n// Проверка токена\nconst verifyToken = (token)=>{\n    try {\n        const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_2___default().verify(token, process.env.JWT_SECRET || \"workly-local-secret-key-2025\");\n        return decoded;\n    } catch (error) {\n        return null;\n    }\n};\nconst getUserFromToken = (authHeader)=>{\n    if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\n        return null;\n    }\n    const token = authHeader.split(\" \")[1];\n    const decoded = verifyToken(token);\n    if (!decoded) return null;\n    try {\n        const users = loadUsers();\n        const user = users.find((u)=>u.id === decoded.userId);\n        if (!user) return null;\n        return {\n            id: user.id,\n            username: user.username,\n            email: user.email\n        };\n    } catch (error) {\n        return null;\n    }\n};\n// Создание ID чата\nconst createChatId = (taskId, clientId, freelancerId)=>{\n    return `chat_${taskId}_${clientId}_${freelancerId}`;\n};\nasync function handler(req, res) {\n    const { method } = req;\n    const { taskId, userId } = req.query;\n    const { message, fileUrl, fileName, fileType } = req.body;\n    if (!taskId || !userId || typeof taskId !== \"string\" || typeof userId !== \"string\") {\n        console.log(\"❌ Validation failed - returning 400\");\n        return res.status(400).json({\n            error: \"Bad Request\",\n            message: \"Task ID and User ID are required\"\n        });\n    }\n    // Проверяем аутентификацию\n    const currentUser = getUserFromToken(req.headers.authorization || \"\");\n    if (!currentUser) {\n        console.log(\"❌ Authentication failed - returning 401\");\n        return res.status(401).json({\n            error: \"Unauthorized\",\n            message: \"Authentication required\"\n        });\n    }\n    console.log(\"✅ Validation passed, user:\", currentUser.id);\n    if (method === \"GET\") {\n        try {\n            // Загружаем задачу для получения информации\n            const tasks = loadTasks();\n            const task = tasks.find((t)=>t.id === taskId);\n            if (!task) {\n                return res.status(404).json({\n                    error: \"Not Found\",\n                    message: \"Task not found\"\n                });\n            }\n            // Определяем участников чата\n            let clientId = task.createdBy;\n            let freelancerId = userId;\n            // Если текущий пользователь - создатель задачи, то userId - это фрилансер\n            if (currentUser.id === task.createdBy) {\n                clientId = task.createdBy;\n                freelancerId = userId;\n            } else {\n                // Если текущий пользователь - фрилансер, то userId должен быть создателем задачи\n                clientId = userId;\n                freelancerId = currentUser.id;\n            }\n            // Проверяем права доступа\n            if (currentUser.id !== clientId && currentUser.id !== freelancerId) {\n                return res.status(403).json({\n                    error: \"Forbidden\",\n                    message: \"You are not authorized to access this chat\"\n                });\n            }\n            // Загружаем чаты\n            const chats = loadChats();\n            const chatId = createChatId(taskId, clientId, freelancerId);\n            let chat = chats.find((c)=>c.id === chatId);\n            // Если чат не существует, создаем новый\n            if (!chat) {\n                chat = {\n                    id: chatId,\n                    taskId,\n                    clientId,\n                    freelancerId,\n                    createdAt: new Date().toISOString(),\n                    lastMessageAt: new Date().toISOString(),\n                    messages: []\n                };\n                chats.push(chat);\n                saveChats(chats);\n            }\n            // Получаем информацию о пользователях\n            const users = loadUsers();\n            const clientUser = users.find((u)=>u.id === clientId);\n            const freelancerUser = users.find((u)=>u.id === freelancerId);\n            res.status(200).json({\n                success: true,\n                chat,\n                task: {\n                    id: task.id,\n                    title: task.title,\n                    status: task.status,\n                    workerConfirmed: task.workerConfirmed || false,\n                    clientConfirmed: task.clientConfirmed || false,\n                    assignedTo: task.assignedTo || null,\n                    createdBy: task.createdBy || null,\n                    reward: task.reward || 0\n                },\n                participants: {\n                    client: clientUser ? {\n                        id: clientUser.id,\n                        username: clientUser.username,\n                        email: clientUser.email\n                    } : null,\n                    freelancer: freelancerUser ? {\n                        id: freelancerUser.id,\n                        username: freelancerUser.username,\n                        email: freelancerUser.email\n                    } : null\n                },\n                currentUserId: currentUser.id\n            });\n        } catch (error) {\n            console.error(\"Get chat error:\", error);\n            res.status(500).json({\n                error: \"Internal server error\",\n                message: \"Failed to get chat\"\n            });\n        }\n    } else if (method === \"POST\") {\n        try {\n            const { message } = req.body;\n            if (!message || !message.trim()) {\n                return res.status(400).json({\n                    error: \"Bad Request\",\n                    message: \"Message text is required\"\n                });\n            }\n            // Загружаем задачу\n            const tasks = loadTasks();\n            const task = tasks.find((t)=>t.id === taskId);\n            if (!task) {\n                return res.status(404).json({\n                    error: \"Not Found\",\n                    message: \"Task not found\"\n                });\n            }\n            // Определяем участников чата\n            let clientId = task.createdBy;\n            let freelancerId = userId;\n            if (currentUser.id === task.createdBy) {\n                clientId = task.createdBy;\n                freelancerId = userId;\n            } else {\n                clientId = userId;\n                freelancerId = currentUser.id;\n            }\n            // Проверяем права доступа\n            if (currentUser.id !== clientId && currentUser.id !== freelancerId) {\n                return res.status(403).json({\n                    error: \"Forbidden\",\n                    message: \"You are not authorized to send messages in this chat\"\n                });\n            }\n            // Загружаем чаты\n            const chats = loadChats();\n            const chatId = createChatId(taskId, clientId, freelancerId);\n            let chat = chats.find((c)=>c.id === chatId);\n            const chatIndex = chats.findIndex((c)=>c.id === chatId);\n            // Если чат не существует, создаем его\n            if (!chat) {\n                chat = {\n                    id: chatId,\n                    taskId,\n                    clientId,\n                    freelancerId,\n                    createdAt: new Date().toISOString(),\n                    lastMessageAt: new Date().toISOString(),\n                    messages: []\n                };\n                chats.push(chat);\n            }\n            // Создаем новое сообщение\n            const newMessage = {\n                id: `msg_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n                senderId: currentUser.id,\n                text: message,\n                timestamp: new Date().toISOString(),\n                status: \"sent\",\n                // Добавляем поддержку файлов\n                ...fileUrl && {\n                    fileUrl,\n                    fileName,\n                    fileType\n                }\n            };\n            // Добавляем сообщение в чат\n            if (chatIndex >= 0) {\n                chats[chatIndex].messages.push(newMessage);\n                chats[chatIndex].lastMessageAt = newMessage.timestamp;\n            } else {\n                chat.messages.push(newMessage);\n                chat.lastMessageAt = newMessage.timestamp;\n                chats.push(chat);\n            }\n            // Сохраняем изменения\n            saveChats(chats);\n            res.status(201).json({\n                success: true,\n                message: newMessage,\n                chat: chats[chatIndex >= 0 ? chatIndex : chats.length - 1]\n            });\n        } catch (error) {\n            console.error(\"Send message error:\", error);\n            res.status(500).json({\n                error: \"Internal server error\",\n                message: \"Failed to send message\"\n            });\n        }\n    } else {\n        res.status(405).json({\n            error: \"Method not allowed\",\n            message: `Method ${method} is not supported`\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvY2hhdC9bdGFza0lkXS9bdXNlcklkXS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUEsc0NBQXNDO0FBRW5CO0FBQ0k7QUFDTztBQXdCOUIsZ0JBQWdCO0FBQ2hCLE1BQU1HLG1CQUFtQixJQUFNRixnREFBUyxDQUFDSSxRQUFRQyxHQUFHLElBQUksUUFBUTtBQUNoRSxNQUFNQyxtQkFBbUIsSUFBTU4sZ0RBQVMsQ0FBQ0ksUUFBUUMsR0FBRyxJQUFJLFFBQVE7QUFDaEUsTUFBTUUsbUJBQW1CLElBQU1QLGdEQUFTLENBQUNJLFFBQVFDLEdBQUcsSUFBSSxRQUFRO0FBRWhFLCtCQUErQjtBQUMvQixNQUFNRyxZQUFZO0lBQ2hCLE1BQU1DLFdBQVdQO0lBRWpCLElBQUksQ0FBQ0gsb0RBQWEsQ0FBQ1UsV0FBVztRQUM1QixPQUFPLEVBQUU7SUFDWDtJQUVBLElBQUk7UUFDRixNQUFNRSxPQUFPWixzREFBZSxDQUFDVSxVQUFVO1FBQ3ZDLE9BQU9JLEtBQUtDLEtBQUssQ0FBQ0g7SUFDcEIsRUFBRSxPQUFPSSxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQyx3QkFBd0JBO1FBQ3RDLE9BQU8sRUFBRTtJQUNYO0FBQ0Y7QUFFQSxNQUFNRSxZQUFZLENBQUNDO0lBQ2pCLE1BQU1ULFdBQVdQO0lBQ2pCLE1BQU1pQixNQUFNbkIsbURBQVksQ0FBQ1M7SUFFekIsSUFBSSxDQUFDVixvREFBYSxDQUFDb0IsTUFBTTtRQUN2QnBCLG1EQUFZLENBQUNvQixLQUFLO1lBQUVHLFdBQVc7UUFBSztJQUN0QztJQUVBdkIsdURBQWdCLENBQUNVLFVBQVVJLEtBQUtXLFNBQVMsQ0FBQ04sT0FBTyxNQUFNO0FBQ3pEO0FBRUEsTUFBTU8sWUFBWTtJQUNoQixNQUFNaEIsV0FBV0g7SUFFakIsSUFBSSxDQUFDUCxvREFBYSxDQUFDVSxXQUFXO1FBQzVCLE9BQU8sRUFBRTtJQUNYO0lBRUEsSUFBSTtRQUNGLE1BQU1FLE9BQU9aLHNEQUFlLENBQUNVLFVBQVU7UUFDdkMsT0FBT0ksS0FBS0MsS0FBSyxDQUFDSDtJQUNwQixFQUFFLE9BQU9JLE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLHdCQUF3QkE7UUFDdEMsT0FBTyxFQUFFO0lBQ1g7QUFDRjtBQUVBLE1BQU1XLFlBQVk7SUFDaEIsTUFBTWpCLFdBQVdGO0lBRWpCLElBQUksQ0FBQ1Isb0RBQWEsQ0FBQ1UsV0FBVztRQUM1QixPQUFPLEVBQUU7SUFDWDtJQUVBLElBQUk7UUFDRixNQUFNRSxPQUFPWixzREFBZSxDQUFDVSxVQUFVO1FBQ3ZDLE9BQU9JLEtBQUtDLEtBQUssQ0FBQ0g7SUFDcEIsRUFBRSxPQUFPSSxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQyx3QkFBd0JBO1FBQ3RDLE9BQU8sRUFBRTtJQUNYO0FBQ0Y7QUFFQSxrQkFBa0I7QUFDbEIsTUFBTVksY0FBYyxDQUFDQztJQUNuQixJQUFJO1FBQ0YsTUFBTUMsVUFBVTVCLDBEQUFVLENBQ3hCMkIsT0FDQXhCLFFBQVEyQixHQUFHLENBQUNDLFVBQVUsSUFBSTtRQUU1QixPQUFPSDtJQUNULEVBQUUsT0FBT2QsT0FBTztRQUNkLE9BQU87SUFDVDtBQUNGO0FBRUEsTUFBTWtCLG1CQUFtQixDQUFDQztJQUN4QixJQUFJLENBQUNBLGNBQWMsQ0FBQ0EsV0FBV0MsVUFBVSxDQUFDLFlBQVk7UUFDcEQsT0FBTztJQUNUO0lBRUEsTUFBTVAsUUFBUU0sV0FBV0UsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFO0lBQ3RDLE1BQU1QLFVBQVVGLFlBQVlDO0lBRTVCLElBQUksQ0FBQ0MsU0FBUyxPQUFPO0lBRXJCLElBQUk7UUFDRixNQUFNUSxRQUFRWDtRQUNkLE1BQU1ZLE9BQU9ELE1BQU1FLElBQUksQ0FBQyxDQUFDQyxJQUFXQSxFQUFFQyxFQUFFLEtBQUtaLFFBQVFhLE1BQU07UUFFM0QsSUFBSSxDQUFDSixNQUFNLE9BQU87UUFFbEIsT0FBTztZQUNMRyxJQUFJSCxLQUFLRyxFQUFFO1lBQ1hFLFVBQVVMLEtBQUtLLFFBQVE7WUFDdkJDLE9BQU9OLEtBQUtNLEtBQUs7UUFDbkI7SUFDRixFQUFFLE9BQU83QixPQUFPO1FBQ2QsT0FBTztJQUNUO0FBQ0Y7QUFFQSxtQkFBbUI7QUFDbkIsTUFBTThCLGVBQWUsQ0FBQ0MsUUFBZ0JDLFVBQWtCQztJQUN0RCxPQUFPLENBQUMsS0FBSyxFQUFFRixPQUFPLENBQUMsRUFBRUMsU0FBUyxDQUFDLEVBQUVDLGFBQWEsQ0FBQztBQUNyRDtBQUVlLGVBQWVDLFFBQVFDLEdBQW1CLEVBQUVDLEdBQW9CO0lBQzdFLE1BQU0sRUFBRUMsTUFBTSxFQUFFLEdBQUdGO0lBQ25CLE1BQU0sRUFBRUosTUFBTSxFQUFFSixNQUFNLEVBQUUsR0FBR1EsSUFBSUcsS0FBSztJQUNwQyxNQUFNLEVBQUVDLE9BQU8sRUFBRUMsT0FBTyxFQUFFQyxRQUFRLEVBQUVDLFFBQVEsRUFBRSxHQUFHUCxJQUFJUSxJQUFJO0lBRXpELElBQUksQ0FBQ1osVUFBVSxDQUFDSixVQUFVLE9BQU9JLFdBQVcsWUFBWSxPQUFPSixXQUFXLFVBQVU7UUFDbEYxQixRQUFRMkMsR0FBRyxDQUFDO1FBQ1osT0FBT1IsSUFBSVMsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUMxQjlDLE9BQU87WUFDUHVDLFNBQVM7UUFDWDtJQUNGO0lBRUEsMkJBQTJCO0lBQzNCLE1BQU1RLGNBQWM3QixpQkFBaUJpQixJQUFJYSxPQUFPLENBQUNDLGFBQWEsSUFBSTtJQUVsRSxJQUFJLENBQUNGLGFBQWE7UUFDaEI5QyxRQUFRMkMsR0FBRyxDQUFDO1FBQ1osT0FBT1IsSUFBSVMsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUMxQjlDLE9BQU87WUFDUHVDLFNBQVM7UUFDWDtJQUNGO0lBRUF0QyxRQUFRMkMsR0FBRyxDQUFDLDhCQUE4QkcsWUFBWXJCLEVBQUU7SUFFeEQsSUFBSVcsV0FBVyxPQUFPO1FBQ3BCLElBQUk7WUFDRiw0Q0FBNEM7WUFDNUMsTUFBTWEsUUFBUXhDO1lBQ2QsTUFBTXlDLE9BQU9ELE1BQU0xQixJQUFJLENBQUMsQ0FBQzRCLElBQVdBLEVBQUUxQixFQUFFLEtBQUtLO1lBRTdDLElBQUksQ0FBQ29CLE1BQU07Z0JBQ1QsT0FBT2YsSUFBSVMsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztvQkFDMUI5QyxPQUFPO29CQUNQdUMsU0FBUztnQkFDWDtZQUNGO1lBRUEsNkJBQTZCO1lBQzdCLElBQUlQLFdBQVdtQixLQUFLRSxTQUFTO1lBQzdCLElBQUlwQixlQUFlTjtZQUVuQiwwRUFBMEU7WUFDMUUsSUFBSW9CLFlBQVlyQixFQUFFLEtBQUt5QixLQUFLRSxTQUFTLEVBQUU7Z0JBQ3JDckIsV0FBV21CLEtBQUtFLFNBQVM7Z0JBQ3pCcEIsZUFBZU47WUFDakIsT0FBTztnQkFDTCxpRkFBaUY7Z0JBQ2pGSyxXQUFXTDtnQkFDWE0sZUFBZWMsWUFBWXJCLEVBQUU7WUFDL0I7WUFFQSwwQkFBMEI7WUFDMUIsSUFBSXFCLFlBQVlyQixFQUFFLEtBQUtNLFlBQVllLFlBQVlyQixFQUFFLEtBQUtPLGNBQWM7Z0JBQ2xFLE9BQU9HLElBQUlTLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7b0JBQzFCOUMsT0FBTztvQkFDUHVDLFNBQVM7Z0JBQ1g7WUFDRjtZQUVBLGlCQUFpQjtZQUNqQixNQUFNcEMsUUFBUVY7WUFDZCxNQUFNNkQsU0FBU3hCLGFBQWFDLFFBQVFDLFVBQVVDO1lBRTlDLElBQUlzQixPQUFPcEQsTUFBTXFCLElBQUksQ0FBQ2dDLENBQUFBLElBQUtBLEVBQUU5QixFQUFFLEtBQUs0QjtZQUVwQyx3Q0FBd0M7WUFDeEMsSUFBSSxDQUFDQyxNQUFNO2dCQUNUQSxPQUFPO29CQUNMN0IsSUFBSTRCO29CQUNKdkI7b0JBQ0FDO29CQUNBQztvQkFDQXdCLFdBQVcsSUFBSUMsT0FBT0MsV0FBVztvQkFDakNDLGVBQWUsSUFBSUYsT0FBT0MsV0FBVztvQkFDckNFLFVBQVUsRUFBRTtnQkFDZDtnQkFFQTFELE1BQU0yRCxJQUFJLENBQUNQO2dCQUNYckQsVUFBVUM7WUFDWjtZQUVBLHNDQUFzQztZQUN0QyxNQUFNbUIsUUFBUVg7WUFDZCxNQUFNb0QsYUFBYXpDLE1BQU1FLElBQUksQ0FBQyxDQUFDQyxJQUFXQSxFQUFFQyxFQUFFLEtBQUtNO1lBQ25ELE1BQU1nQyxpQkFBaUIxQyxNQUFNRSxJQUFJLENBQUMsQ0FBQ0MsSUFBV0EsRUFBRUMsRUFBRSxLQUFLTztZQUV2REcsSUFBSVMsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFDbkJtQixTQUFTO2dCQUNUVjtnQkFDQUosTUFBTTtvQkFDSnpCLElBQUl5QixLQUFLekIsRUFBRTtvQkFDWHdDLE9BQU9mLEtBQUtlLEtBQUs7b0JBQ2pCckIsUUFBUU0sS0FBS04sTUFBTTtvQkFDbkJzQixpQkFBaUJoQixLQUFLZ0IsZUFBZSxJQUFJO29CQUN6Q0MsaUJBQWlCakIsS0FBS2lCLGVBQWUsSUFBSTtvQkFDekNDLFlBQVlsQixLQUFLa0IsVUFBVSxJQUFJO29CQUMvQmhCLFdBQVdGLEtBQUtFLFNBQVMsSUFBSTtvQkFDN0JpQixRQUFRbkIsS0FBS21CLE1BQU0sSUFBSTtnQkFDekI7Z0JBQ0FDLGNBQWM7b0JBQ1pDLFFBQVFULGFBQWE7d0JBQ25CckMsSUFBSXFDLFdBQVdyQyxFQUFFO3dCQUNqQkUsVUFBVW1DLFdBQVduQyxRQUFRO3dCQUM3QkMsT0FBT2tDLFdBQVdsQyxLQUFLO29CQUN6QixJQUFJO29CQUNKNEMsWUFBWVQsaUJBQWlCO3dCQUMzQnRDLElBQUlzQyxlQUFldEMsRUFBRTt3QkFDckJFLFVBQVVvQyxlQUFlcEMsUUFBUTt3QkFDakNDLE9BQU9tQyxlQUFlbkMsS0FBSztvQkFDN0IsSUFBSTtnQkFDTjtnQkFDQTZDLGVBQWUzQixZQUFZckIsRUFBRTtZQUMvQjtRQUVGLEVBQUUsT0FBTzFCLE9BQU87WUFDZEMsUUFBUUQsS0FBSyxDQUFDLG1CQUFtQkE7WUFDakNvQyxJQUFJUyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUNuQjlDLE9BQU87Z0JBQ1B1QyxTQUFTO1lBQ1g7UUFDRjtJQUVGLE9BQU8sSUFBSUYsV0FBVyxRQUFRO1FBQzVCLElBQUk7WUFDRixNQUFNLEVBQUVFLE9BQU8sRUFBRSxHQUFHSixJQUFJUSxJQUFJO1lBRTVCLElBQUksQ0FBQ0osV0FBVyxDQUFDQSxRQUFRb0MsSUFBSSxJQUFJO2dCQUMvQixPQUFPdkMsSUFBSVMsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztvQkFDMUI5QyxPQUFPO29CQUNQdUMsU0FBUztnQkFDWDtZQUNGO1lBRUEsbUJBQW1CO1lBQ25CLE1BQU1XLFFBQVF4QztZQUNkLE1BQU15QyxPQUFPRCxNQUFNMUIsSUFBSSxDQUFDLENBQUM0QixJQUFXQSxFQUFFMUIsRUFBRSxLQUFLSztZQUU3QyxJQUFJLENBQUNvQixNQUFNO2dCQUNULE9BQU9mLElBQUlTLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7b0JBQzFCOUMsT0FBTztvQkFDUHVDLFNBQVM7Z0JBQ1g7WUFDRjtZQUVBLDZCQUE2QjtZQUM3QixJQUFJUCxXQUFXbUIsS0FBS0UsU0FBUztZQUM3QixJQUFJcEIsZUFBZU47WUFFbkIsSUFBSW9CLFlBQVlyQixFQUFFLEtBQUt5QixLQUFLRSxTQUFTLEVBQUU7Z0JBQ3JDckIsV0FBV21CLEtBQUtFLFNBQVM7Z0JBQ3pCcEIsZUFBZU47WUFDakIsT0FBTztnQkFDTEssV0FBV0w7Z0JBQ1hNLGVBQWVjLFlBQVlyQixFQUFFO1lBQy9CO1lBRUEsMEJBQTBCO1lBQzFCLElBQUlxQixZQUFZckIsRUFBRSxLQUFLTSxZQUFZZSxZQUFZckIsRUFBRSxLQUFLTyxjQUFjO2dCQUNsRSxPQUFPRyxJQUFJUyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO29CQUMxQjlDLE9BQU87b0JBQ1B1QyxTQUFTO2dCQUNYO1lBQ0Y7WUFFQSxpQkFBaUI7WUFDakIsTUFBTXBDLFFBQVFWO1lBQ2QsTUFBTTZELFNBQVN4QixhQUFhQyxRQUFRQyxVQUFVQztZQUU5QyxJQUFJc0IsT0FBT3BELE1BQU1xQixJQUFJLENBQUNnQyxDQUFBQSxJQUFLQSxFQUFFOUIsRUFBRSxLQUFLNEI7WUFDcEMsTUFBTXNCLFlBQVl6RSxNQUFNMEUsU0FBUyxDQUFDckIsQ0FBQUEsSUFBS0EsRUFBRTlCLEVBQUUsS0FBSzRCO1lBRWhELHNDQUFzQztZQUN0QyxJQUFJLENBQUNDLE1BQU07Z0JBQ1RBLE9BQU87b0JBQ0w3QixJQUFJNEI7b0JBQ0p2QjtvQkFDQUM7b0JBQ0FDO29CQUNBd0IsV0FBVyxJQUFJQyxPQUFPQyxXQUFXO29CQUNqQ0MsZUFBZSxJQUFJRixPQUFPQyxXQUFXO29CQUNyQ0UsVUFBVSxFQUFFO2dCQUNkO2dCQUNBMUQsTUFBTTJELElBQUksQ0FBQ1A7WUFDYjtZQUVBLDBCQUEwQjtZQUMxQixNQUFNdUIsYUFBYTtnQkFDakJwRCxJQUFJLENBQUMsSUFBSSxFQUFFZ0MsS0FBS3FCLEdBQUcsR0FBRyxDQUFDLEVBQUVDLEtBQUtDLE1BQU0sR0FBR0MsUUFBUSxDQUFDLElBQUlDLE1BQU0sQ0FBQyxHQUFHLEdBQUcsQ0FBQztnQkFDbEVDLFVBQVVyQyxZQUFZckIsRUFBRTtnQkFDeEIyRCxNQUFNOUM7Z0JBQ04rQyxXQUFXLElBQUk1QixPQUFPQyxXQUFXO2dCQUNqQ2QsUUFBUTtnQkFDUiw2QkFBNkI7Z0JBQzdCLEdBQUlMLFdBQVc7b0JBQ2JBO29CQUNBQztvQkFDQUM7Z0JBQ0YsQ0FBQztZQUNIO1lBRUEsNEJBQTRCO1lBQzVCLElBQUlrQyxhQUFhLEdBQUc7Z0JBQ2xCekUsS0FBSyxDQUFDeUUsVUFBVSxDQUFDZixRQUFRLENBQUNDLElBQUksQ0FBQ2dCO2dCQUMvQjNFLEtBQUssQ0FBQ3lFLFVBQVUsQ0FBQ2hCLGFBQWEsR0FBR2tCLFdBQVdRLFNBQVM7WUFDdkQsT0FBTztnQkFDTC9CLEtBQUtNLFFBQVEsQ0FBQ0MsSUFBSSxDQUFDZ0I7Z0JBQ25CdkIsS0FBS0ssYUFBYSxHQUFHa0IsV0FBV1EsU0FBUztnQkFDekNuRixNQUFNMkQsSUFBSSxDQUFDUDtZQUNiO1lBRUEsc0JBQXNCO1lBQ3RCckQsVUFBVUM7WUFFVmlDLElBQUlTLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQ25CbUIsU0FBUztnQkFDVDFCLFNBQVN1QztnQkFDVHZCLE1BQU1wRCxLQUFLLENBQUN5RSxhQUFhLElBQUlBLFlBQVl6RSxNQUFNb0YsTUFBTSxHQUFHLEVBQUU7WUFDNUQ7UUFFRixFQUFFLE9BQU92RixPQUFPO1lBQ2RDLFFBQVFELEtBQUssQ0FBQyx1QkFBdUJBO1lBQ3JDb0MsSUFBSVMsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztnQkFDbkI5QyxPQUFPO2dCQUNQdUMsU0FBUztZQUNYO1FBQ0Y7SUFFRixPQUFPO1FBQ0xILElBQUlTLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFDbkI5QyxPQUFPO1lBQ1B1QyxTQUFTLENBQUMsT0FBTyxFQUFFRixPQUFPLGlCQUFpQixDQUFDO1FBQzlDO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3Rhc2tjaGFpbi11aS8uL3BhZ2VzL2FwaS9jaGF0L1t0YXNrSWRdL1t1c2VySWRdLnRzPzExNjAiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gcGFnZXMvYXBpL2NoYXQvW3Rhc2tJZF0vW3VzZXJJZF0udHNcclxuaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnXHJcbmltcG9ydCBmcyBmcm9tICdmcydcclxuaW1wb3J0IHBhdGggZnJvbSAncGF0aCdcclxuaW1wb3J0IGp3dCBmcm9tICdqc29ud2VidG9rZW4nXHJcblxyXG4vLyDQodGC0YDRg9C60YLRg9GA0LAg0YfQsNGC0LBcclxuaW50ZXJmYWNlIENoYXRNZXNzYWdlIHtcclxuICBpZDogc3RyaW5nXHJcbiAgc2VuZGVySWQ6IHN0cmluZ1xyXG4gIHRleHQ6IHN0cmluZ1xyXG4gIHRpbWVzdGFtcDogc3RyaW5nXHJcbiAgc3RhdHVzOiAnc2VudCcgfCAnZGVsaXZlcmVkJyB8ICdyZWFkJ1xyXG4gIGZpbGVVcmw/OiBzdHJpbmdcclxuICBmaWxlTmFtZT86IHN0cmluZyBcclxuICBmaWxlVHlwZT86IHN0cmluZyBcclxufVxyXG5cclxuaW50ZXJmYWNlIENoYXQge1xyXG4gIGlkOiBzdHJpbmdcclxuICB0YXNrSWQ6IHN0cmluZ1xyXG4gIGNsaWVudElkOiBzdHJpbmdcclxuICBmcmVlbGFuY2VySWQ6IHN0cmluZ1xyXG4gIGNyZWF0ZWRBdDogc3RyaW5nXHJcbiAgbGFzdE1lc3NhZ2VBdDogc3RyaW5nXHJcbiAgbWVzc2FnZXM6IENoYXRNZXNzYWdlW11cclxufVxyXG5cclxuLy8g0J/Rg9GC0Lgg0Log0YTQsNC50LvQsNC8XHJcbmNvbnN0IGdldENoYXRzRmlsZVBhdGggPSAoKSA9PiBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2RhdGEnLCAnY2hhdHMuanNvbicpXHJcbmNvbnN0IGdldFRhc2tzRmlsZVBhdGggPSAoKSA9PiBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2RhdGEnLCAndGFza3MuanNvbicpXHJcbmNvbnN0IGdldFVzZXJzRmlsZVBhdGggPSAoKSA9PiBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2RhdGEnLCAndXNlcnMuanNvbicpXHJcblxyXG4vLyDQpNGD0L3QutGG0LjQuCDQtNC70Y8g0YDQsNCx0L7RgtGLINGBINGE0LDQudC70LDQvNC4XHJcbmNvbnN0IGxvYWRDaGF0cyA9ICgpOiBDaGF0W10gPT4ge1xyXG4gIGNvbnN0IGZpbGVQYXRoID0gZ2V0Q2hhdHNGaWxlUGF0aCgpXHJcblxyXG4gIGlmICghZnMuZXhpc3RzU3luYyhmaWxlUGF0aCkpIHtcclxuICAgIHJldHVybiBbXVxyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGRhdGEgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZVBhdGgsICd1dGY4JylcclxuICAgIHJldHVybiBKU09OLnBhcnNlKGRhdGEpXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvYWRpbmcgY2hhdHM6JywgZXJyb3IpXHJcbiAgICByZXR1cm4gW11cclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IHNhdmVDaGF0cyA9IChjaGF0czogQ2hhdFtdKSA9PiB7XHJcbiAgY29uc3QgZmlsZVBhdGggPSBnZXRDaGF0c0ZpbGVQYXRoKClcclxuICBjb25zdCBkaXIgPSBwYXRoLmRpcm5hbWUoZmlsZVBhdGgpXHJcblxyXG4gIGlmICghZnMuZXhpc3RzU3luYyhkaXIpKSB7XHJcbiAgICBmcy5ta2RpclN5bmMoZGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KVxyXG4gIH1cclxuXHJcbiAgZnMud3JpdGVGaWxlU3luYyhmaWxlUGF0aCwgSlNPTi5zdHJpbmdpZnkoY2hhdHMsIG51bGwsIDIpKVxyXG59XHJcblxyXG5jb25zdCBsb2FkVGFza3MgPSAoKSA9PiB7XHJcbiAgY29uc3QgZmlsZVBhdGggPSBnZXRUYXNrc0ZpbGVQYXRoKClcclxuXHJcbiAgaWYgKCFmcy5leGlzdHNTeW5jKGZpbGVQYXRoKSkge1xyXG4gICAgcmV0dXJuIFtdXHJcbiAgfVxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgZGF0YSA9IGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwgJ3V0ZjgnKVxyXG4gICAgcmV0dXJuIEpTT04ucGFyc2UoZGF0YSlcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgbG9hZGluZyB0YXNrczonLCBlcnJvcilcclxuICAgIHJldHVybiBbXVxyXG4gIH1cclxufVxyXG5cclxuY29uc3QgbG9hZFVzZXJzID0gKCkgPT4ge1xyXG4gIGNvbnN0IGZpbGVQYXRoID0gZ2V0VXNlcnNGaWxlUGF0aCgpXHJcblxyXG4gIGlmICghZnMuZXhpc3RzU3luYyhmaWxlUGF0aCkpIHtcclxuICAgIHJldHVybiBbXVxyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGRhdGEgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZVBhdGgsICd1dGY4JylcclxuICAgIHJldHVybiBKU09OLnBhcnNlKGRhdGEpXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvYWRpbmcgdXNlcnM6JywgZXJyb3IpXHJcbiAgICByZXR1cm4gW11cclxuICB9XHJcbn1cclxuXHJcbi8vINCf0YDQvtCy0LXRgNC60LAg0YLQvtC60LXQvdCwXHJcbmNvbnN0IHZlcmlmeVRva2VuID0gKHRva2VuOiBzdHJpbmcpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgZGVjb2RlZCA9IGp3dC52ZXJpZnkoXHJcbiAgICAgIHRva2VuLFxyXG4gICAgICBwcm9jZXNzLmVudi5KV1RfU0VDUkVUIHx8ICd3b3JrbHktbG9jYWwtc2VjcmV0LWtleS0yMDI1J1xyXG4gICAgKSBhcyB7IHVzZXJJZDogc3RyaW5nIH1cclxuICAgIHJldHVybiBkZWNvZGVkXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiBudWxsXHJcbiAgfVxyXG59XHJcblxyXG5jb25zdCBnZXRVc2VyRnJvbVRva2VuID0gKGF1dGhIZWFkZXI6IHN0cmluZykgPT4ge1xyXG4gIGlmICghYXV0aEhlYWRlciB8fCAhYXV0aEhlYWRlci5zdGFydHNXaXRoKCdCZWFyZXIgJykpIHtcclxuICAgIHJldHVybiBudWxsXHJcbiAgfVxyXG5cclxuICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIuc3BsaXQoJyAnKVsxXVxyXG4gIGNvbnN0IGRlY29kZWQgPSB2ZXJpZnlUb2tlbih0b2tlbilcclxuXHJcbiAgaWYgKCFkZWNvZGVkKSByZXR1cm4gbnVsbFxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgdXNlcnMgPSBsb2FkVXNlcnMoKVxyXG4gICAgY29uc3QgdXNlciA9IHVzZXJzLmZpbmQoKHU6IGFueSkgPT4gdS5pZCA9PT0gZGVjb2RlZC51c2VySWQpXHJcblxyXG4gICAgaWYgKCF1c2VyKSByZXR1cm4gbnVsbFxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGlkOiB1c2VyLmlkLFxyXG4gICAgICB1c2VybmFtZTogdXNlci51c2VybmFtZSxcclxuICAgICAgZW1haWw6IHVzZXIuZW1haWxcclxuICAgIH1cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgcmV0dXJuIG51bGxcclxuICB9XHJcbn1cclxuXHJcbi8vINCh0L7Qt9C00LDQvdC40LUgSUQg0YfQsNGC0LBcclxuY29uc3QgY3JlYXRlQ2hhdElkID0gKHRhc2tJZDogc3RyaW5nLCBjbGllbnRJZDogc3RyaW5nLCBmcmVlbGFuY2VySWQ6IHN0cmluZykgPT4ge1xyXG4gIHJldHVybiBgY2hhdF8ke3Rhc2tJZH1fJHtjbGllbnRJZH1fJHtmcmVlbGFuY2VySWR9YFxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSB7XHJcbiAgY29uc3QgeyBtZXRob2QgfSA9IHJlcVxyXG4gIGNvbnN0IHsgdGFza0lkLCB1c2VySWQgfSA9IHJlcS5xdWVyeVxyXG4gIGNvbnN0IHsgbWVzc2FnZSwgZmlsZVVybCwgZmlsZU5hbWUsIGZpbGVUeXBlIH0gPSByZXEuYm9keVxyXG5cclxuICBpZiAoIXRhc2tJZCB8fCAhdXNlcklkIHx8IHR5cGVvZiB0YXNrSWQgIT09ICdzdHJpbmcnIHx8IHR5cGVvZiB1c2VySWQgIT09ICdzdHJpbmcnKSB7XHJcbiAgICBjb25zb2xlLmxvZygn4p2MIFZhbGlkYXRpb24gZmFpbGVkIC0gcmV0dXJuaW5nIDQwMCcpXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICBlcnJvcjogJ0JhZCBSZXF1ZXN0JyxcclxuICAgICAgbWVzc2FnZTogJ1Rhc2sgSUQgYW5kIFVzZXIgSUQgYXJlIHJlcXVpcmVkJ1xyXG4gICAgfSlcclxuICB9XHJcblxyXG4gIC8vINCf0YDQvtCy0LXRgNGP0LXQvCDQsNGD0YLQtdC90YLQuNGE0LjQutCw0YbQuNGOXHJcbiAgY29uc3QgY3VycmVudFVzZXIgPSBnZXRVc2VyRnJvbVRva2VuKHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb24gfHwgJycpXHJcblxyXG4gIGlmICghY3VycmVudFVzZXIpIHtcclxuICAgIGNvbnNvbGUubG9nKCfinYwgQXV0aGVudGljYXRpb24gZmFpbGVkIC0gcmV0dXJuaW5nIDQwMScpXHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xyXG4gICAgICBlcnJvcjogJ1VuYXV0aG9yaXplZCcsXHJcbiAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCdcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICBjb25zb2xlLmxvZygn4pyFIFZhbGlkYXRpb24gcGFzc2VkLCB1c2VyOicsIGN1cnJlbnRVc2VyLmlkKVxyXG5cclxuICBpZiAobWV0aG9kID09PSAnR0VUJykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8g0JfQsNCz0YDRg9C20LDQtdC8INC30LDQtNCw0YfRgyDQtNC70Y8g0L/QvtC70YPRh9C10L3QuNGPINC40L3RhNC+0YDQvNCw0YbQuNC4XHJcbiAgICAgIGNvbnN0IHRhc2tzID0gbG9hZFRhc2tzKClcclxuICAgICAgY29uc3QgdGFzayA9IHRhc2tzLmZpbmQoKHQ6IGFueSkgPT4gdC5pZCA9PT0gdGFza0lkKVxyXG5cclxuICAgICAgaWYgKCF0YXNrKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICAgIGVycm9yOiAnTm90IEZvdW5kJyxcclxuICAgICAgICAgIG1lc3NhZ2U6ICdUYXNrIG5vdCBmb3VuZCdcclxuICAgICAgICB9KVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDQntC/0YDQtdC00LXQu9GP0LXQvCDRg9GH0LDRgdGC0L3QuNC60L7QsiDRh9Cw0YLQsFxyXG4gICAgICBsZXQgY2xpZW50SWQgPSB0YXNrLmNyZWF0ZWRCeVxyXG4gICAgICBsZXQgZnJlZWxhbmNlcklkID0gdXNlcklkXHJcblxyXG4gICAgICAvLyDQldGB0LvQuCDRgtC10LrRg9GJ0LjQuSDQv9C+0LvRjNC30L7QstCw0YLQtdC70YwgLSDRgdC+0LfQtNCw0YLQtdC70Ywg0LfQsNC00LDRh9C4LCDRgtC+IHVzZXJJZCAtINGN0YLQviDRhNGA0LjQu9Cw0L3RgdC10YBcclxuICAgICAgaWYgKGN1cnJlbnRVc2VyLmlkID09PSB0YXNrLmNyZWF0ZWRCeSkge1xyXG4gICAgICAgIGNsaWVudElkID0gdGFzay5jcmVhdGVkQnlcclxuICAgICAgICBmcmVlbGFuY2VySWQgPSB1c2VySWRcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyDQldGB0LvQuCDRgtC10LrRg9GJ0LjQuSDQv9C+0LvRjNC30L7QstCw0YLQtdC70YwgLSDRhNGA0LjQu9Cw0L3RgdC10YAsINGC0L4gdXNlcklkINC00L7Qu9C20LXQvSDQsdGL0YLRjCDRgdC+0LfQtNCw0YLQtdC70LXQvCDQt9Cw0LTQsNGH0LhcclxuICAgICAgICBjbGllbnRJZCA9IHVzZXJJZFxyXG4gICAgICAgIGZyZWVsYW5jZXJJZCA9IGN1cnJlbnRVc2VyLmlkXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vINCf0YDQvtCy0LXRgNGP0LXQvCDQv9GA0LDQstCwINC00L7RgdGC0YPQv9CwXHJcbiAgICAgIGlmIChjdXJyZW50VXNlci5pZCAhPT0gY2xpZW50SWQgJiYgY3VycmVudFVzZXIuaWQgIT09IGZyZWVsYW5jZXJJZCkge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XHJcbiAgICAgICAgICBlcnJvcjogJ0ZvcmJpZGRlbicsXHJcbiAgICAgICAgICBtZXNzYWdlOiAnWW91IGFyZSBub3QgYXV0aG9yaXplZCB0byBhY2Nlc3MgdGhpcyBjaGF0J1xyXG4gICAgICAgIH0pXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vINCX0LDQs9GA0YPQttCw0LXQvCDRh9Cw0YLRi1xyXG4gICAgICBjb25zdCBjaGF0cyA9IGxvYWRDaGF0cygpXHJcbiAgICAgIGNvbnN0IGNoYXRJZCA9IGNyZWF0ZUNoYXRJZCh0YXNrSWQsIGNsaWVudElkLCBmcmVlbGFuY2VySWQpXHJcblxyXG4gICAgICBsZXQgY2hhdCA9IGNoYXRzLmZpbmQoYyA9PiBjLmlkID09PSBjaGF0SWQpXHJcblxyXG4gICAgICAvLyDQldGB0LvQuCDRh9Cw0YIg0L3QtSDRgdGD0YnQtdGB0YLQstGD0LXRgiwg0YHQvtC30LTQsNC10Lwg0L3QvtCy0YvQuVxyXG4gICAgICBpZiAoIWNoYXQpIHtcclxuICAgICAgICBjaGF0ID0ge1xyXG4gICAgICAgICAgaWQ6IGNoYXRJZCxcclxuICAgICAgICAgIHRhc2tJZCxcclxuICAgICAgICAgIGNsaWVudElkLFxyXG4gICAgICAgICAgZnJlZWxhbmNlcklkLFxyXG4gICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICBsYXN0TWVzc2FnZUF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgICAgICBtZXNzYWdlczogW11cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNoYXRzLnB1c2goY2hhdClcclxuICAgICAgICBzYXZlQ2hhdHMoY2hhdHMpXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vINCf0L7Qu9GD0YfQsNC10Lwg0LjQvdGE0L7RgNC80LDRhtC40Y4g0L4g0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GP0YVcclxuICAgICAgY29uc3QgdXNlcnMgPSBsb2FkVXNlcnMoKVxyXG4gICAgICBjb25zdCBjbGllbnRVc2VyID0gdXNlcnMuZmluZCgodTogYW55KSA9PiB1LmlkID09PSBjbGllbnRJZClcclxuICAgICAgY29uc3QgZnJlZWxhbmNlclVzZXIgPSB1c2Vycy5maW5kKCh1OiBhbnkpID0+IHUuaWQgPT09IGZyZWVsYW5jZXJJZClcclxuXHJcbiAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIGNoYXQsXHJcbiAgICAgICAgdGFzazoge1xyXG4gICAgICAgICAgaWQ6IHRhc2suaWQsXHJcbiAgICAgICAgICB0aXRsZTogdGFzay50aXRsZSxcclxuICAgICAgICAgIHN0YXR1czogdGFzay5zdGF0dXMsXHJcbiAgICAgICAgICB3b3JrZXJDb25maXJtZWQ6IHRhc2sud29ya2VyQ29uZmlybWVkIHx8IGZhbHNlLFxyXG4gICAgICAgICAgY2xpZW50Q29uZmlybWVkOiB0YXNrLmNsaWVudENvbmZpcm1lZCB8fCBmYWxzZSxcclxuICAgICAgICAgIGFzc2lnbmVkVG86IHRhc2suYXNzaWduZWRUbyB8fCBudWxsLFxyXG4gICAgICAgICAgY3JlYXRlZEJ5OiB0YXNrLmNyZWF0ZWRCeSB8fCBudWxsLFxyXG4gICAgICAgICAgcmV3YXJkOiB0YXNrLnJld2FyZCB8fCAwXHJcbiAgICAgICAgfSxcclxuICAgICAgICBwYXJ0aWNpcGFudHM6IHtcclxuICAgICAgICAgIGNsaWVudDogY2xpZW50VXNlciA/IHtcclxuICAgICAgICAgICAgaWQ6IGNsaWVudFVzZXIuaWQsXHJcbiAgICAgICAgICAgIHVzZXJuYW1lOiBjbGllbnRVc2VyLnVzZXJuYW1lLFxyXG4gICAgICAgICAgICBlbWFpbDogY2xpZW50VXNlci5lbWFpbFxyXG4gICAgICAgICAgfSA6IG51bGwsXHJcbiAgICAgICAgICBmcmVlbGFuY2VyOiBmcmVlbGFuY2VyVXNlciA/IHtcclxuICAgICAgICAgICAgaWQ6IGZyZWVsYW5jZXJVc2VyLmlkLFxyXG4gICAgICAgICAgICB1c2VybmFtZTogZnJlZWxhbmNlclVzZXIudXNlcm5hbWUsXHJcbiAgICAgICAgICAgIGVtYWlsOiBmcmVlbGFuY2VyVXNlci5lbWFpbFxyXG4gICAgICAgICAgfSA6IG51bGxcclxuICAgICAgICB9LFxyXG4gICAgICAgIGN1cnJlbnRVc2VySWQ6IGN1cnJlbnRVc2VyLmlkXHJcbiAgICAgIH0pXHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignR2V0IGNoYXQgZXJyb3I6JywgZXJyb3IpXHJcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXHJcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBnZXQgY2hhdCdcclxuICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgfSBlbHNlIGlmIChtZXRob2QgPT09ICdQT1NUJykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBtZXNzYWdlIH0gPSByZXEuYm9keVxyXG5cclxuICAgICAgaWYgKCFtZXNzYWdlIHx8ICFtZXNzYWdlLnRyaW0oKSkge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgICAgICBlcnJvcjogJ0JhZCBSZXF1ZXN0JyxcclxuICAgICAgICAgIG1lc3NhZ2U6ICdNZXNzYWdlIHRleHQgaXMgcmVxdWlyZWQnXHJcbiAgICAgICAgfSlcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8g0JfQsNCz0YDRg9C20LDQtdC8INC30LDQtNCw0YfRg1xyXG4gICAgICBjb25zdCB0YXNrcyA9IGxvYWRUYXNrcygpXHJcbiAgICAgIGNvbnN0IHRhc2sgPSB0YXNrcy5maW5kKCh0OiBhbnkpID0+IHQuaWQgPT09IHRhc2tJZClcclxuXHJcbiAgICAgIGlmICghdGFzaykge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgICBlcnJvcjogJ05vdCBGb3VuZCcsXHJcbiAgICAgICAgICBtZXNzYWdlOiAnVGFzayBub3QgZm91bmQnXHJcbiAgICAgICAgfSlcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8g0J7Qv9GA0LXQtNC10LvRj9C10Lwg0YPRh9Cw0YHRgtC90LjQutC+0LIg0YfQsNGC0LBcclxuICAgICAgbGV0IGNsaWVudElkID0gdGFzay5jcmVhdGVkQnlcclxuICAgICAgbGV0IGZyZWVsYW5jZXJJZCA9IHVzZXJJZFxyXG5cclxuICAgICAgaWYgKGN1cnJlbnRVc2VyLmlkID09PSB0YXNrLmNyZWF0ZWRCeSkge1xyXG4gICAgICAgIGNsaWVudElkID0gdGFzay5jcmVhdGVkQnlcclxuICAgICAgICBmcmVlbGFuY2VySWQgPSB1c2VySWRcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjbGllbnRJZCA9IHVzZXJJZFxyXG4gICAgICAgIGZyZWVsYW5jZXJJZCA9IGN1cnJlbnRVc2VyLmlkXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vINCf0YDQvtCy0LXRgNGP0LXQvCDQv9GA0LDQstCwINC00L7RgdGC0YPQv9CwXHJcbiAgICAgIGlmIChjdXJyZW50VXNlci5pZCAhPT0gY2xpZW50SWQgJiYgY3VycmVudFVzZXIuaWQgIT09IGZyZWVsYW5jZXJJZCkge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XHJcbiAgICAgICAgICBlcnJvcjogJ0ZvcmJpZGRlbicsXHJcbiAgICAgICAgICBtZXNzYWdlOiAnWW91IGFyZSBub3QgYXV0aG9yaXplZCB0byBzZW5kIG1lc3NhZ2VzIGluIHRoaXMgY2hhdCdcclxuICAgICAgICB9KVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDQl9Cw0LPRgNGD0LbQsNC10Lwg0YfQsNGC0YtcclxuICAgICAgY29uc3QgY2hhdHMgPSBsb2FkQ2hhdHMoKVxyXG4gICAgICBjb25zdCBjaGF0SWQgPSBjcmVhdGVDaGF0SWQodGFza0lkLCBjbGllbnRJZCwgZnJlZWxhbmNlcklkKVxyXG5cclxuICAgICAgbGV0IGNoYXQgPSBjaGF0cy5maW5kKGMgPT4gYy5pZCA9PT0gY2hhdElkKVxyXG4gICAgICBjb25zdCBjaGF0SW5kZXggPSBjaGF0cy5maW5kSW5kZXgoYyA9PiBjLmlkID09PSBjaGF0SWQpXHJcblxyXG4gICAgICAvLyDQldGB0LvQuCDRh9Cw0YIg0L3QtSDRgdGD0YnQtdGB0YLQstGD0LXRgiwg0YHQvtC30LTQsNC10Lwg0LXQs9C+XHJcbiAgICAgIGlmICghY2hhdCkge1xyXG4gICAgICAgIGNoYXQgPSB7XHJcbiAgICAgICAgICBpZDogY2hhdElkLFxyXG4gICAgICAgICAgdGFza0lkLFxyXG4gICAgICAgICAgY2xpZW50SWQsXHJcbiAgICAgICAgICBmcmVlbGFuY2VySWQsXHJcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgIGxhc3RNZXNzYWdlQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICAgIG1lc3NhZ2VzOiBbXVxyXG4gICAgICAgIH1cclxuICAgICAgICBjaGF0cy5wdXNoKGNoYXQpXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vINCh0L7Qt9C00LDQtdC8INC90L7QstC+0LUg0YHQvtC+0LHRidC10L3QuNC1XHJcbiAgICAgIGNvbnN0IG5ld01lc3NhZ2UgPSB7XHJcbiAgICAgICAgaWQ6IGBtc2dfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gLFxyXG4gICAgICAgIHNlbmRlcklkOiBjdXJyZW50VXNlci5pZCxcclxuICAgICAgICB0ZXh0OiBtZXNzYWdlLFxyXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgIHN0YXR1czogJ3NlbnQnLFxyXG4gICAgICAgIC8vINCU0L7QsdCw0LLQu9GP0LXQvCDQv9C+0LTQtNC10YDQttC60YMg0YTQsNC50LvQvtCyXHJcbiAgICAgICAgLi4uKGZpbGVVcmwgJiYge1xyXG4gICAgICAgICAgZmlsZVVybCxcclxuICAgICAgICAgIGZpbGVOYW1lLFxyXG4gICAgICAgICAgZmlsZVR5cGVcclxuICAgICAgICB9KVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDQlNC+0LHQsNCy0LvRj9C10Lwg0YHQvtC+0LHRidC10L3QuNC1INCyINGH0LDRglxyXG4gICAgICBpZiAoY2hhdEluZGV4ID49IDApIHtcclxuICAgICAgICBjaGF0c1tjaGF0SW5kZXhdLm1lc3NhZ2VzLnB1c2gobmV3TWVzc2FnZSlcclxuICAgICAgICBjaGF0c1tjaGF0SW5kZXhdLmxhc3RNZXNzYWdlQXQgPSBuZXdNZXNzYWdlLnRpbWVzdGFtcFxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNoYXQubWVzc2FnZXMucHVzaChuZXdNZXNzYWdlKVxyXG4gICAgICAgIGNoYXQubGFzdE1lc3NhZ2VBdCA9IG5ld01lc3NhZ2UudGltZXN0YW1wXHJcbiAgICAgICAgY2hhdHMucHVzaChjaGF0KVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDQodC+0YXRgNCw0L3Rj9C10Lwg0LjQt9C80LXQvdC10L3QuNGPXHJcbiAgICAgIHNhdmVDaGF0cyhjaGF0cylcclxuXHJcbiAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIG1lc3NhZ2U6IG5ld01lc3NhZ2UsXHJcbiAgICAgICAgY2hhdDogY2hhdHNbY2hhdEluZGV4ID49IDAgPyBjaGF0SW5kZXggOiBjaGF0cy5sZW5ndGggLSAxXVxyXG4gICAgICB9KVxyXG5cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1NlbmQgbWVzc2FnZSBlcnJvcjonLCBlcnJvcilcclxuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcclxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHNlbmQgbWVzc2FnZSdcclxuICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgfSBlbHNlIHtcclxuICAgIHJlcy5zdGF0dXMoNDA1KS5qc29uKHtcclxuICAgICAgZXJyb3I6ICdNZXRob2Qgbm90IGFsbG93ZWQnLFxyXG4gICAgICBtZXNzYWdlOiBgTWV0aG9kICR7bWV0aG9kfSBpcyBub3Qgc3VwcG9ydGVkYFxyXG4gICAgfSlcclxuICB9XHJcbn0iXSwibmFtZXMiOlsiZnMiLCJwYXRoIiwiand0IiwiZ2V0Q2hhdHNGaWxlUGF0aCIsImpvaW4iLCJwcm9jZXNzIiwiY3dkIiwiZ2V0VGFza3NGaWxlUGF0aCIsImdldFVzZXJzRmlsZVBhdGgiLCJsb2FkQ2hhdHMiLCJmaWxlUGF0aCIsImV4aXN0c1N5bmMiLCJkYXRhIiwicmVhZEZpbGVTeW5jIiwiSlNPTiIsInBhcnNlIiwiZXJyb3IiLCJjb25zb2xlIiwic2F2ZUNoYXRzIiwiY2hhdHMiLCJkaXIiLCJkaXJuYW1lIiwibWtkaXJTeW5jIiwicmVjdXJzaXZlIiwid3JpdGVGaWxlU3luYyIsInN0cmluZ2lmeSIsImxvYWRUYXNrcyIsImxvYWRVc2VycyIsInZlcmlmeVRva2VuIiwidG9rZW4iLCJkZWNvZGVkIiwidmVyaWZ5IiwiZW52IiwiSldUX1NFQ1JFVCIsImdldFVzZXJGcm9tVG9rZW4iLCJhdXRoSGVhZGVyIiwic3RhcnRzV2l0aCIsInNwbGl0IiwidXNlcnMiLCJ1c2VyIiwiZmluZCIsInUiLCJpZCIsInVzZXJJZCIsInVzZXJuYW1lIiwiZW1haWwiLCJjcmVhdGVDaGF0SWQiLCJ0YXNrSWQiLCJjbGllbnRJZCIsImZyZWVsYW5jZXJJZCIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJxdWVyeSIsIm1lc3NhZ2UiLCJmaWxlVXJsIiwiZmlsZU5hbWUiLCJmaWxlVHlwZSIsImJvZHkiLCJsb2ciLCJzdGF0dXMiLCJqc29uIiwiY3VycmVudFVzZXIiLCJoZWFkZXJzIiwiYXV0aG9yaXphdGlvbiIsInRhc2tzIiwidGFzayIsInQiLCJjcmVhdGVkQnkiLCJjaGF0SWQiLCJjaGF0IiwiYyIsImNyZWF0ZWRBdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImxhc3RNZXNzYWdlQXQiLCJtZXNzYWdlcyIsInB1c2giLCJjbGllbnRVc2VyIiwiZnJlZWxhbmNlclVzZXIiLCJzdWNjZXNzIiwidGl0bGUiLCJ3b3JrZXJDb25maXJtZWQiLCJjbGllbnRDb25maXJtZWQiLCJhc3NpZ25lZFRvIiwicmV3YXJkIiwicGFydGljaXBhbnRzIiwiY2xpZW50IiwiZnJlZWxhbmNlciIsImN1cnJlbnRVc2VySWQiLCJ0cmltIiwiY2hhdEluZGV4IiwiZmluZEluZGV4IiwibmV3TWVzc2FnZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0ciIsInNlbmRlcklkIiwidGV4dCIsInRpbWVzdGFtcCIsImxlbmd0aCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/chat/[taskId]/[userId].ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./pages/api/chat/[taskId]/[userId].ts"));
module.exports = __webpack_exports__;

})();